/*
 * This code is for Internal Salesforce use only, and subject to change without notice.
 * Customers shouldn't reference this file in any web pages.
 */
Sfdc.ns("SfdcDevConsole.StaticResource");
(function(){function e(){if(null===a){b=Ext.create("Ext.Button",{text:"Submit"});c=Ext.create("Ext.form.field.Text",{name:"text",fieldLabel:"Name",style:"margin : 5px 15px"});var f=[];Sfdc.Array.forEach(Object.keys(SfdcDevConsole.Extents.StaticResource.CONTENT_TYPES),function(a){f.push({name:a})});d=Ext.create("Ext.form.field.ComboBox",{style:"margin : 0px 15px",fieldLabel:"MIME Type",editable:!1,queryMode:"local",displayField:"name",valueField:"name",triggerAction:"all",store:Ext.create("Ext.data.Store",
{fields:["name"],data:f})});a=Ext.create("Ext.window.Window",{title:"New Static Resource",height:200,width:300,closeAction:"hide",items:[c,d],buttons:[b]})}return a}var a=null,b=null,c=null,d=null;SfdcDevConsole.StaticResource.openCreateUI=function(a){e().show();b.setHandler(function(){a({Name:c.getValue(),ContentType:d.getRawValue()});e().hide()})}})();
Ext.define("apex.csi.ExecutionOverview",{extend:"Ext.tab.Panel",alias:"widget.executionoverview",title:"Execution Overview",initComponent:function(){Ext.apply(this,{items:[{xtype:"saveorder",title:LC.getLabel("ApexCSI","saveOrder")},{xtype:"limitspanel",title:"Limits"},{xtype:"timeline",title:"Timeline"},{xtype:"executionsummary",title:"Executed Units"}],listeners:{afterrender:function(a){a.editorPanel=apex.csi.LogViewer.findEditorPanel(a,"logviewer");a.editorPanel.executionOverview=a;a.editorPanel.executionSummaryPanel=
a.editorPanel.executionOverview.items.get(3);a.editorPanel.timeline=a.editorPanel.executionOverview.items.get(2)},afterlayout:function(a){a.checkItem=a.editorPanel.getSelectedPanelsMenuItem(5);a.checkItem.executionOverview=a},tabchange:function(a,b,c,d){a.editorPanel.highlight(this)},show:function(a){var b=a.editorPanel.executionSummaryPanel.getView().getHeaderCt();switch(a.editorPanel.selectedTraceLevels.APEX_CODE){case "FINEST":case "FINE":case "FINER":b.items.get(b.items.findIndex("dataIndex",
"cumulativeNanos")).setVisible(!0);b.items.get(b.items.findIndex("dataIndex","averageNanos")).setVisible(!0);b.items.get(b.items.findIndex("dataIndex","maxNanos")).setVisible(!0);b.items.get(b.items.findIndex("dataIndex","minNanos")).setVisible(!0);break;default:b.items.get(b.items.findIndex("dataIndex","cumulativeNanos")).setVisible(!1),b.items.get(b.items.findIndex("dataIndex","averageNanos")).setVisible(!1),b.items.get(b.items.findIndex("dataIndex","maxNanos")).setVisible(!1),b.items.get(b.items.findIndex("dataIndex",
"minNanos")).setVisible(!1)}}}});this.callParent()}});
Ext.define("apex.csi.FrameModel",{idProperty:"sequenceNumber",extend:"Ext.data.Model",fields:"method sequenceNumber heap durationNanos totalTime logLine category startTimeNanos endTimeNanos inScopeStep outScopeStep parentSequenceNumber mergedSequenceNumbersList locals iterations durationPercentage heapPercentage".split(" ")});
Ext.define("apex.csi.ExecutionStack",{extend:"Ext.grid.Panel",alias:"widget.executionstack",findRecord:function(b){var a=this.getStore().snapshot;if(a)return a.findBy(function(a){return a.data.sequenceNumber===b});a=this.getStore().findExact("sequenceNumber",b);return this.getStore().getAt(a)},updateTraceImpl:function(b,a){var c=this.getStore();c.previous=c.bottom=b;c.clearFilter();c.filterBy(function(a,b){return a.data.sequenceNumber===c.previous?(c.previous=a.data.parentSequenceNumber,!0):!1})},
updateTraceBuffer:null,updateTrace:function(b,a){this.isVisible()&&(this.updateTraceBuffer||(this.updateTraceBuffer=Ext.Function.createBuffered(function(a,b){try{this.updateTraceImpl(a,b)}finally{this.setLoading(!1)}},50,this)),this.setLoading(!0),this.updateTraceBuffer(b,a))},getStoreRawData:function(){return this.store.getProxy().getReader().rawData},initComponent:function(){Ext.apply(this,{title:"Execution Stack",listeners:{afterrender:function(b){b.editorPanel=apex.csi.LogViewer.findEditorPanel(b,
"logviewer");b.editorPanel.executionStack=b},afterlayout:function(b){b.checkItem=b.editorPanel.getSelectedPanelsMenuItem(1);b.checkItem.executionStack=b},itemclick:function(b,a,c,d,e,f){this.editorPanel.highlight(this)}},store:Ext.create("Ext.data.Store",{proxy:{type:"ajax",url:"/servlet/debug/apex/ApexCSIJsonServlet",reader:{type:"json",root:"frames"}},model:"apex.csi.FrameModel",idProperty:"sequenceNumber",autoLoad:!1,listeners:{load:function(b,a,c){a&&0<a.length&&(a=b.executionStack.editorPanel,
a.isStackLoaded=!0,a.saveorder.loadEvents(a),a=b.findRecord("parentSequenceNumber",-1),c=b.executionStack.editorPanel.performanceTree,b=b.executionStack.editorPanel.executionTree.getStore(),c=c.getStore(),a.data.logLine=a.data.inScopeStep,a.data.durationPercentage=1,a.data.heapPercentage=1,a.data.mergedSequenceNumbersList=[0],b.setRootNode(a.data),c.setRootNode(a.data),apex.ide.IDE.incrementProgress("Loaded frames into tree"))}}}),split:!0,columns:[{header:"Unit",dataIndex:"method",sortable:!1,renderer:"htmlEncode"},
{header:"Duration",dataIndex:"durationNanos",sortable:!1,renderer:apex.ide.IDE.nanoRenderer},{header:"Heap",dataIndex:"heap"}]});this.callParent()}});
Ext.define("apex.csi.ExecutionSummary",{extend:"Ext.grid.Panel",alias:"widget.executionsummary",filterMethods:function(a,b){var c=!this.showMethods.pressed,d=!this.showTriggers.pressed,e=!this.showWorkflow.pressed,f=!this.showCallouts.pressed,g=!this.showQueries.pressed,h=!this.showValidations.pressed,k=!this.showDML.pressed,l=!this.showPages.pressed;this.getStore().filterBy(function(a,b){switch(a.data.kind){case "Method":return c;case "Query":return g;case "Workflow":return e;case "Callout":return f;
case "Trigger":return d;case "Validation":return h;case "Page":case "SerializeViewstate":case "DeserializeViewstate":case "EvaluateFormula":return l;case "Insert":case "Update":case "Delete":case "ConvertLead":return k}})},methodRowRenderer:function(a,b,c,d,e,f){b.attr='align\x3d"right"';switch(c.data.kind){case "Method":case "Workflow":case "Callout":case "Trigger":case "Validation":case "Page":case "SerializeViewstate":case "DeserializeViewstate":case "EvaluateFormula":return"n/a";case "Query":case "Insert":case "Update":case "Delete":case "ConvertLead":return a}},
initComponent:function(){Ext.apply(this,{forceFit:!Ext.isIE,store:Ext.create("Ext.data.Store",{proxy:{type:"ajax",url:"/servlet/debug/apex/ApexCSIJsonServlet",reader:{type:"json",root:"methods"}},fields:"kind fullName name file cumulativeNanos averageNanos maxNanos minNanos invocations heap sumRows avgRows maxRows minRows queryType".split(" "),idProperty:"fullName",autoLoad:!1}),selModel:{mode:"SINGLE",listeners:{selectionchange:function(a,b,c){c=Ext.getCmp("editors").getActiveTab();c.highlight(c.executionOverview);
b&&0<b.length&&(a=a.view.ownerCt.ownerCt.editorPanel.logPanel,b=b[0].data,a.showMatchText.setValue(Ext.JSON.encode({method:b.name,file:b.file})),a.showTheseCheckbox.checked||a.showTheseCheckbox.setValue(!0),a.filterStepsTask.delay(500))}}},bbar:{xtype:"toolbar",items:[{xtype:"label",text:"Show:"},{xtype:"tbspacer",width:5},{itemId:"showMethods",xtype:"button",text:"Methods",enableToggle:!0,listeners:{click:function(a){this.executionSummary.filterMethods()},afterrender:function(a){a.executionSummary=
a.ownerCt.ownerCt;a.executionSummary.showMethods=a}}},{itemId:"showQueries",xtype:"button",text:"Queries",enableToggle:!0,listeners:{click:function(a){this.executionSummary.filterMethods()},afterrender:function(a){a.executionSummary=a.ownerCt.ownerCt;a.executionSummary.showQueries=a}}},{itemId:"showWorkflow",xtype:"button",text:"Workflow",enableToggle:!0,listeners:{click:function(a){this.executionSummary.filterMethods()},afterrender:function(a){a.executionSummary=a.ownerCt.ownerCt;a.executionSummary.showWorkflow=
a}}},{itemId:"showCallouts",xtype:"button",text:"Callouts",enableToggle:!0,listeners:{click:function(a){this.executionSummary.filterMethods()},afterrender:function(a){a.executionSummary=a.ownerCt.ownerCt;a.executionSummary.showCallouts=a}}},{itemId:"showDML",xtype:"button",text:"DML",enableToggle:!0,listeners:{click:function(a){this.executionSummary.filterMethods()},afterrender:function(a){a.executionSummary=a.ownerCt.ownerCt;a.executionSummary.showDML=a}}},{itemId:"showValidations",xtype:"button",
text:"Validations",enableToggle:!0,listeners:{click:function(a){this.executionSummary.filterMethods()},afterrender:function(a){a.executionSummary=a.ownerCt.ownerCt;a.executionSummary.showValidations=a}}},{itemId:"showTriggers",xtype:"button",text:"Triggers",enableToggle:!0,listeners:{click:function(a){this.executionSummary.filterMethods()},afterrender:function(a){a.executionSummary=a.ownerCt.ownerCt;a.executionSummary.showTriggers=a}}},{itemId:"showPages",xtype:"button",text:"Pages",enableToggle:!0,
listeners:{click:function(a){this.executionSummary.filterMethods()},afterrender:function(a){a.executionSummary=a.ownerCt.ownerCt;a.executionSummary.showPages=a}}}]},columns:[{itemId:"fullName",dataIndex:"fullName",hidden:!0,renderer:"htmlEncode"},{header:"What",dataIndex:"kind",sortable:!0},{header:"Name",dataIndex:"name",sortable:!0,renderer:"htmlEncode"},{header:"Sum",dataIndex:"cumulativeNanos",sortable:!0,renderer:apex.ide.IDE.nanoRenderer},{header:"Avg",dataIndex:"averageNanos",sortable:!0,renderer:apex.ide.IDE.nanoRenderer},
{header:"Max",dataIndex:"maxNanos",sortable:!0,renderer:apex.ide.IDE.nanoRenderer},{header:"Min",dataIndex:"minNanos",sortable:!0,renderer:apex.ide.IDE.nanoRenderer},{header:LC.getLabel("ApexCSI","count"),dataIndex:"invocations",sortable:!0,renderer:function(a,b,c,d,e,f){b.attr='align\x3d"right"';return a}},{header:"Heap",dataIndex:"heap",sortable:!0,renderer:function(a,b,c,d,e,f){b.attr='align\x3d"right"';return a}},{header:"Query Type",dataIndex:"queryType",sortable:!0,renderer:function(a,b,c,d,
e,f){return"Query"!=c.data.kind?"n/a":a}},{header:"Sum rows",dataIndex:"sumRows",sortable:!0,renderer:this.methodRowRenderer},{header:"Avg rows",dataIndex:"avgRows",sortable:!0,renderer:this.methodRowRenderer},{header:"Max rows",dataIndex:"maxRows",sortable:!0,renderer:this.methodRowRenderer},{header:"Min row",dataIndex:"minRows",sortable:!0,renderer:this.methodRowRenderer}]});this.callParent()}});
Ext.define("apex.csi.ExecutionTree",{extend:"Ext.tree.Panel",alias:"widget.executiontree",getFrameNode:function(a){return this.getRootNode().data.sequenceNumber===a?this.getRootNode():this.getRootNode().findChild("sequenceNumber",a,!0)},expandToNode:function(a,b){var d=[],e=this.editorPanel.executionStack;d.push(a);for(var g=e.findRecord(a.data.parentSequenceNumber);g;)d.push(g),g=e.findRecord(g.data.parentSequenceNumber);for(;0<d.length;)g=d.pop(),g.frameNode||(g.frameNode=this.getFrameNode(g.data.sequenceNumber)),
0<d.length&&g.frameNode&&g.frameNode.expand();var k=this;if("function"===typeof b)k.on("afteritemexpand",function(){b(g.frameNode);k.un("afteritemexpand",arguments.callee)});g.frameNode&&g.frameNode.expand()},expandAndSelectNodeImpl:function(a){function b(a){e.getSelectionModel().select(a,!0);e.getView().focusRow(a);d.eventQueue=[];d.resumeEvents()}var d=this.getSelectionModel();d.suspendEvents();a=this.editorPanel.executionStack.findRecord(a);var e=this;a&&(a.frameNode&&a.frameNode.isVisible()?b(a.frameNode):
this.expandToNode(a,b));return a},expandAndSelectNodeBuffer:null,expandAndSelectNode:function(a){this.ownerCt.isVisible()&&(this.expandAndSelectNodeBuffer||(this.expandAndSelectNodeBuffer=Ext.Function.createBuffered(function(a){try{this.expandAndSelectNodeImpl(a)}finally{this.setLoading(!1)}},50,this)),this.setLoading(!0),this.expandAndSelectNodeBuffer(a))},initComponent:function(){Ext.apply(this,{autoScroll:!0,forceFit:!Ext.isIE,displayField:"method",store:Ext.create("Ext.data.TreeStore",{model:"apex.csi.FrameModel"}),
columns:[{itemId:"sequenceNumber",dataIndex:"sequenceNumber",hidden:!0},{header:"Unit",dataIndex:"method",sortable:!1,xtype:"treecolumn",renderer:Ext.util.Format.htmlEncode},{header:"Duration",dataIndex:"durationNanos",sortable:!1,renderer:apex.ide.IDE.nanoRenderer},{header:"Heap",dataIndex:"heap"}],listeners:{executionTree:this,beforeitemexpand:function(a,b){if(!a.childrenLoaded){var d=b.executionTree.editorPanel.executionStack.getStore();d.clearFilter();for(var e=0,g=[],k={};-1<e;)if(e=d.findExact("parentSequenceNumber",
a.data.sequenceNumber,e),-1<e){var c=d.getAt(e),c={method:c.data.method,sequenceNumber:c.data.sequenceNumber,parentSequenceNumber:c.data.parentSequenceNumber,durationNanos:c.data.durationNanos,heap:c.data.heap,logLine:c.data.inScopeStep,leaf:!0};g.push(c);k[c.sequenceNumber]=c;e++}d.clearFilter();d.each(function(a){k[a.data.parentSequenceNumber]&&(k[a.data.parentSequenceNumber].leaf=!1)});a.appendChild(g);a.childrenLoaded=!0}},selectionchange:function(a,b,d){0!==b.length&&(a=b[0],this.editorPanel.executionStack.updateTrace(a.data.sequenceNumber,
a.data.logLine),b=this.editorPanel.logPanel,b.suspendEvents(),b.showTheseCheckbox.setValue(!1),b.filterSteps(a.data.sequenceNumber,!0),b.selectRow("sequenceNumber",a.data.logLine,!0),b.resumeEvents(),(a=b.getSelectionModel().getSelection()[0])&&this.editorPanel.sourcePanel.selectSource(a.data.file,a.data.lineNumber))},itemclick:function(a,b,d,e,g,k){b&&this.editorPanel.highlight(this.editorPanel.stacktreepanel)}}});this.callParent()}});
Ext.define("apex.csi.PerformanceTree",{extend:"Ext.tree.Panel",alias:"widget.performancetree",initComponent:function(){Ext.apply(this,{autoScroll:!0,forceFit:!Ext.isIE,displayField:"method",store:Ext.create("Ext.data.TreeStore",{model:"apex.csi.FrameModel"}),columns:[{itemId:"sequenceNumber",dataIndex:"sequenceNumber",hidden:!0},{header:"Unit",dataIndex:"method",sortable:!1,xtype:"treecolumn",hidden:!1,renderer:Ext.util.Format.htmlEncode},{header:"Duration",dataIndex:"durationNanos",sortable:!0,renderer:apex.ide.IDE.nanoRenderer},
{header:"Duration Percentage",dataIndex:"durationPercentage",sortable:!0,renderer:apex.ide.IDE.percentRenderer,hidden:!0},{header:"Heap",dataIndex:"heap"},{header:"Heap Percentage",dataIndex:"heapPercentage",hidden:!0,renderer:apex.ide.IDE.percentRenderer},{header:"Iterations",dataIndex:"iterations",hidden:!1}],listeners:{performanceTree:this,beforeitemexpand:function(a,b){if(!a.childrenLoaded){var d={},e=b.performanceTree.editorPanel.executionStack.getStore();e.clearFilter();for(var g=b.performanceTree.getStore().tree.root.data.durationNanos,
k=b.performanceTree.getStore().tree.root.data.heap,c=0,l=0,m={};-1<c;){for(var f=-1,h=0;h<a.data.mergedSequenceNumbersList.length;h++)if(l=a.data.mergedSequenceNumbersList[h],l=e.findExact("parentSequenceNumber",l,c),-1===f||f>l&&0<=l)f=l;c=f;-1<c&&(f=e.getAt(c),d.hasOwnProperty(f.data.method)?(h=d[f.data.method],h.heap+=f.data.heap,h.durationNanos+=f.data.durationNanos,h.heapPercentage+=f.data.heapPercentage,h.durationPercentage+=f.data.durationPercentage,h.iterations+=1,h.mergedSequenceNumbersList.push(f.data.sequenceNumber)):
(h={method:f.data.method,sequenceNumber:f.data.sequenceNumber,parentSequenceNumber:f.data.parentSequenceNumber,mergedSequenceNumbersList:[f.data.sequenceNumber],durationNanos:f.data.durationNanos,durationPercentage:f.data.durationPercentage,heapPercentage:f.data.heapPercentage,heap:f.data.heap,logLine:f.data.inScopeStep,leaf:!0,iterations:1},d[f.data.method]=h,m[h.sequenceNumber]=h),c++)}e.clearFilter();e.each(function(a){m[a.data.parentSequenceNumber]&&(m[a.data.parentSequenceNumber].leaf=!1)});
var e=[],n;for(n in d)n&&(c=d[n],c.durationPercentage=c.durationNanos/g,c.heapPercentage=c.heap/k,e.push(c));a.appendChild(e);a.childrenLoaded=!0}},itemclick:function(a,b,d,e,g,k){if(b){this.editorPanel.highlight(this.editorPanel.stacktreepanel);this.editorPanel.logPanel.showTheseCheckbox.setValue(!0);this.editorPanel.executionStack.updateTrace(b.data.sequenceNumber,b.data.logLine);var c=this.editorPanel.logPanel;c.suspendEvents();c.showMatchText.setValue(Ext.JSON.encode({method:b.data.method}));
c.filterSteps(b.data.sequenceNumber,!0,function(){c.getSelectionModel().select(0,!1,!1)});c.resumeEvents()}}}});this.callParent()}});
Ext.define("apex.csi.LimitsPanel",{extend:"Ext.grid.Panel",alias:"widget.limitspanel",updateLimits:function(a){var b,d=[],c=0,e={};for(b in this.used)"string"===typeof this.used[b]&&(d[c]={limit:b,usedSoFar:0,totalUsedInRequest:this.used[b],configuredLimit:this.limits[b]},e[b]=c,c++);if(0===d.length)a='\x3ca style\x3d"text-decoration:underline;color:blue" onclick\x3d"SfdcDevConsole.TraceFlags.show();"\x3e',a="FINEST"!==this.editorPanel.selectedTraceLevels.APEX_PROFILING?a+"To see limits, set profiling log level to Finest.":
a+"No LIMIT_USAGE events found. To see limits, set the Profiling log level to Finest.",d.push({limit:a+"\x3c/a\x3e",usedSoFar:"",totalUsedInRequest:"",configuredLimit:""});else if(a&&"number"===typeof a)for(b=0;b<this.limitEvents.length&&!(this.limitEvents[b].sequenceNumber>a);b++)c=this.limitEvents[b].detail.split("|"),d[e[c[1]]].usedSoFar=c[2];this.getStore().loadData(d,!1)},initComponent:function(){Ext.apply(this,{limitEvents:[],limits:{},used:{},listeners:{afterrender:function(a){a.editorPanel=
apex.csi.LogViewer.findEditorPanel(a,"logviewer");a.editorPanel.limitPanel=a;for(var b=a.editorPanel.logPanel,d=b.getStore().getProxy().data,c=0;c<d.length;c++){var e=d[c];if(0<=e.detail.indexOf("MAXIMUM DEBUG LOG SIZE REACHED"))for(var g in a.used)"string"===typeof a.used[g]&&(a.used[g]="?");else if("LIMIT_USAGE"===e.event&&"["===e.detail.charAt(0)){var f=e.detail.split("|");a.used[f[1]]=f[2];a.limits[f[1]]=f[3];a.limitEvents[a.limitEvents.length]=e}}b.getSelectionModel().on("selectionchange",function(a,
b,c){0<b.length&&this.updateLimits(b[0].data.sequenceNumber)},this);a=a.editorPanel.logPanel.getSelectionModel().getSelection();void 0!==a&&0<a.length?this.updateLimits(a[0].data.sequenceNumber):this.updateLimits()}},store:new Ext.data.JsonStore({idProperty:"limit",fields:["limit","usedSoFar","totalUsedInRequest","configuredLimit"]}),forceFit:!Ext.isIE,columns:[{header:"Limit",dataIndex:"limit"},{header:"Used so far",dataIndex:"usedSoFar"},{header:"Request Total",dataIndex:"totalUsedInRequest"},{header:"Total Available",
dataIndex:"configuredLimit"}]});this.callParent()}});
Ext.define("apex.ide.CsiPerspectiveDefinition",{extend:"apex.ide.ViewerPerspectiveDefinition",constructor:function(a){this.callParent(arguments)},inheritableStatics:{bodyPanels:"executionoverview executionstack stacktreepanel logpanel sourcepanel sourcelistpanel variablepanel".split(" "),isBodyPanel:function(a){return Ext.Array.contains(this.bodyPanels,a.xtype)},isValidPanelOrContainer:function(a){return this.isPanelContainer(a)||this.isBodyPanel(a)},isPredefinedPerspective:function(a){for(var b in this.predefinedPerspectives)if(this.predefinedPerspectives.hasOwnProperty(b)&&
this.predefinedPerspectives[b].label===a)return!0;return!1},predefinedPerspectives:{All:{label:"All (Predefined)",perspectiveConfig:Ext.JSON.encode([{xtype:"hboxContainer",heightPercentage:0.71,widthPercentage:1,resizable:!0,resizeHandles:"s",items:[{xtype:"vboxContainer",resizable:!0,resizeHandles:"e",widthPercentage:0.2,heightPercentage:1,items:[{xtype:"stacktreepanel",heightPercentage:0.5,resizable:!0,resizeHandles:"s",widthPercentage:1},{xtype:"executionstack",heightPercentage:0.5,widthPercentage:1}]},
{xtype:"vboxContainer",resizable:!0,resizeHandles:"e",widthPercentage:0.6,heightPercentage:1,items:[{heightPercentage:1,widthPercentage:1,xtype:"logpanel"}]},{xtype:"vboxContainer",widthPercentage:0.2,heightPercentage:1,items:[{xtype:"sourcepanel",heightPercentage:0.5,resizable:!0,resizeHandles:"s",widthPercentage:1},{xtype:"sourcelistpanel",heightPercentage:0.2,resizable:!0,resizeHandles:"s",widthPercentage:1},{xtype:"variablepanel",heightPercentage:0.3,widthPercentage:1}]}]},{xtype:"hboxContainer",
resizable:!0,resizeHandles:"s",heightPercentage:0.25,widthPercentage:1,items:[{xtype:"executionoverview",heightPercentage:1,widthPercentage:1}]}])},Debug:{label:"Debug (Predefined)",perspectiveConfig:Ext.JSON.encode([{xtype:"hboxContainer",heightPercentage:1,widthPercentage:1,resizable:!0,resizeHandles:"s",items:[{xtype:"vboxContainer",resizable:!0,resizeHandles:"e",widthPercentage:0.2,heightPercentage:1,hidden:!0,items:[{xtype:"stacktreepanel",heightPercentage:0.5,resizable:!0,resizeHandles:"s",
hidden:!0,widthPercentage:1},{xtype:"executionstack",heightPercentage:0.5,hidden:!0,widthPercentage:1}]},{xtype:"vboxContainer",resizable:!0,resizeHandles:"e",widthPercentage:0.5,heightPercentage:1,items:[{heightPercentage:1,widthPercentage:1,xtype:"logpanel"}]},{xtype:"vboxContainer",widthPercentage:0.5,heightPercentage:1,items:[{xtype:"sourcepanel",heightPercentage:0.5,resizable:!0,resizeHandles:"s",widthPercentage:1},{xtype:"sourcelistpanel",heightPercentage:0.3,resizable:!0,hidden:!0,resizeHandles:"s",
widthPercentage:1},{xtype:"variablepanel",heightPercentage:0.2,widthPercentage:1}]}]},{xtype:"hboxContainer",resizable:!0,resizeHandles:"s",heightPercentage:0.25,widthPercentage:1,hidden:!0,items:[{xtype:"executionoverview",hidden:!0,heightPercentage:1,widthPercentage:1}]}])},LogOnly:{label:"Log Only (Predefined)",perspectiveConfig:Ext.JSON.encode([{xtype:"hboxContainer",heightPercentage:1,widthPercentage:1,resizable:!0,resizeHandles:"s",items:[{xtype:"vboxContainer",resizable:!0,resizeHandles:"e",
widthPercentage:0.2,heightPercentage:1,hidden:!0,items:[{xtype:"stacktreepanel",heightPercentage:0.5,resizable:!0,resizeHandles:"s",hidden:!0,widthPercentage:1},{xtype:"executionstack",heightPercentage:0.5,hidden:!0,widthPercentage:1}]},{xtype:"vboxContainer",resizable:!0,resizeHandles:"e",widthPercentage:1,heightPercentage:1,items:[{heightPercentage:1,widthPercentage:1,xtype:"logpanel"}]},{xtype:"vboxContainer",widthPercentage:0.5,heightPercentage:1,hidden:!0,items:[{xtype:"sourcepanel",heightPercentage:0.5,
resizable:!0,resizeHandles:"s",hidden:!0,widthPercentage:1},{xtype:"sourcelistpanel",heightPercentage:0.3,resizable:!0,hidden:!0,resizeHandles:"s",widthPercentage:1},{xtype:"variablepanel",heightPercentage:0.2,hidden:!0,widthPercentage:1}]}]},{xtype:"hboxContainer",resizable:!0,resizeHandles:"s",heightPercentage:0.25,widthPercentage:1,hidden:!0,items:[{xtype:"executionoverview",hidden:!0,heightPercentage:1,widthPercentage:1}]}])},Analysis:{label:"Analysis (Predefined)",perspectiveConfig:Ext.JSON.encode([{xtype:"hboxContainer",
heightPercentage:0.5,widthPercentage:1,resizable:!0,resizeHandles:"s",items:[{xtype:"vboxContainer",resizable:!0,resizeHandles:"e",widthPercentage:0.5,heightPercentage:1,items:[{xtype:"stacktreepanel",heightPercentage:0.5,resizable:!0,resizeHandles:"s",widthPercentage:1},{xtype:"executionstack",heightPercentage:0.5,widthPercentage:1}]},{xtype:"vboxContainer",resizable:!0,resizeHandles:"e",widthPercentage:0.5,heightPercentage:1,items:[{heightPercentage:1,widthPercentage:1,xtype:"logpanel"}]},{xtype:"vboxContainer",
widthPercentage:0.5,heightPercentage:1,hidden:!0,items:[{xtype:"sourcepanel",heightPercentage:0.5,resizable:!0,resizeHandles:"s",hidden:!0,widthPercentage:1},{xtype:"sourcelistpanel",heightPercentage:0.3,resizable:!0,hidden:!0,resizeHandles:"s",widthPercentage:1},{xtype:"variablepanel",heightPercentage:0.2,hidden:!0,widthPercentage:1}]}]},{xtype:"hboxContainer",resizable:!0,resizeHandles:"s",heightPercentage:0.5,widthPercentage:1,items:[{xtype:"executionoverview",heightPercentage:1,widthPercentage:1}]}])}}}});
Ext.define("apex.csi.EventNode",{constructor:function(a,b){if(!b)throw"Invalid frame for event node";this.frames=[b];this.title=b.method;this.editorPanel=a;return this},getTopFrame:function(){if(0===this.frames.length)throw"Event node is initialized but there is no corresponding frames";return this.frames[0]},getParentFrame:function(a){return this.editorPanel.executionStack.store.findRecord("sequenceNumber",a.parentSequenceNumber)},getDMLOperation:function(){var a=this.getTopFrame(),b=this.getParentFrame(a);
return(b=b&&b.data.method)&&apex.csi.EventNode.isDMLOperation(b)?b:a.method.substr(a.method.indexOf(":")+1)},getEventResourceId:function(){return this.getTopFrame().parentSequenceNumber+1},initialSequenceNumber:null,getNodeSteps:function(a){var b=a.sequenceNumber,c={},d=this;(this.editorPanel.executionStack.store.snapshot||this.editorPanel.executionStack.store).each(function(a){!d.initialSequenceNumber&&a.data.sequenceNumber==b&&(d.initialSequenceNumber=a.data.inScopeStep);a.data.parentSequenceNumber==
b&&(c[a.data.sequenceNumber]=d.editorPanel.logPanel.store.findRecords("frameSequenceNumber",a.data.sequenceNumber))});return c},getStep:function(a){return this.editorPanel.logPanel.store.findRecords("sequenceNumber",a.inScopeStep)[0]},detailWindow:null,getDetailWindow:function(){null===this.detailWindow&&(this.detailWindow=Ext.create("Ext.window.Window",{xtype:"detailWindow",title:this.title,height:400,width:400,layout:"fit",closeAction:function(){this.hide()},items:[{xtype:"eventdetailgrid",event:this}]}));
return this.detailWindow},tooltipData:{},getTooltipDisplay:function(a){return this.tooltipData[a]},addTooltipEntry:function(a,b){a&&b&&(this.tooltipData[a]=b)},statics:{currentDetailWindow:null,isDMLOperation:function(a){return 0<a.indexOf(" "+apex.csi.EventNode.DMLAction.Insert)||0<a.indexOf(" "+apex.csi.EventNode.DMLAction.Update)||0<a.indexOf(" "+apex.csi.EventNode.DMLAction.Insert.Delete)},DMLAction:{Insert:"Insert",Update:"Update",Delete:"Delete"}}});
Ext.define("apex.csi.TriggerNode",{extend:"apex.csi.EventNode",cls:null,getCls:function(){if(!this.cls){var a=this.getStep(this.getTopFrame());if(!a)return"";a=a.detail;0<=a.substring(a.indexOf(" event "),a.indexOf(" for ")).indexOf("Before")?this.cls="BEFORE_TRIGGER_NODE":this.cls="AFTER_TRIGGER_NODE"}return this.cls},getEventType:function(){var a=this.getTopFrame().method.split(" ");return"Apex Trigger "+a[a.length-1]},getDMLOperation:function(){var a=this.getParentFrame(this.getTopFrame());if((a=
a&&a.data.method)&&apex.csi.EventNode.isDMLOperation(a))return a;a=this.getStep(this.getTopFrame());a=a.detail.substring(a.detail.indexOf(" on "),a.detail.indexOf(" for ")).split(" ");return a[a.length-4]+" "+this.getDMLAction(a[a.length-1])},getDetailGridData:function(){var a=this.getTopFrame().sequenceNumber,b=[],c={},d=this;this.editorPanel.executionStack.store.each(function(b){!d.initialSequenceNumber&&b.data.sequenceNumber==a&&(d.initialSequenceNumber=b.data.inScopeStep);if(b.data.parentSequenceNumber==
a){if(b.data.method==apex.csi.TriggerNode.SCHEDULED_JOB)return c[apex.csi.TriggerNode.SCHEDULED_JOB]=c[apex.csi.TriggerNode.SCHEDULED_JOB]?c[apex.csi.TriggerNode.SCHEDULED_JOB]+1:1,!0;if(b.data.method==apex.csi.TriggerNode.EXECUTE_BATCH)return c[apex.csi.TriggerNode.EXECUTE_BATCH]=c[apex.csi.TriggerNode.EXECUTE_BATCH]?c[apex.csi.TriggerNode.EXECUTE_BATCH]+1:1,!0;if(d.getStep(b.data).event==apex.csi.TriggerNode.DML_BEGIN)return c[b.data.method]=c[b.data.method]?c[b.data.method]+1:1,!0}});for(var e in c)if(c.hasOwnProperty(e)&&
c[e]){var f={};f.operation=e;f.iteration=c[e];b.push(f)}0===b.length&&b.push({message:"No Batch, Schedule or DML actions"});return b},getTooltipDisplay:function(a){return""},getDMLAction:function(a){return 0===a.indexOf("Before")?a.substr(6):0===a.indexOf("After")?a.substr(5):""},statics:{FRAME_NAME:"Apex Trigger",SCHEDULED_JOB:"schedule",EXECUTE_BATCH:"executeBatch",DML_BEGIN:"DML_BEGIN"}});
Ext.define("apex.csi.ValidationNode",{extend:"apex.csi.EventNode",getCls:function(){return"VALIDATION_EVENT_NODE"},title:"Validation Rules",getEventType:function(){return apex.csi.ValidationNode.FRAME_NAME},getObjectDetail:function(a){a=this.getStep(a);return a.detail.substr(a.detail.indexOf(":")+1)},getValidationRuleName:function(a){return a.substr(a.indexOf("|")+1)},getDetailGridData:function(){for(var a=[],b=0;b<this.frames.length;b++){var c=this.frames[b],d=this.getNodeSteps(c),c=this.getObjectDetail(c),
e={object:c},f;for(f in d)if(d.hasOwnProperty(f)&&d[f]){steps=d[f];for(var g=null,h=0;h<steps.length;h++){var k=steps[h];if(k.event==apex.csi.ValidationNode.VALIDATION_RULE)var l=this.getValidationRuleName(k.detail);k.event==apex.csi.ValidationNode.VALIDATION_FAIL&&(g="failed");k.event==apex.csi.ValidationNode.VALIDATION_PASS&&(g="passed");k.event==apex.csi.ValidationNode.VALIDATION_FORMULA&&this.addTooltipEntry(c+l,{detail:k.detail,name:l});g&&(l&&c)&&(e[l]=g)}}a.push(e)}return a},getTooltipDisplay:function(a){a=
this.tooltipData[a];return"\x3ch3\x3e"+a.name+"\x3c/h3\x3e\x3cbr/\x3e"+a.detail},statics:{FRAME_NAME:"Validation",VALIDATION_RULE:"VALIDATION_RULE",VALIDATION_PASS:"VALIDATION_PASS",VALIDATION_FAIL:"VALIDATION_FAIL",VALIDATION_FORMULA:"VALIDATION_FORMULA"}});
Ext.define("apex.csi.WorkflowBlock",{extend:"apex.csi.EventNode",getEventResourceId:function(){return this.getParentFrame(this.getTopFrame()).data.parentSequenceNumber+1},getDMLOperation:function(){var a=this.getParentFrame(this.getTopFrame()),b=this.getParentFrame(a.data);return(b=b&&b.data.method)&&apex.csi.EventNode.isDMLOperation(b)?b:a.data.method.substr(a.data.method.indexOf(":")+1)},getObjectName:function(a){return a.substr(a.indexOf("[")+1,a.indexOf("]")-1)},getDetailGridData:function(){var a=
this.getNodeSteps(this.getTopFrame()),b=[],c={},d;for(d in a)if(a.hasOwnProperty(d)&&a[d]){var e;steps=a[d];for(var f=0;f<steps.length;f++){var g=steps[f];if(g.event==apex.csi.WorkflowBlock.WF_CRITERIA_BEGIN)var h=this.getObjectName(g.detail),k=g.method;g.event==apex.csi.WorkflowBlock.WF_CRITERIA_END&&(e=g.detail)}h&&k&&(c[h]||(c[h]={object:h}),c[h][k]=e?e:"not evaluated")}for(var l in c)c[l]&&b.push(c[l]);return b},getTooltipDisplay:function(a){return""},statics:{WF_CRITERIA_BEGIN:"WF_CRITERIA_BEGIN",
WF_CRITERIA_END:"WF_CRITERIA_END"}});Ext.define("apex.csi.AssignmentNode",{extend:"apex.csi.WorkflowBlock",title:"Assignment Rules",getEventType:function(){return apex.csi.AssignmentNode.FRAME_NAME},getCls:function(){return"ASSIGNMENT_EVENT_NODE"},statics:{FRAME_NAME:"Assignment"}});Ext.define("apex.csi.WorkflowNode",{extend:"apex.csi.WorkflowBlock",title:"Workflow Rules",getCls:function(){return"WORKFLOW_EVENT_NODE"},getEventType:function(){return apex.csi.WorkflowNode.FRAME_NAME},statics:{FRAME_NAME:"Workflow"}});
Ext.define("apex.csi.EventDetailGrid",{extend:"Ext.grid.Panel",alias:"widget.eventdetailgrid",forceFit:!0,addTooltip:function(a,b,c,d,e,f,g){0!==e&&(c=this.event.getTooltipDisplay(c.data.object+this.columns[e].dataIndex),b.tdAttr="data-qtip\x3d'"+c+"'");return a},bbar:{xtype:"toolbar",items:[{xtype:"tbfill"},{text:"Select line in Log Panel",xtype:"button",listeners:{click:function(a,b){var c=a.detailGrid.event;c.editorPanel.logPanel.selectRow("sequenceNumber",c.initialSequenceNumber);a.detailWindow.hide()},
afterrender:function(a){a.detailGrid=a.ownerCt.ownerCt;a.detailWindow=a.detailGrid.ownerCt;a.detailGrid.detailButton=a}}}]},initComponent:function(){var a=this.event.getDetailGridData(),b=this.event.getEventType()+this.event.getTopFrame().sequenceNumber,c=Ext.ModelManager.getModel(b);if(void 0===c||null===c){var c=[],d;for(d in a[0])d&&c.push({name:d});Ext.define(b,{extend:"Ext.data.Model",fields:c,idProperty:"Id"})}void 0===this.store&&(this.store={data:a,model:b});if(void 0===this.columns){var b=
[],e;for(e in a[0])e&&b.push(Ext.create("Ext.grid.column.Column",{header:e,dataIndex:e,renderer:this.addTooltip}));this.columns=b}this.callParent()}});Ext.define("apex.csi.SaveOrderEvent",{idProperty:"ResourceId",extend:"Sch.model.Event",fields:[{name:"ResourceId"},{name:"StartDate",type:"date"},{name:"EndDate",type:"date"},{name:"eventNode"}]});
Ext.define("apex.csi.SaveorderGrid",{extend:"Sch.panel.SchedulerGrid",alias:"widget.saveordergrid",currentTime:new Date(2E3,1,1),getCurrentStartTime:function(){return this.currentTime},getCurrentEndTime:function(){return Sch.util.Date.add(this.currentTime,Sch.util.Date.HOUR,1)},incrementTime:function(){this.currentTime=Sch.util.Date.add(this.currentTime,Sch.util.Date.MINUTE,60)},loadEvents:function(a){if(a.isLogLoaded&&a.isStackLoaded){var b,c,d,e=[],f={};a=a.executionStack.getStoreRawData();for(var g=
a.length-1;0<g;g--)if(b=a[g],d=this.getEventNode(b)){b=d.getEventType();c=d.getDMLOperation();var h=d.getEventResourceId();!f[h]&&c&&(f[h]=c,this.resourceStore.add({Name:c,Id:h}));e.push({ResourceId:h,eventNode:d,Name:b,Cls:d.getCls(),StartDate:this.getCurrentStartTime(),EndDate:this.getCurrentEndTime()});this.incrementTime()}0===e.length?this.resourceStore.add({Name:"No save order events",Id:1}):(this.eventStore.loadData(e),this.setStart(this.eventStore.first().data.StartDate),this.setEnd(this.eventStore.last().data.EndDate),
apex.ide.IDE.incrementProgress("Loaded save order events"))}},getEventNode:function(a){var b=this.editorPanel;if(apex.csi.SaveorderGrid.startWith(a.method,apex.csi.ValidationNode.FRAME_NAME+":")){if(a.parentSequenceNumber in this.validationRules)this.validationRules[a.parentSequenceNumber].frames.push(a);else return b=new apex.csi.ValidationNode(b,a),this.validationRules[a.parentSequenceNumber]=b;return null}return a.method===apex.csi.WorkflowNode.FRAME_NAME?new apex.csi.WorkflowNode(b,a):apex.csi.SaveorderGrid.startWith(a.method,
apex.csi.TriggerNode.FRAME_NAME)?new apex.csi.TriggerNode(b,a):a.method===apex.csi.AssignmentNode.FRAME_NAME?new apex.csi.AssignmentNode(b,a):null},statics:{startWith:function(a,b){return 0===a.indexOf(b)}},initComponent:function(){Ext.apply(this,{validationRules:{},readOnly:!0,eventResizeHandles:"none",resourceStore:Ext.create("Ext.data.Store",{model:"Sch.model.Resource",autoLoad:!1}),eventStore:Ext.create("Sch.data.EventStore",{model:"apex.csi.SaveOrderEvent",autoLoad:!1}),width:600,height:200,
viewPreset:"hourAndDayNoHeader",columns:[{header:"Sobject",width:200,dataIndex:"Name"}],listeners:{afterrender:function(a){a.editorPanel=apex.csi.LogViewer.findEditorPanel(a,"logviewer");a.editorPanel.saveorder=a},eventclick:function(a,b,c,d){apex.csi.EventNode.currentDetailWindow&&apex.csi.EventNode.currentDetailWindow.hide();if(a=b.data.eventNode.getDetailWindow())a.show(),apex.csi.EventNode.currentDetailWindow=a}}});this.callParent()}},function(){Sch.preset.Manager.registerPreset("hourAndDayNoHeader",
{timeColumnWidth:60,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"DAY",defaultSpan:12,timeResolution:{unit:"MINUTE",increment:15},headerConfig:{middle:{unit:"HOUR",renderer:function(a,b,c){return""}}}})});Ext.define("apex.csi.Saveorder",{extend:"Ext.Panel",alias:"widget.saveorder",initComponent:function(){Ext.apply(this,{layout:"fit",items:[{xtype:"saveordergrid"}]});this.callParent()}});
Ext.define("apex.csi.SourceListPanel",{extend:"Ext.grid.Panel",alias:"widget.sourcelistpanel",loadSources:function(a){var b,e={};for(b=0;b<a.length;b++){var c=a[b].get("file");if(c){if(e[c])d=e[c];else{var d={name:c,iterations:{}};e[c]=d}a[b].get("lineNumber")&&(d.iterations[a[b].get("lineNumber")]?d.iterations[a[b].get("lineNumber")]++:d.iterations[a[b].get("lineNumber")]=1)}}this.sources=e},initComponent:function(){Ext.apply(this,{listeners:{afterrender:function(a){a.editorPanel=apex.csi.LogViewer.findEditorPanel(a,
"logviewer");a.editorPanel.sourceListPanel=a},afterlayout:function(a){a.checkItem=a.editorPanel.getSelectedPanelsMenuItem(3);a.checkItem.sourceListPanel=a},resize:function(a){a.editorPanel.isLoaded&&apex.ide.CsiPerspectiveDefinition.handlePanelResize(a)},itemclick:function(a,b,e,c,d,f){this.editorPanel.highlight(this)}},store:Ext.create("Ext.data.Store",{proxy:{type:"ajax",url:"/servlet/debug/apex/ApexCSIJsonServlet",reader:{type:"json",root:"sources"}},fields:"key name displayName inlined retrieved isSystem usage".split(" "),
idProperty:"key",autoLoad:!1,listeners:{load:function(a){apex.ide.IDE.incrementProgress("Loaded source list")}}}),columns:[{itemId:"Key",dataIndex:"key",renderer:"htmlEncode"},{header:"Name",dataIndex:"name",renderer:"htmlEncode"},{header:"Display Name",dataIndex:"displayName"},{header:"Inlined",dataIndex:"inlined"},{header:"Is System",dataIndex:"isSystem"},{header:"Usage #",dataIndex:"usage"}]});this.callParent()}});
(function(){function k(a,c){var b=a.sourcePanel.editorPanel.logPanel.getSelectionModel().getSelection()[0].data.file;if(a.sourcePanel.editorPanel.sourceUrlMap&&a.sourcePanel.editorPanel.sourceUrlMap[b])try{var e=Ext.JSON.decode(a.sourcePanel.editorPanel.sourceUrlMap[b]),d=SfdcDevConsole.Extents[e.type];d&&d.isApiAccessible()&&d.open?d.get("Id",ApiUtils.to18CharId(e.id),function(a){d.open(a)}):window.open(a.sourcePanel.editorPanel.sourceUrlMap[b])}catch(g){window.open(a.sourcePanel.editorPanel.sourceUrlMap[b])}}
Ext.define("apex.csi.SourceLine",{extend:"Ext.data.Model",fields:["sequenceNumber","source","lineNumber","line","invocations"],idProperty:"sequenceNumber"});Ext.define("apex.csi.SourcePanel",{extend:"Ext.grid.Panel",alias:"widget.sourcepanel",invalidateScrollerOnRefresh:!1,currentFile:"",insertLines:function(a,c){if(c){var b=c.split("\n"),e=this.editorPanel.sourceListPanel.sources[a],d=this.getStore(),g,h=[];for(g=0;g<b.length;g++){var f=Ext.create("apex.csi.SourceLine"),k=k&&e.iterations&&1<e.iterations.length?
e.iterations[g]:0;f.set("source",a);f.set("lineNumber",g);f.set("line",b[g]);f.set("invocations",k);h.push(f)}d.add(h);d.sync()}},selectSourceImpl:function(a,c){var b=this.editorPanel.sourceListPanel.getStore();if(0>b.find("key",a))this.filterAndSelect(a,-1);else{var e=b.getAt(b.find("key",a));if(e.get("retrieved"))this.filterAndSelect(a,c);else{var d=SfdcDevConsole.Extents.getExtentFromId(a);d?(b=Sfdc.String.format("SELECT {sourceField} FROM {entityType} WHERE ID \x3d '{id}'",{entityType:d.entityType,
sourceField:d.sourceField,id:a}),SfdcDevConsole.ToolingAPI.query(b,{continuation:function(b){try{var h;var f=b.records[0][d.sourceField];h=Sfdc.isString(f)?f:Sfdc.isObject(f)?JSON.stringify(f,null,"\t"):"";this.insertLines(a,h);e.set("body",h);this.filterAndSelect(a,c)}finally{e.set("retrieved",!0)}}.bind(this)})):(e.set("retrieved",!0),this.filterAndSelect(a,c))}}},filterAndSelect:function(a,c){var b=this.getStore();this.currentFile!==a&&(b.clearFilter(),b.filter("source",RegExp("^"+Ext.escapeRe(String(a))+
"$")));0>c?b.filterBy(function(a,b){return!1}):c<=b.getCount()?this.getSelectionModel().select(c,!0,!1):this.editorPanel.sourceUrlMap[a]&&Sfdc.log("Invalid line number "+c+" only "+b.getCount()+" in store. Source may be out of date.");this.editorPanel.sourceUrlMap&&this.editorPanel.sourceUrlMap[a]?this.sourceOpenButton.enable():this.sourceOpenButton.disable()},selectSourceBuffer:null,selectSource:function(a,c){this.isVisible()&&(this.selectSourceBuffer||(this.selectSourceBuffer=Ext.Function.createBuffered(function(a,
c){try{this.selectSourceImpl(a,c)}finally{this.setLoading(!1)}},50,this)),this.setLoading(!0),this.selectSourceBuffer(a,c))},openSelectedSource:k,initComponent:function(){Ext.apply(this,{title:"Source",listeners:{afterrender:function(a){a.editorPanel=apex.csi.LogViewer.findEditorPanel(a,"logviewer");a.editorPanel.sourcePanel=a},afterlayout:function(a){a.checkItem=a.editorPanel.getSelectedPanelsMenuItem(3);a.checkItem.sourcePanel=a},resize:function(a){a.editorPanel.isLoaded&&apex.ide.CsiPerspectiveDefinition.handlePanelResize(a)},
itemclick:function(a,c,b,e,d,g){this.editorPanel.highlight(this)}},bbar:{xtype:"toolbar",items:[{text:"Jump",xtype:"button",listeners:{afterRender:function(a){a.sourcePanel=a.ownerCt.ownerCt;a.sourcePanel.jumpButton=a},click:function(a,c){a.sourcePanel.jumpTarget.isValid()&&a.sourcePanel.getSelectionModel().select(parseInt(a.sourcePanel.jumpTarget.getValue(),10)-1)}}},{xtype:"tbspacer",width:5},{width:100,xtype:"textfield",regexp:"[0-9]+",regexpText:"Invalid line number",listeners:{afterRender:function(a){a.sourcePanel=
a.ownerCt.ownerCt;a.sourcePanel.jumpTarget=a},specialkey:function(a,c){c.getKey()==c.ENTER&&a.isValid()&&self.sourcePanel.getSelectionModel().select(parseInt(a.getValue(),10)-1)}}},{xtype:"tbfill"},{text:"Open",xtype:"button",disabled:"true",listeners:{click:k,afterrender:function(a){a.sourcePanel=a.ownerCt.ownerCt;a.sourcePanel.sourceOpenButton=a}}}]},store:Ext.create("Ext.data.Store",{proxy:{type:"ajax",url:"/servlet/debug/apex/ApexCSIJsonServlet",reader:{type:"json",root:"sourceLines"}},model:"apex.csi.SourceLine",
idProperty:"sequenceNumber",autoLoad:!1,listeners:{load:function(a){apex.ide.IDE.incrementProgress("Loaded sources")}}}),columns:[{itemId:"sequenceNumber",dataIndex:"sequenceNumber",hidden:!0},{header:"#",dataIndex:"lineNumber",sortable:!1,width:30,fixed:!0},{header:"source",dataIndex:"source",sortable:!1,width:100,hidden:!0,renderer:"htmlEncode"},{header:LC.getLabel("ApexCSI","count"),itemId:"cnt",dataIndex:"invocations",sortable:!1,width:50,fixed:!0},{header:"",itemId:"srcLineColumn",dataIndex:"line",
sortable:!1,width:1E3,renderer:function(a,c,b,e,d,g){c.attr='ext:qtip\x3d"'+escapeHTML(a)+'"';return"\x3cpre\x3e\x3ccode\x3e"+escapeHTML(a)+"\x3c/code\x3e\x3c/pre\x3e"}}]});this.callParent()}})})();
Ext.define("apex.csi.StackTreePanel",{extend:"Ext.tab.Panel",alias:"widget.stacktreepanel",title:"Stack Tree",initComponent:function(){Ext.apply(this,{items:[{xtype:"executiontree",title:"Execution Tree"},{xtype:"performancetree",title:"Performance Tree"}],listeners:{afterrender:function(a){a.editorPanel=apex.csi.LogViewer.findEditorPanel(a,"logviewer");a.editorPanel.stacktreepanel=a;a.editorPanel.executionTree=a.editorPanel.stacktreepanel.items.get(0);a.editorPanel.executionTree.editorPanel=a.editorPanel;
a.editorPanel.performanceTree=a.editorPanel.stacktreepanel.items.get(1);a.editorPanel.performanceTree.editorPanel=a.editorPanel},afterlayout:function(a){a.checkItem=a.editorPanel.getSelectedPanelsMenuItem(0);a.checkItem.stacktreepanel=a},resize:function(a){a.editorPanel.isLoaded&&apex.ide.CsiPerspectiveDefinition.handlePanelResize(a)},tabchange:function(a,b,c,d){a.editorPanel.highlight(this)}}});this.callParent()}});
Ext.define("apex.csi.TimelineResource",{idProperty:"Id",extend:"Sch.model.Resource",fields:[{name:"Id"},{name:"percent"},{name:"categoryDuration"}]});Ext.define("apex.csi.TimelineEvent",{idProperty:"ResourceId",extend:"Sch.model.Event",fields:[{name:"ResourceId"},{name:"StartDate",type:"date"},{name:"EndDate",type:"date"},{name:"StartMillis"},{name:"EndMillis"},{name:"inScopeStep"},{name:"outScopeStep"},{name:"display"}]});
Ext.define("apex.csi.Timeline",{extend:"Ext.Panel",alias:"widget.timeline",annotate:function(a){a.display=a.ResourceId+" from "+Ext.Date.format(a.StartDate,"H:i:s.u")+" ("+a.inScopeStep+") to "+Ext.Date.format(a.EndDate,"H:i:s.u")+" ("+a.outScopeStep+")"},computeEvents:function(a,b,c,g,h){var d=void 0,f=void 0,e=void 0;a=a.getProxy().getReader().rawData;for(var k=0;k<a.length;k++)if(r=a[k],!(void 0===r.nanosSinceRequestStart||null===r.nanosSinceRequestStart||0>r.nanosSinceRequestStart)){e=r.nanosSinceRequestStart;
f=r.category;if(void 0===f||""===f){if(void 0===d)continue;f=d.category}void 0===d&&(d={Id:c.length,ResourceId:f,StartDate:Ext.Date.add(g,Ext.Date.MILLI,e/1E6),StartMillis:e/1E6,inScopeStep:r.sequenceNumber,category:f,startNanos:e,endNanos:e,name:""},c.push(d));if(f!==d.category){if(null!==c[c.length-1].EndDate&&void 0!==c[c.length-1].EndDate&&1E6<e-c[c.length-1].endNanos){var l={StartDate:c[c.length-1].EndDate,EndDate:Ext.Date.add(g,Ext.Date.MILLI,e/1E6),Cls:"systemOverhead"};h.push(l)}void 0===
b[f]&&(b[f]=0);b[d.category]+=d.endNanos-d.startNanos;b.ALL+=d.endNanos-d.startNanos;d={Id:c.length,ResourceId:f,StartDate:Ext.Date.add(g,Ext.Date.MILLI,e/1E6),StartMillis:e/1E6,inScopeStep:r.sequenceNumber,category:f,startNanos:e,endNanos:e,name:""};c.push(d)}else d.EndDate=Ext.Date.add(g,Ext.Date.MILLI,e/1E6),d.EndMillis=e/1E6,d.endNanos=e,d.outScopeStep=r.sequenceNumber,this.annotate(d)}d.EndDate||(d.EndDate=Ext.Date.add(g,Ext.Date.MILLI,e/1E6),d.EndMillis=e/1E6,d.endNanos=e,d.outScopeStep=r.sequenceNumber,
this.annotate(d));void 0!==f&&(void 0===b[f]&&(b[f]=0),b[f]+=e-d.startNanos,b.ALL+=e-d.startNanos)},setScale:function(a){var b=this.timeline.getEventStore(),c=b.first().data.StartDate,b=b.last().data.EndDate,g=Sch.preset.Manager.getPreset(a),c=g.floor(c),b=g.ceil(b);this.timeline.switchViewPreset(a,c,b)},updateProfile:function(a){var b=[];b.APEX_CODE=0;b.WORKFLOW=0;b.DB=0;b.VALIDATION=0;b.CALLOUT=0;b.VISUALFORCE=0;b.SYSTEM=0;b.ALL=0;var c=[],g=this.editorPanel.requestStartTime;this.timeline.gapStore=
this.timeline.initialConfig.plugins[0].store;var h=[];this.computeEvents(a,b,c,this.editorPanel.requestStartTime,h);a=c[c.length-1].endNanos-c[0].startNanos;Ext.Date.add(g,Ext.Date.MILLI,a/1E6);b=[{Id:"APEX_CODE",percent:100*(b.APEX_CODE/b.ALL),categoryDuration:b.APEX_CODE},{Id:"WORKFLOW",percent:100*(b.WORKFLOW/b.ALL),categoryDuration:b.WORKFLOW},{Id:"DB",percent:100*(b.DB/b.ALL),categoryDuration:b.DB},{Id:"VALIDATION",percent:100*(b.VALIDATION/b.ALL),categoryDuration:b.VALIDATION},{Id:"CALLOUT",
percent:100*(b.CALLOUT/b.ALL),categoryDuration:b.CALLOUT},{Id:"VISUALFORCE",percent:100*(b.VISUALFORCE/b.ALL),categoryDuration:b.VISUALFORCE},{Id:"SYSTEM",percent:100*(b.SYSTEM/b.ALL),categoryDuration:b.SYSTEM}];this.timeline.resourceStore.removeAll(!1);this.timeline.resourceStore.loadData(b,!1);this.timeline.gapStore.loadData(h);h=5E8>=a?"tenMillis":5E9>=a?"hundredMillis":1E10>=a?"second":6E10>a?"tenSeconds":"minute";this.timeline.eventStore.removeAll(!1);0<c.length&&(this.timeline.eventStore.loadData(c,
!1),this.timeline.timelineScale.setValue({scale:h}),this.setScale(h))},initComponent:function(){Ext.apply(this,{layout:"fit",items:[{xtype:"schedulergrid",autoLoad:!1,autoWidth:!0,unstyled:!1,autoScroll:!0,resourceStore:Ext.create("Ext.data.Store",{model:"apex.csi.TimelineResource",autoLoad:!1}),eventStore:Ext.create("Sch.data.EventStore",{model:"apex.csi.TimelineEvent",autoLoad:!1}),plugins:[Ext.create("Sch.plugin.Zones",{store:Ext.create("Ext.data.Store",{model:"Sch.model.Range"})})],readOnly:!0,
eventResizeHandles:"none",enableEventDragDrop:!1,enableDragCreation:!1,stripeRows:!0,enabledHdMenu:!1,listeners:{afterrender:function(a){a.editorPanel=apex.csi.LogViewer.findEditorPanel(a,"logviewer");a.wrapper=a.ownerCt;a.wrapper.editorPanel=a.editorPanel;a.wrapper.timeline=a;a.wrapper.updateProfile(a.editorPanel.logPanel.getStore())},eventclick:function(a,b,c,g){this.editorPanel.logPanel.showMatchText.setValue(Ext.JSON.encode({category:b.data.ResourceId,startStep:b.data.inScopeStep,endStep:b.data.outScopeStep+
1}));this.editorPanel.logPanel.showTheseCheckbox.checked||this.editorPanel.logPanel.showTheseCheckbox.setValue(!0);this.editorPanel.logPanel.filterStepsTask.delay(500)}},tooltipTpl:new Ext.Template("{display}"),eventRenderer:function(a,b,c){c.cls=b.get("Id")+"_bar";return""},bbar:{xtype:"toolbar",autoWidth:!0,items:[{xtype:"radiogroup",fieldLabel:"Scale",width:500,defaultType:"radiofield",listeners:{afterrender:function(a){a.timeline=a.ownerCt.ownerCt;a.timeline.timelineScale=a},change:function(a,
b,c,g){void 0!==this.timeline&&(void 0!==b.scale&&!Ext.isArray(b.scale))&&this.timeline.wrapper.setScale(b.scale)}},items:[{boxLabel:"0.01 Seconds",name:"scale",inputValue:"tenMillis",width:100},{boxLabel:"0.1 Seconds",name:"scale",inputValue:"hundredMillis",width:100},{boxLabel:"1 Seconds",name:"scale",inputValue:"second",width:100},{boxLabel:"10 Seconds",name:"scale",inputValue:"tenSeconds",width:100},{boxLabel:"Minutes",name:"scale",inputValue:"minute",width:100}]}]},columns:[{header:"Category",
dataIndex:"Id"},{header:"Millis",dataIndex:"categoryDuration",renderer:apex.ide.IDE.nanoRenderer,width:70},{header:"%",width:70,dataIndex:"percent",renderer:function(a,b,c,g,h,d){b.attr='align\x3d"right"';return Ext.util.Format.number(a,"000.00%")}}]}]});this.callParent()}},function(){Sch.preset.Manager.registerPreset("tenMillis",{floor:function(a){var b=a.getMilliseconds();return a=Ext.Date.add(a,Ext.Date.MILLI,-(b%10))},ceil:function(a){return Ext.Date.add(this.floor(a),Ext.Date.MILLI,10)},timeResolution:{unit:"MILLI"},
shiftUnit:"MILLI",shiftIncrement:10,headerConfig:{middle:{unit:"MILLI",dateFormat:"H:i:s.u",increment:10}}});Sch.preset.Manager.registerPreset("hundredMillis",{floor:function(a){var b=a.getMilliseconds();return a=Ext.Date.add(a,Ext.Date.MILLI,-(b%100))},ceil:function(a){return Ext.Date.add(this.floor(a),Ext.Date.MILLI,100)},timeResolution:{unit:"MILLI"},shiftUnit:"MILLI",shiftIncrement:100,headerConfig:{middle:{unit:"MILLI",dateFormat:"H:i:s.u",increment:100}}});Sch.preset.Manager.registerPreset("second",
{floor:function(a){return Ext.Date.add(a,Ext.Date.MILLI,-a.getMilliseconds())},ceil:function(a){return Ext.Date.add(this.floor(a),Ext.Date.SECOND,1)},timeResolution:{unit:"MILLI"},shiftUnit:"SECOND",shiftIncrement:1,headerConfig:{middle:{unit:"SECOND",dateFormat:"H:i:s"}}});Sch.preset.Manager.registerPreset("tenSeconds",{floor:function(a){var b=a.getSeconds();a=Ext.Date.add(a,Ext.Date.MILLI,-a.getMilliseconds());return a=Ext.Date.add(a,Ext.Date.SECOND,-(b%10))},ceil:function(a){return Ext.Date.add(this.floor(a),
Ext.Date.SECOND,10)},timeResolution:{unit:"MILLI"},shiftUnit:"SECOND",shiftIncrement:10,headerConfig:{middle:{unit:"SECOND",dateFormat:"H:i:s",increment:10}}});Sch.preset.Manager.registerPreset("minute",{floor:function(a){a=Ext.Date.add(a,Ext.Date.MILLI,-a.getMilliseconds());return a=Ext.Date.add(a,Ext.Date.SECOND,-a.getSeconds())},ceil:function(a){return Ext.Date.add(this.floor(a),Ext.Date.MINUTE,1)},timeResolution:{unit:"MILLI"},shiftUnit:"MINUTE",shiftIncrement:1,headerConfig:{middle:{unit:"MINUTE",
dateFormat:"H:i",increment:1}}})});
Ext.define("apex.csi.VariablePanel",{extend:"Ext.tree.Panel",alias:"widget.variablepanel",addressStore:Ext.create("Ext.data.Store",{proxy:{type:"ajax",url:"/servlet/debug/apex/ApexCSIJsonServlet",reader:{type:"json",root:"heap"}},fields:["location","assignment"],idProperty:"location",url:"/servlet/debug/apex/ApexCSIJsonServlet",autoLoad:!1,listeners:{load:function(a){apex.ide.IDE.incrementProgress("Loaded heap")}}}),staticStore:Ext.create("Ext.data.Store",{proxy:{type:"ajax",url:"/servlet/debug/apex/ApexCSIJsonServlet",
reader:{type:"json",root:"statics"}},fields:"name declarationSequenceNumber type isReference renunciationSequenceNumber assignment".split(" "),idProperty:"location",autoLoad:!1,listeners:{load:function(a){apex.ide.IDE.incrementProgress("Loaded statics")}}}),loadVariableSet:function(a,c,d){if(c.declarationSequenceNumber<=a&&c.renunciationSequenceNumber>=a){var e=d[c.name];void 0===e&&(e={},e.text=c.name,e.variable=c.name,e.value="",e.children=[],d.push(e));if(void 0!==c.assignment)for(d=0;d<c.assignment.length&&
!(c.assignment[d].step>a);d++)if(c.isReference){e.value=c.assignment[d].value;var g=this.addressStore.findExact("location",c.assignment[d].value);if(0>g)break;var g=this.addressStore.getAt(g),h=[],m;for(m=0;m<g.data.assignment.length;m++){var b=g.data.assignment[m];if(b.step>a)break;var f=Ext.JSON.decode(b.value);if("{"==b.value.charAt(0))for(var k in f.value){if("string"==typeof k||"number"==typeof k||"boolean"==typeof k)b=h[k],void 0===b&&(b={},b.text=k,b.variable=k,b.children=[],h[k]=b),b.value=
"object"===typeof f.value[k]?"[object]":f.value[k]}else if(void 0!==b.member)f=h[b.member],void 0===f&&(f={},h[b.member]=f,f.text=b.member,f.variable=b.member),f.value=b.value;else if("["==b.value.charAt(0)){var b=Ext.JSON.decode(b.value),l;for(l=0;l<b.length;l++)f={},h[l]=f,f.text=l,f.variable=l,f.value=Ext.JSON.encode(b[l])}}for(var n in h)h.hasOwnProperty(n)&&e.children.push(h[n])}else g=Ext.JSON.decode(c.assignment[d].value),e.value=g}},loadVariablesImpl:function(a,c){if("FINEST"===this.editorPanel.selectedTraceLevels.APEX_CODE&&
!(void 0===a||null===a||null===a.data.locals)){var d=[],e=a.data.locals,g;for(g=0;g<e.length;g++)this.loadVariableSet(c,e[g],d);this.staticStore.each(function(a){this.loadVariableSet(c,a.data,d)},this);this.getRootNode().removeAll();0===d.length&&(d=[{variable:"\x26lt;empty\x26gt;",value:"None in scope at line"}]);e={children:d};this.getStore().setRootNode(e)}},loadVariablesBuffer:null,loadVariables:function(a,c){this.isVisible()&&(this.loadVariablesBuffer||(this.loadVariablesBuffer=Ext.Function.createBuffered(function(a,
c){try{this.loadVariablesImpl(a,c)}finally{this.setLoading(!1)}},50,this)),this.setLoading(!0),this.loadVariablesBuffer(a,c))},initComponent:function(){Ext.apply(this,{title:"Variables",listeners:{afterrender:function(a){a.editorPanel=apex.csi.LogViewer.findEditorPanel(a,"logviewer");a.editorPanel.variablePanel=a},afterlayout:function(a){a.checkItem=a.editorPanel.getSelectedPanelsMenuItem(4);a.checkItem.variablePanel=a},itemclick:function(a,c,d,e,g,h){c&&this.editorPanel.highlight(this)}},autoScroll:!0,
forceFit:!Ext.isIE,rootVisible:!1,displayField:"variable",store:Ext.create("Ext.data.TreeStore",{fields:["variable","value"]}),columns:[{header:"Variable",dataIndex:"variable"},{header:"Value",dataIndex:"value"}]});this.callParent()}});
(function(){function n(c,b,d){var a=Ext.getCmp("editors");a.suspendActivateEditorTab=!0;try{for(var m=0;m<c.length;m++){var e=c[m],g=e.id,l=e.xtype;if(!SfdcDevConsole.Preferences.get("noLogsOnLoad")||!("logviewer"===l||"rawlogviewer"===l)){var h=d[g];h&&(e.containerMemberId=h.Id);var f=SfdcDevConsole.Extents.getExtentFromId(g);f?f.open(e):apex.ide.Viewer.open(e)}}var k=a.items.length;b&&0<=b&&b<k?a.setActiveTab(b):0<k&&b>=k?a.setActiveTab(k-1):0<k&&a.setActiveTab(0)}finally{a.suspendActivateEditorTab=
!1,a.getActiveTab()&&a.getActiveTab().fireEvent("load")}}function p(c,b){apex.ide.Container.getOrCreateContainer(apex.ide.IDE.workspaceId,function(d,a){apex.ide.IDE.containerId=d;SfdcDevConsole.ToolingAPI.query("SELECT Id, ContentEntityId from MetadataContainerMember WHERE MetadataContainerId \x3d'"+d+"'",{continuation:function(a){for(var e={},g={},l=a.size,h=0;h<l;h++){var f=a.records[h];e[f.ContentEntityId]=f;g[f.ContentEntityId]=f}for(a=0;a<c.length;a++)delete g[ApiUtils.to18CharId(c[a].id)];apex.ide.Container.deleteContainerMembersNoCompile(d,
g);b(e);apex.ide.IDE.historyLock=!1}})})}apex.ide.IDE.on("workspaceLoaded",function(c){apex.ide.IDE.clearHistory();apex.ide.IDE.historyLock=!0;var b=[],d=void 0;Sfdc.isObject(c)&&(b=c.panels,d=c.editorTab,void 0===b&&(b=c));apex.ide.IDE.authorApex||apex.ide.IDE.authorVisualforce?p(b,function(a){n(b,d,a)}):n(b,d,{})})})();
Ext.define("apex.execanon.ExecuteAnonymous",{extend:"Ext.panel.Panel",alias:"widget.execanoneditor",editorXType:"ux-codemirror",mode:{name:"apex",execAnon:!0},initialized:!1,getSymbolTableFromCache:function(){},execAnon:function(a,b,c){var d=this,e=apex.execanon.ExecuteAnonymous.getAnonymousWindow(),f=function(a,b,g){var h=b;if(c){var f=d.editor.codeEditor.getCursor("from"),k=f.ch,h=h+f.line;1===b&&(g+=k)}Ext.Msg.alert(LC.getLabel("DeveloperConsole","ExecuteAnonError"),"Line: "+h+", Column: "+g+"\x3cbr /\x3e"+
a,function(){e.show();e.resumeEvents();e.focus()})};!a||Sfdc.isEmpty(Sfdc.String.trim(a))?f("No code was entered. Enter the Apex code to execute and try again.",1,1):(e.suspendEvents(!1),e.hide(),apex.ide.IDE.executeAnonymous(a,d.openLogButton.checked,function(a){d.ownerCt.hide();apex.execanon.ExecuteAnonymous.save(d.editor.getValue())},function(a,b,c){f(a,b,c)}),apex.execanon.ExecuteAnonymous.save(d.editor.getValue()))},changeOpenLogPref:function(a,b){apex.execanon.ExecuteAnonymous.openLog=b},finishedLoading:function(a){var b=
a.ownerCt.ownerCt;b.editor=a;a.setValue(apex.execanon.ExecuteAnonymous.get());a=a.codeEditor;a.editorInfo=b;SfdcDevConsole.Core.Autocomplete.Apex.getInstance(a)},focus:function(){this.editor&&this.editor.focus()},initComponent:function(){Ext.apply(this,{id:"ExecAnon",layout:"border",loaded:!1,preventHeader:!0,bbar:[{xtype:"tbfill"},{boxLabel:"Open Log",id:"openLogAfterExec",xtype:"checkboxfield",listeners:{afterrender:function(a){a.ownerCt.ownerCt.openLogButton=a;a.execAnonWindow=a.ownerCt.ownerCt;
a.setValue(apex.execanon.ExecuteAnonymous.openLog)},change:this.changeOpenLogPref}},{xtype:"tbspacer",width:10},{text:"Execute",listeners:{afterrender:function(a){a.ownerCt.ownerCt.execButton=a;a.execAnonWindow=a.ownerCt.ownerCt},click:function(a){a.execAnonWindow.execAnon(a.execAnonWindow.editor.getValue())}}},{text:"Execute Highlighted",id:"executeHighlightedButton",listeners:{afterrender:function(a){a.ownerCt.ownerCt.execHighlightedButton=a;a.execAnonWindow=a.ownerCt.ownerCt},click:function(a){var b=
a.execAnonWindow.editor.getSelection();0>=b.length?Ext.Msg.alert("Error","Nothing is selected"):a.execAnonWindow.execAnon(b,!1,!0)}}}],items:[{region:"center",xtype:"panel",layout:"fit",items:[{xtype:this.editorXType,mode:this.mode,enableKeyEvents:!0,listeners:{initialized:this.finishedLoading},getAddons:function(){return{extraKeys:{F11:function(a){a.setOption("fullScreen",!a.getOption("fullScreen"))},Esc:function(a){a.getOption("fullScreen")&&a.setOption("fullScreen",!1)},"Ctrl-H":function(a){var b=
a.findMatchingBracket(a.getCursor());b.match&&a.setCursor(b.to)}},matchBrackets:!0,autoCloseBrackets:!0,foldGutter:{rangeFinder:new CodeMirror.fold.combine(CodeMirror.fold.brace,CodeMirror.fold.comment)}}}}]}]});this.callParent()},statics:{openLog:!1,execAnonCode:null,get:function(){return this.execAnonCode?this.execAnonCode:""},save:function(a){this.execAnonCode=a},defaultErrorFunction:function(a){Ext.getCmp("anonymousError").setValue(a);Ext.getCmp("anonymousError").show();apex.csi.LogBrowser.anonymousWindow.doLayout();
apex.csi.LogBrowser.anonymousWindow.show()},externalAnonymousWindow:null,openExternalAnonymousWindow:function(){if(!this.externalAnonymousWindow||this.externalAnonymousWindow.closed){var a=Ext.getCmp("apexCSIViewport");this.externalAnonymousWindow=window.open(window.location.protocol+"//"+window.location.host+"/_ui/common/apex/debug/ApexExecAnon","ApexExecAnon","height\x3d"+a.getHeight()+",width\x3d"+a.getWidth()+",modal\x3dyes,alwaysRaised\x3dyes")}else this.externalAnonymousWindow.focus()},anonymousWindow:null,
getAnonymousWindow:function(){null===this.anonymousWindow&&(this.anonymousWindow=new Ext.Window({animateElement:"anonymousBody",title:"Enter Apex Code",layout:"fit",width:Math.floor(Ext.getCmp("apexCSIViewport").getWidth()/2),height:Math.floor(Ext.getCmp("apexCSIViewport").getHeight()/2),closeAction:"hide",bodyStyle:"background: #fff;",focus:function(){this.items.items[0].focus()},tools:[{type:"toggle",id:"openExternalEditorToolButton",tooltip:"Open in new window",handler:function(a,b,c){apex.execanon.ExecuteAnonymous.save(this.execWindow.editor.getValue());
apex.execanon.ExecuteAnonymous.openExternalAnonymousWindow();apex.execanon.ExecuteAnonymous.anonymousWindow.hide()},listeners:{afterrender:function(a){a.execWindow=a.ownerCt.ownerCt.items.items[0]}}}],listeners:{show:function(a){var b=a.items.get(0).editor;b&&(b.getValue&&b.getValue()!==apex.execanon.ExecuteAnonymous.get())&&b.setValue(apex.execanon.ExecuteAnonymous.get());(a=a.items.get(0).openLogButton)&&a.setValue(apex.execanon.ExecuteAnonymous.openLog)}},items:[{xtype:"execanoneditor",id:"execanoneditor"}]}));
return this.anonymousWindow},open:function(){this.externalAnonymousWindow&&!this.externalAnonymousWindow.closed?this.externalAnonymousWindow.focus():this.getAnonymousWindow().show()},close:function(a){this.externalAnonymousWindow?(this.externalAnonymousWindow.close(),this.externalAnonymousWindow=null):this.anonymousWindow&&this.anonymousWindow.hide()}}},function(){apex.ide.IDE.on("workspaceLoaded",function(a){if(apex.ide.IDE.authorApex&&apex.ide.IDE.hasApex){var b=apex.execanon.ExecuteAnonymous;b.openLog=
a.openLog?a.openLog:!1;(a=a.execAnonCode)||(a="");b.save(a);apex.ide.IDE.lastExecuteAnon=a;if(b.externalAnonymousWindow&&!b.externalAnonymousWindow.closed){var c=b.externalAnonymousWindow.Ext.getCmp("ExecAnon");c.editor.setValue(a);c.openLogButton.setValue(b.openLog)}else b.getAnonymousWindow().items.get(0).editor&&(b.getAnonymousWindow().items.get(0).editor.setValue(a),b.getAnonymousWindow().items.get(0).openLogButton.checked=b.openLog)}})});
Ext.define("SfdcDevConsole.BufferedMemoryProxy",{extend:"Ext.data.proxy.Memory",alias:"proxy.bufferedmemoryproxy",read:function(a,c,b){var e=this.getReader().read(this.data);if(a&&a.filters&&0<a.filters.length){var d=new Ext.util.MixedCollection;d.addAll(e.records);e.records=d.filter(a.filters).getRange();e.count=e.records.length;e.total=e.records.length;e.totalRecords=e.records.length}Ext.apply(a,{resultSet:e});a.setCompleted();a.setSuccessful();Ext.callback(c,b||this,[a])},reader:{type:"json",root:"steps"},
removeById:function(a){for(var c=this.data,b=c.length;b--;)if(c[b].Id===a){c.splice(b,1);break}},sortRawData:function(a){if(this.data&&this.data.length&&a&&a.direction&&a.property){var c=a.direction,b=a.property;for(a=0;a<this.data.length;a++)if(!this.data[a].hasOwnProperty(b))return;var e=function(a,c,b){a[b]=a[b]?a[b]:"";c[b]=c[b]?c[b]:"";return Sfdc.isNumber(a[b])||Sfdc.isNumber(c[b])?+a[b]-+c[b]:a[b].toLowerCase().localeCompare(c[b].toLowerCase())};"ASC"===c?this.data.sort(function(a,c){return e(a,
c,b)}):"DESC"===c&&this.data.sort(function(a,c){return e(c,a,b)})}}});
Ext.define("SfdcDevConsole.BufferedMemoryStore",{extend:"Ext.data.Store",buffered:!0,proxy:"bufferedmemoryproxy",pageSize:1E6,remoteFilter:!0,fetched:!1,remoteSort:!0,filterBy:function(a,c){c&&a.bind(c);this.filter([a])},getRecords:function(){return!this.pageMap||!this.pageMap.map||!this.pageMap.map[1]?[]:this.pageMap.map[1].value},setRecords:function(a){this.getProxy().data=a;this.load()},add:function(a){this.getProxy().data.push(a);this.callParent([a])},removeById:function(a){for(var c=this.getRecords(),
b=c.length;b--;)if(c[b].data.Id===a){this.remove(c[b]);c.splice(b,1);break}this.getProxy().removeById(a)},findRecords:function(a,c){for(var b=this.getRecords(),e=b.length,d=[],f=0;f<e;f++)b[f].get(a)===c&&d.push(b[f].data);return d},hasCachedRecord:function(a,c){for(var b=this.getRecords(),e=b.length,d=0;d<e;d++)if(b[d].get(a)===c)return!0;return!1},getCachedRecordIndex:function(a,c){for(var b=this.getRecords(),e=b.length,d=0;d<e;d++)if(b[d].get(a)===c)return d;return-1},getCachedCount:function(){return this.getRecords().length},
cancelAllPrefetches:function(){},sort:function(a){this.getProxy().sortRawData(a);this.callParent(arguments)}});
Ext.define("SfdcDevConsole.BufferedMemoryGrid",{extend:"Ext.grid.Panel",alias:"widget.bufferedmemorygrid",selectRow:function(a,c,b){var e=this.getStore(),d=-1;Sfdc.isString(a)?d=e.findExact(a,c):Sfdc.isNumber(a)&&(d=a);if(0>d){d=e.getCachedRecordIndex(a,c);if(0>d)return!1;var f=Math.round(e.getRange().length/2-1);e.guaranteeRange(d-f,d+f);d=e.findExact(a,c);if(0>d)return!1}this.getView().focusRow(d);this.getSelectionModel().select(d,!1,b);return!0},initComponent:function(){if(!(this.getStore()instanceof
SfdcDevConsole.BufferedMemoryStore))throw"Can not initialize a buffered grid without a buffered store";this.callParent()}});
SfdcDevConsole.Events.EventDispatcher.register("executed:new");SfdcDevConsole.Events.EventDispatcher.register("executed:select");Ext.define("Executed",{extend:"Ext.data.Model",fields:[{name:"executed"}]});
Ext.define("apex.editor.ExecuteHistoryPanel",{extend:"Ext.grid.GridPanel",alias:"widget.executehistory",id:"executehistory",title:"History",plugins:Ext.create("apex.plugins.GridCellPopup"),MAX_ENTRIES:10,forceFit:!0,columns:[{header:"Executed",dataIndex:"executed",renderer:escapeHTML}],listeners:{itemclick:function(c,a,b,d,e,f){SfdcDevConsole.Events.EventDispatcher.fire("executed:select",[a])}},initComponent:function(){this.store=Ext.create("Ext.data.Store",{model:"Executed"});this.callParent()}},
function(){SfdcDevConsole.Events.EventDispatcher.on("executed:new",function(c,a){var b=Ext.getCmp("executehistory");a&&-1===b.store.findExact("executed",a)&&(b.store.getCount()>=b.MAX_ENTRIES&&b.store.removeAt(0),b.store.add({executed:a}))});apex.ide.IDE.on("buildingWorkspace",function(c){var a=[];Ext.getCmp("executehistory").store.each(function(b){a.push({executed:b.data.executed})});c.executed=a});apex.ide.IDE.on("workspaceLoaded",function(c){(c=c.executed)&&Ext.getCmp("executehistory").store.loadData(c)})});
(function(){function k(a){var b=SfdcDevConsole.Extents.getExtentFromType(a.data.type).getExtension(a);return b?a.data.Name+"."+b:a.data.Name}function v(a){var b=SfdcDevConsole.Core.Search.getWildcardFilterFunction(a);return function(a){return b(k(a))}}function p(){c.setLoading(!0);Ext.suspendLayouts();var a=c.getStore();a.suspendEvents(!0);try{a.clearFilter();var b=g.getValue();0<b.length&&a.filter(v(b))}finally{a.resumeEvents(),Ext.resumeLayouts(!0),c.setLoading(!1)}0<a.getCount()&&c.getSelectionModel().select(a.getAt(0))}
function w(){function a(){c.getStore().setRecords(h);d.setLoading(!1);var a=f.ownerCt;a.removeAll();f=a.add({xtype:"textfield",readOnly:!0,height:m,width:"100%"});p();g.focus(!0,300)}function b(){var b=!0;SfdcDevConsole.Extents.each(function(a){e(a)&&!n[a.entityType]&&(b=!1)});b&&a()}function e(a){return a.displayName&&a.isApiAccessible()&&Sfdc.isFunction(a.open)}var n={},h=[];d.setLoading(!0);var l=0;SfdcDevConsole.Extents.each(function(a){e(a)&&l++});var l=2*l,k=0;SfdcDevConsole.Extents.each(function(a){e(a)&&
(n[a.entityType]=!1,a.getRecords(function(e){f.updateProgress(++k/l,LC.getLabel("DeveloperConsole","Retrieved",a.entityType));if(e)for(var c=e.length,d=0;d<c;d++)e[d].Name&&h.push(Sfdc.apply(e[d],{Id:SfdcDevConsole.Extents.getTableEnumOrId(e[d]),type:a.entityType},!0));n[a.entityType]=!0;f.updateProgress(++k/l,LC.getLabel("DeveloperConsole","OpenResourceIndexed",a.entityType));b()}))})}function q(a,b,e){1===b.length?f.setValue(b[0].data.Id+" "+b[0].data.NamespacePrefix):0<b.length?f.setValue(LC.getLabel("DeveloperConsole",
"Selected",b.length)):f.setValue("")}function x(){var a={xtype:"bufferedmemorygrid",store:new SfdcDevConsole.BufferedMemoryStore({autoDestroy:!0,fields:[{name:"Id",type:"string"},{name:"NamespacePrefix",type:"string"},{name:"Name",type:"string"},{name:"ContentType",type:"string"},{name:"type",type:"string"},{name:"AuraDefinitionBundleId",type:"string"},{name:"DefType",type:"string"},{name:"Format",type:"string"},{name:"ScriptType",type:"string"}]}),hideHeaders:!0,flex:1,columns:[{flex:1,sortable:!1,
renderer:function(a,e,c){return k(c)}}],selModel:{mode:"MULTI",listeners:{selectionchange:q}},listeners:{afterrender:function(){c.getEl().addListener("keyup",function(a){a=a.keyCode?a.keyCode:a.which;a===r&&c.getSelectionModel().isSelected(c.getStore().getAt(0))?g.focus():a===s?h():q(c,c.getSelectionModel().getSelection())})},itemdblclick:function(){h()}}};c=d.add(a);d.resultGrid=c;SfdcDevConsole.Events.EventDispatcher.on("extent:created",function(a,e,d){c.getStore().add(Sfdc.apply(d,{Id:SfdcDevConsole.Extents.getTableEnumOrId(d),
type:e.entityType},!0))});SfdcDevConsole.Events.EventDispatcher.on("extent:deleted",function(a,e){c.getStore().removeById(e)})}function y(){d.add({xtype:"panel",width:t,height:m,layout:"fit",items:{xtype:"progressbar",text:LC.getLabel("DeveloperConsole","OpenResourceLoading"),height:m,width:"100%",listeners:{afterrender:function(a){f=a;a=f.getHeight();var b=f.el.child(".x-progress-bar"),e=f.el.child(".x-progress-text-back"),c=f.el.child(".x-progress-bar .x-progress-text");b.setHeight(a);e.setHeight(a);
e.setStyle("margin-top",parseInt(a/7,0)+"px");c.setHeight(a);c.setStyle("margin-top",parseInt(a/7,0)+"px");w()}}}})}function h(){var a=c.getSelectionModel().getSelection();if(0<a.length){var b;for(b=0;b<a.length;b++)SfdcDevConsole.Extents.getExtentFromType(a[b].data.type).open(a[b])}else Ext.Msg.alert(errorTitle,LC.getLabel("DeveloperConsole","OpenErrorNothingSelected"));d.hide()}function z(){var a=[{xtype:"tbfill"},{text:LC.getLabel("DeveloperConsole","OpenButton"),handler:function(){h()}}],b=[{xtype:"textfield",
width:"100%",height:25,enableKeyEvents:!0,emptyText:LC.getLabel("DeveloperConsole","OpenResourceEmptySearchText"),listeners:{keyup:function(a,b){b.getCharCode()===A||b.getCharCode()===r?c.getView().focus():b.getCharCode()===s?(c.getSelectionModel().select(0),h()):b.getCharCode()===Ext.EventObject.TAB||b.getCharCode()===Ext.EventObject.SHIFT?b.stopEvent():B.delay(150)},afterrender:function(a){g=a;Ext.create("Ext.tip.ToolTip",{target:g.el,hideDelay:6E4,html:'Use \x3ci\x3ere:Regexp\x3c/i\x3e to match entity names.\x3cbr /\x3eExample: \x3ci\x3ere:Account.*(apexpage|apexclass)\x3c/i\x3e will search for all classes and pages that start with the word "Account".'})}}}];
d=Ext.create("Ext.window.Window",{title:LC.getLabel("DeveloperConsole","OpenResource"),height:500,width:t,layout:"vbox",closeAction:"hide",tbar:b,bbar:a});x();y();new Ext.util.KeyMap({target:d,key:Ext.EventObject.TAB,ctrl:!1,shift:!0,fn:function(){g.focus();g.selectText()},defaultEventAction:"stopEvent"});d.getRecord=function(a){a=c.getStore().findRecords("Id",a);return 0<a.length?a[0]:null}}var A=40,s=13,r=38,t=400,m=30,d=null,c=null,g=null,f=null,B=new Ext.util.DelayedTask(function(){p()});SfdcDevConsole.openResource=
function(){d||z();d.show();var a=Ext.getCmp("editors").getActiveTab();a&&a.getSelection&&g.setValue(a.getSelection());g.focus(!0,300);return d};new Ext.util.KeyMap(document,[{key:"O",ctrl:!0,shift:!0,fn:SfdcDevConsole.openResource,defaultEventAction:"stopEvent"}]);var u=[];u.push({text:SfdcDevConsole.Menu.menuEntryWithShortcut({entry:LC.getLabel("DeveloperConsole","OpenResource"),ctrl:!0,shift:!0,character:"O"}),handler:SfdcDevConsole.openResource});SfdcDevConsole.Menu.add(LC.getLabel("DevConsoleMenuItem",
"File"),u,{index:2})})();
Ext.define("apex.ide.window.pinnable",{extend:"Ext.window.Window",alias:"widget.pinnableWindow",pinned:!1,_closeIfNotPinned:function(){this.pinned||this.hide()},tools:[{type:"unpin",tooltip:LC.getLabel("Tooltips","Pin"),handler:function(c,d,b,a){"pin"===a.type?(a.setType("unpin"),b.ownerCt.pinned=!1):(a.setType("pin"),b.ownerCt.pinned=!0)}}]});
(function(){Ext.define("SfdcDevConsole.PreferenceModel",{extend:"Ext.data.Model",fields:[{name:"label",type:"string"},{name:"name",type:"string"},{name:"value"},{name:"description"}]});var e=Ext.create("Ext.data.Store",{autoDestroy:!0,model:"SfdcDevConsole.PreferenceModel",proxy:{type:"memory"},sorters:[{property:"label",direction:"ASC"}]}),d=null;Ext.define("SfdcDevConsole.panel.PreferencePanel",{extend:"Ext.grid.Panel",alias:"widget.preferences",store:e,columns:[{header:"Name",dataIndex:"label",
flex:2,renderer:function(b,c,a){c.tdAttr="data-qtip\x3d'"+a.data.description+"'";return b}},{header:"Value",dataIndex:"value",flex:1,renderer:escapeHTML,getEditor:function(b){var c=b.data.value,a=SfdcDevConsole.Preferences.getPreferenceInfo(b.data.name);b={};Sfdc.isFunction(a.change)&&(b.listeners={change:a.change});Sfdc.isBoolean(c)?Sfdc.apply(b,{xtype:"checkbox",style:"text-align : left"}):Sfdc.isNumber(c)?Sfdc.apply(b,{xtype:"numberfield",align:"left",allowBlank:!1,minValue:0,maxValue:1E5}):Sfdc.isString(c)&&
a.values?(c=Ext.create("Ext.data.Store",{fields:["name"],data:Sfdc.Array.map(a.values(),function(a){return{name:a}})}),Sfdc.apply(b,{xtype:"combobox",store:c,queryMode:"local",displayField:"name",valueField:"name"})):Sfdc.apply(b,{allowBlank:!1,align:"left"});return b}}],initComponent:function(){Ext.apply(this,{selModel:{mode:"NONE"},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,getEditor:function(b,c){var a=c.getEditor(b);if(!a)return!1;a instanceof Ext.grid.CellEditor?a.ownerCt=
this.grid:a=new Ext.grid.CellEditor({field:a,ownerCt:this.grid});a.editingPlugin=this;a.isForTree=this.grid.isTree;a.on({scope:this,specialkey:this.onSpecialKey,complete:this.onEditComplete,canceledit:this.cancelEdit});return a}})]});this.callParent()},bbar:[{text:LC.getLabel("DeveloperConsole","SaveButton"),handler:function(){var b=e.getModifiedRecords(),c={};Sfdc.Array.forEach(b,function(a){c[a.data.name]=a.data.value});SfdcDevConsole.Events.EventDispatcher.fire("preferences:save",[c]);d.hide()}}]});
SfdcDevConsole.Preferences.open=function(){d||(d=Ext.create("Ext.window.Window",{title:LC.getLabel("DevConsolePrefs","title"),height:500,width:400,layout:"fit",closeAction:"hide",items:{xtype:"preferences"},listeners:{show:function(b){e.loadData(SfdcDevConsole.Preferences.getPreferenceInfo())}}}));d.show()}})();
SfdcDevConsole.Events.EventDispatcher.register("problems:clear");SfdcDevConsole.Events.EventDispatcher.register("problems:new");SfdcDevConsole.Events.EventDispatcher.register("problems:selected");Ext.define("Problem",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"fullName"},{name:"lineNumber",type:"int"},{name:"problem"},{name:"componentType"}]});
Ext.define("apex.editor.ProblemsPanel",{extend:"Ext.grid.GridPanel",alias:"widget.problemspanel",title:"Problems",forceFit:!0,constructor:function(a){this.store=Ext.create("Ext.data.Store",{model:"Problem"});SfdcDevConsole.Events.EventDispatcher.on("problems:new",function(a,c){this.loadProblems(c)},this);SfdcDevConsole.Events.EventDispatcher.on("problems:clear",function(a,c){this.clearProblems(c)},this);this.plugins=Ext.create("apex.plugins.GridCellPopup");this.callParent(arguments)},listeners:{itemclick:function(a,
b){b&&b.data&&SfdcDevConsole.Events.EventDispatcher.fire("problems:selected",[b.data])}},columns:[{header:"id",dataIndex:"id",hidden:!0},{header:"extent",dataIndex:"componentType",hidden:!0},{header:"Name",maxWidth:300,dataIndex:"fullName"},{header:"Line",maxWidth:75,dataIndex:"lineNumber"},{id:"problemColumn",header:"Problem",dataIndex:"problem"}],findProblemsWithId:function(a){return this.store.queryBy(function(b){return b.data.id===a?!0:!1})},clearProblemsWithId:function(a){a=this.findProblemsWithId(a);
for(var b=0;b<a.items.length;b++)this.store.remove(a.items[b])},loadProblems:function(a){if(Sfdc.isArray(a)){for(var b=0;b<a.length;b++)this.clearProblemsWithId(a[b].id);this.store.loadData(a,!0)}this.refreshTitle()},clearProblems:function(a){if(Sfdc.isArray(a))for(var b=0;b<a.length;b++)this.clearProblemsWithId(a[b]);else this.store.removeAll();this.refreshTitle()},refreshTitle:function(){var a="Problems";0<this.store.getCount()&&(a=Sfdc.userAgent.isIE7||Sfdc.userAgent.isIE8?a+('\x3cspan style\x3d"color:red"\x3e '+
this.store.getCount()+"\x3c/span\x3e"):a+('\x3cdiv class\x3d"problemCircle"\x3e\x3cspan\x3e '+this.store.getCount()+"\x3c/span\x3e\x3c/div\x3e"));this.setTitle(a)}});
Ext.define("SfdcDevConsole.panel.VersionSettingsPanel",{extend:"Ext.grid.Panel",alias:"widget.versionsettings",border:!1,hideHeaders:!0,initComponent:function(){Ext.apply(this,{selModel:{mode:"NONE"},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,getEditor:function(b,c){var a=c.getEditor(b);if(!a)return!1;a instanceof Ext.grid.CellEditor?a.ownerCt=this.grid:a=new Ext.grid.CellEditor({field:a,ownerCt:this.grid});a.editingPlugin=this;a.on({scope:this,specialkey:this.onSpecialKey,
complete:this.onEditComplete,canceledit:this.cancelEdit});return a}})]});this.callParent()},columns:[{header:"Name",dataIndex:"name",flex:2},{header:"Value",dataIndex:"value",flex:1,getEditor:function(b){return b.get("versions")&&b.get("versions").length?{xtype:"combo",editable:!1,store:new Ext.data.SimpleStore({fields:["version"],data:Sfdc.Array.map(b.get("versions"),function(b){return[b]})}),displayField:"version",valueField:"version"}:{xtype:"numberfield",align:"left",allowBlank:!0,minValue:0,
maxValue:1E5}}}],store:Ext.create("Ext.data.Store",{autoDestroy:!0,fields:["id",{name:"name",type:"string"},{name:"type",type:"string"},{name:"value"},{name:"versions"}],proxy:{type:"memory"}})});
Ext.define("SfdcDevConsole.panel.VfSettingsPanel",{extend:"Ext.grid.Panel",alias:"widget.vfsettings",border:!1,hideHeaders:!0,initComponent:function(){Ext.apply(this,{selModel:{mode:"NONE"},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,getEditor:function(b,c){var a=c.getEditor(b);if(!a)return!1;a instanceof Ext.grid.CellEditor?a.ownerCt=this.grid:a=new Ext.grid.CellEditor({field:a,ownerCt:this.grid});a.editingPlugin=this;a.on({scope:this,specialkey:this.onSpecialKey,complete:this.onEditComplete,
canceledit:this.cancelEdit});return a}})]});this.callParent()},columns:[{header:"Name",dataIndex:"name",flex:2},{header:"Value",dataIndex:"value",flex:1,getEditor:function(b){b=typeof b.data.value;return"boolean"===b?{xtype:"checkbox",style:"text-align : left"}:"number"===b?{xtype:"numberfield",align:"left",allowBlank:!1,minValue:0,maxValue:1E5}:{allowBlank:!1,align:"left"}},renderer:escapeHTML}],store:Ext.create("Ext.data.Store",{autoDestroy:!0,fields:["id",{name:"name",type:"string"},{name:"type",
type:"string"},{name:"value"}],proxy:{type:"memory"}})});
Sfdc.provide("SfdcDevConsole.Visualforce.viewstate.Util",{prefix:"Visualforce Viewstate: ",setMetadata:function(a){var b=Sfdc.JSON.parseSafe(a,!1);!b||1!=b.length?apex.ide.IDE.sendGack("Devconsole received invalid viewstate metadata from Visualforce page. Viewstate Metadata: "+a):(b=b[0],b.queryParam?this.handlePreviewWindowQueryParam(b.queryParam,b.qualifiedPageName):(apex.ide.IDE.isDev&&Sfdc.log("Viewstate Metadata Received from VF page: "+b.displayName),Ext.getCmp("ViewState").handleNewData(a)))},
handlePreviewWindowQueryParam:function(a,b){for(var c=Ext.getCmp("editors"),d=0;d<c.items.length;d++){var e=c.items.get(d);if("visualforceeditor"===e.xtype&&(e.NamespacePrefix?e.NamespacePrefix+"__"+e.Name:e.Name).toLowerCase()===b.toLowerCase()){e.queryParam=a;break}}},vsiStore:Ext.create("Ext.data.TreeStore",{alias:"widget.vsiStore",fields:"displayName type value viewstateSize percentOfParent isGroupable".split(" "),root:{nodeType:"async",displayName:"View State",name:"View State"},collectionNameRegex:/^([0-9]*-[0-9]*)$/}),
pushChange:function(a,b,c){a.cls=c;Sfdc.isDefAndNotNull(a.changes)||(a.changes=[]);a.changes.push(b)},compareViewstateObjects:function(a,b){if(a.identityCode.toString()===b.identityCode.toString()){"undefined"!==typeof a.value&&("undefined"!==typeof b.value&&a.value.toString()!==b.value.toString())&&this.pushChange(a,"value","highlight-updated");a.viewstateSize!==b.viewstateSize&&this.pushChange(a,"viewStateSize","highlight-updated");"undefined"!==typeof a.count&&a.count!==b.count&&this.pushChange(a,
"count","highlight-updated");if(!1===a.isGroupable&&!Sfdc.isEmpty(a.children))for(var c=0,d=a.children.length;c<d;c++){var e=a.children[c];"Internal"!==e.displayName.toString()&&!1===this.compareViewstateObjects(e,b)&&this.pushChange(e,"new","highlight-new")}return!0}if(!Sfdc.isEmpty(b.children)){c=0;for(d=b.children.length;c<d;c++)if(this.compareViewstateObjects(a,b.children[c]))return!0}return!1}});
Ext.define("visualforce.viewstate.vsi",{extend:"Ext.tree.Panel",title:"View State",alias:"widget.viewstate",columns:[{xtype:"treecolumn",text:"Name",dataIndex:"displayName",width:300,renderer:escapeHTML},{text:"Type",dataIndex:"type",width:275,renderer:escapeHTML},{text:"Value",dataIndex:"value",align:"left",width:275,renderer:escapeHTML},{text:"Size (KB)",dataIndex:"viewstateSize",align:"right",width:95},{text:"% Of Parent",dataIndex:"percentOfParent",align:"right",width:95}],viewConfig:{getRowClass:function(a){return(a=
a.get("cls"))?a:""}},rootVisible:!1,store:SfdcDevConsole.Visualforce.viewstate.Util.vsiStore,useArrows:!0,collectionLimit:20,groupCount:20,listeners:{beforeitemcollapse:function(a,b){if(a.isExpanded){for(var c=a.childNodes.length,d=0;d<c;d++)a.childNodes[d].collapse();return!0}return!1},beforeitemappend:function(a,b,c){c=this.getRootNode();if(a===c)return!0;if(a.hasGroups)return!1;if(a.isGroupNode||b.isGroupNode)return!0;if(a.data.children&&1>a.childNodes.length&&(b=a.data.children,"undefined"!==
typeof a.data.isGroupable&&!0===a.data.isGroupable&&b.length>this.collectionLimit)){c=0;for(var d=b.length;c<d;){var e=a.createNode({displayName:c+"-"+(c+(this.groupCount-1)<b.length?c+(this.groupCount-1):b.length-1),iconCls:"task",leaf:!1});e.isGroupNode=!0;e.data.children=[];for(var f=0;f<this.groupCount;f++){var g=b[c++];if(Sfdc.isEmpty(g))break;e.data.children[f]=g}a.appendChild(e)}a.hasGroups=!0;return!1}return!0},afterItemExpand:function(a){a.expanded||(a.sort(this.sortFunction,!1,!1),a.expanded=
!0)}},sortFunction:function(a,b){var c=function(a){var b=a.data.displayName;return isNaN(b)?!1===a.data.leaf&&null!==a.store.treeStore.collectionNameRegex.exec(b)?(a=b.substring(0,b.indexOf("-")),!isNaN(a)?parseInt(a,10):b):b:parseInt(b,10)},d=c(a),c=c(b);return d<c?-1:d>c?1:0},isNodePresent:function(a,b){return this.getRootNode().findChildBy(function(){return this.data.displayName.toLowerCase()===a.toLowerCase()},null,b)},removeNodes:function(a){var b=this.isNodePresent(a,!1);b&&(this.getRootNode().removeChild(b),
apex.ide.IDE.isDev&&Sfdc.log("On close, removed viewstate node for page: "+a))},isEditorOpen:function(a){for(var b=Ext.getCmp("editors"),c=0;c<b.items.length;c++){var d=b.items.get(c);if("visualforceeditor"===d.xtype&&(d.NamespacePrefix?d.NamespacePrefix+"."+d.Name:d.Name).toLowerCase()===a[0].displayName.toLowerCase())return!0}return!1},handleNewData:function(a){var b=this.getRootNode(),c=Sfdc.JSON.parse(a);if(this.isEditorOpen(c)){var d=this.isNodePresent(c[0].displayName,!1);if(d){var e=Sfdc.JSON.parse(d.vsMetadataString);
SfdcDevConsole.Visualforce.viewstate.Util.compareViewstateObjects(c[0],e[0]);e=b.indexOf(d);b.removeChild(d);d=b.insertChild(e,c[0]);d.vsMetadataString=a;apex.ide.IDE.isDev&&Sfdc.log("Viewstate node updated for page: "+c[0].displayName)}else d=b.insertChild(b.childNodes.length,c[0]),d.vsMetadataString=a,b.sort(this.sortFunction,!1,!1)}},constructor:function(a){this.callParent(arguments)}});
SfdcDevConsole.Events.EventDispatcher.on("preferences:changed",function(a,b){var c=Ext.getCmp("ViewState");apex.ide.IDE.hasVisualforce&&(c?!b.visualforceViewstateInspector&&!c.tab.isHidden()?(c.getRootNode().removeAll(!0),c.tab.hide(),c.hide()):b.visualforceViewstateInspector&&c.tab.isHidden()&&(c.tab.show(),c.show()):b.visualforceViewstateInspector&&(c=Ext.getCmp("bottomPanel").items.length,Ext.getCmp("bottomPanel").insert(c-2,{id:"ViewState",xtype:"viewstate"})))});
Ext.define("apex.ide.Viewer",{extend:"Ext.Panel",opened:!1,closable:!0,workspace:function(){return{id:this.id,NamespacePrefix:this.NamespacePrefix,Name:this.Name,xtype:this.xtype,extent:this.extent}},canOpen:function(){return!0},hasTabInEditorPanel:function(){return Ext.getCmp("editors").items.contains(this)},initComponent:function(){Sfdc.apply(this,{title:escapeHTML(this.Name),opened:!1,loading:!1});this.addEvents({open:!0,load:!0,afterLoad:!0,failedLoad:!0,afterOpen:!0});this.on("load",function(){if(this.loading)return!1;
this.loading=!0;SfdcDevConsole.Session.keepAlive();this.loadContent()},this);this.on("afterLoad",function(b){this.loading=!1;this.opened||this.fireEvent("afterOpen",b)},this);this.on("failedLoad",function(b){var c=LC.getLabel("DeveloperConsole","LoadFailed",this.displayName);SfdcDevConsole.ToolingAPI.handleFailedRequest(b,c,!0,!0);Ext.getCmp("editors").remove(this)},this);this.on("afterOpen",function(){this.opened=!0;if(!this.hasTabInEditorPanel())return!1},this);this.callParent()},loadContent:function(){var b=
SfdcDevConsole.Extents.getExtentFromId(this.id);if(!b)throw"Non-extent editor must override load content";var c={id:this.id,continuation:function(b){this.fireEvent("afterLoad",b)}.bind(this),failure:function(b){this.fireEvent("failedLoad",b)}.bind(this)};b.load(c)},statics:{open:function(b,c){var d=Ext.getCmp("editors");if(b.id){var a=null,e=Ext.String.escapeRegex(b.id),e=d.items.findIndex("id",RegExp("^"+e+"$"));if(-1===e){a=Ext.ComponentMgr.create(b);if(!a.canOpen())return;d.add(a);d.doLayout()}else a=
d.items.get(e),void 0!==b.line&&(a.cmEditor.clearHighlights(),a.cmEditor.highlightLine(b.line,"CodeMirror-line-highlight-error"),a.coverage&&a.showCoverage(a.coverage));a.methodid=b.methodid;var f=function(a){if(a.ownerCt)try{if(a.opened)"function"===typeof c&&c(a);else{apex.ide.IDE.startProgress(1,"Loading...","Loading view's content","Waiting for response from server...");var d=(new Date).getTime();a.on("afterOpen",function(){for(var e=Ext.getCmp("editors"),g=0,f=0,h=0;h<e.items.length;h++){var k=
e.items.get(h);k.size&&0<k.size&&(g=(k.size-g)/(f++ +1)+g)}apex.ide.IDE.sendPerformanceMetrics("Loaded "+b.xtype,(new Date).getTime()-d,e.items.length,apex.ide.IDE.getOpenTabsInfo(),g);apex.ide.IDE.incrementProgress("Content Loaded");"function"===typeof c&&c(a)});a.fireEvent("load")}}finally{a.un("activate",f)}};if(d.suspendActivateEditorTab)a.on("activate",f);else if(d.setActiveTab(a),a.loading)a.on("afterOpen",function(){c&&c.call&&c(a)});else f(a)}else apex.ide.IDE.sendGack("Trying to open a tab with no id! "+
Sfdc.JSON.stringify(b))}}});
(function(){function l(a,b){function c(a,b){"function"===typeof a?d.push(new Ext.util.Filter({filterFn:a})):d.push(new Ext.util.Filter({root:"data",property:a,value:b}))}var d=[],f=a.showTheseCheckbox.checked,e=a.showMatchText.getValue(),k=a.showCurrentFrameOnlyCheckbox;k.enable(!0);a.showExecutableOnlyCheckbox.checked&&c("isExecutable",!0);a.showDebugOnlyCheckbox.checked&&c("event",apex.csi.LogPanel.USER_DEBUG_STATEMENTS);var m=!1;if(f&&0<e.length)try{if("{"==e.charAt(0)){var g=Ext.JSON.decode(e),
h;for(h in g)if("string"==typeof h&&"startStep"!==h&&"endStep"!==h&&void 0===a.getStore().model.prototype.fields.map[h])throw h;k.disable(!0);c(function(a){for(var b in g)if(g.hasOwnProperty(b)&&g[b])if("startStep"===b){if(a.data.sequenceNumber<g[b])return!1}else if("endStep"===b){if(a.data.sequenceNumber>g[b])return!1}else if(a.data[b]!=g[b])return!1;return!0});m=!0}}catch(l){}m||(f&&c(function(a){return-1<a.data.event.indexOf(e)||-1<a.data.detail.indexOf(e)}),k.checked&&c("frameSequenceNumber",
b));return d}Ext.define("LogLine",{extend:"Ext.data.Model",fields:[{name:"sequenceNumber"},{name:"event"},{name:"detail"},{name:"nanosSinceRequestStart"},{name:"method"},{name:"file"},{name:"lineNumber"},{name:"frameSequenceNumber"},{name:"isExecutable"},{name:"category"},{name:"iteration"}]});Ext.define("LogPanelStore",{extend:"SfdcDevConsole.BufferedMemoryStore",model:"LogLine",listeners:{prefetch:function(a,b,c,d,f){a.fetched||(a.logPanel.editorPanel.isLogLoaded=!0,a.logPanel.editorPanel.saveorder.loadEvents(a.logPanel.editorPanel),
a.logPanel.editorPanel.sourceListPanel.loadSources(b),a.fetched=!0)}}});Ext.define("apex.csi.LogPanel",{extend:"SfdcDevConsole.BufferedMemoryGrid",alias:"widget.logpanel",title:"Execution Log",region:"center",split:!0,loadMask:!0,filterStepsImpl:function(a,b){var c=-1;this.getSelectionModel().hasSelection()&&(c=this.getSelectionModel().getSelection()[0].data.sequenceNumber);var d=l(this,a);this.getStore().clearFilter();0<d.length&&this.getStore().filter(d);0<=c?this.selectRow("sequenceNumber",c,b):
0<this.getStore().getCount()&&this.getSelectionModel().select(0,!1,b)},filterStepsBuffer:null,filterSteps:function(a,b,c){this.isVisible()&&(this.filterStepsBuffer||(this.filterStepsBuffer=Ext.Function.createBuffered(function(a,b,c){try{this.filterStepsImpl(a,b),"function"===typeof c&&c()}finally{this.setLoading(!1)}},400,this)),this.setLoading(!0),this.filterStepsBuffer(a,b,c))},bbar:{itemId:"stepToolBar",xtype:"toolbar",items:[{itemId:"showCurrentFrameOnly",xtype:"checkbox",boxLabel:"This Frame",
listeners:{change:function(a,b,c,d){this.logPanel.filterSteps(this.logPanel.editorPanel.executionStack.store.bottom,!1)},afterrender:function(a){a.logPanel=a.ownerCt.ownerCt;a.logPanel.showCurrentFrameOnlyCheckbox=a}}},{xtype:"tbspacer",width:5},{xtype:"checkbox",boxLabel:"Executable",listeners:{change:function(a,b,c,d){this.logPanel.filterSteps(this.logPanel.editorPanel.executionStack.store.bottom,!1)},afterrender:function(a){a.logPanel=a.ownerCt.ownerCt;a.logPanel.showExecutableOnlyCheckbox=a}}},
{xtype:"tbspacer",width:5},{xtype:"checkbox",boxLabel:"Debug Only",listeners:{change:function(a,b,c,d){this.logPanel.filterSteps(this.logPanel.editorPanel.executionStack.store.bottom,!1)},afterrender:function(a){a.logPanel=a.ownerCt.ownerCt;a.logPanel.showDebugOnlyCheckbox=a}}},{xtype:"tbspacer",width:5},{itemId:"showThese",xtype:"checkbox",boxLabel:"Filter",listeners:{change:function(a,b,c,d){this.logPanel.filterSteps(this.logPanel.editorPanel.executionStack.store.bottom,!1)},afterrender:function(a){a.logPanel=
a.ownerCt.ownerCt;a.logPanel.showTheseCheckbox=a}}},{xtype:"tbspacer",width:5},{xtype:"textfield",width:200,enableKeyEvents:!0,emptyText:"Click here to filter the log",listeners:{keyup:function(a,b){0<a.getValue().length?(a.logPanel.showTheseCheckbox.checked||(a.logPanel.showTheseCheckbox.suspendEvents(!0),a.logPanel.showTheseCheckbox.setValue(!0),a.logPanel.showTheseCheckbox.eventQueue=[],a.logPanel.showTheseCheckbox.resumeEvents()),a.logPanel.filterSteps(a.logPanel.editorPanel.executionStack.getStore().bottom,
!0)):a.logPanel.showTheseCheckbox.checked&&a.logPanel.showTheseCheckbox.setValue(!1);a.focus(!1,10)},afterrender:function(a){a.logPanel=a.ownerCt.ownerCt;a.logPanel.showMatchText=a}}}]},listeners:{afterrender:function(a){a.editorPanel=apex.csi.LogViewer.findEditorPanel(a,"logviewer");a.editorPanel.logPanel=a},afterlayout:function(a){a.checkItem=a.editorPanel.getSelectedPanelsMenuItem(2);a.checkItem.logPanel=a},itemclick:function(a,b,c,d,f,e){this.editorPanel.highlight(this)},itemdblclick:function(a,
b,c,d,f,e){"HEAP_DUMP"==b.data.event?(a=b.data.detail.split("|"),apex.ide.Viewer.open({id:a[1],Name:"Checkpoint "+a[2]+":"+a[4],xtype:"heapdumpviewer"})):void 0!==b.data.event&&void 0!==b.data.detail&&Ext.Msg.show({title:"Log line #"+b.data.sequenceNumber+" details",value:Ext.Date.format(Ext.Date.add(this.editorPanel.requestStartTime,Ext.Date.MILLI,b.data.nanosSinceRequestStart/1E6),"H:i:s:u")+" "+b.data.event+" "+Ext.util.Format.htmlDecode(b.data.detail),buttons:Ext.Msg.OK,minWidth:500,multiline:!0})}},
selModel:{mode:"SINGLE",listeners:{selectionchange:function(a,b,c){1>b.length||(a=a.view.ownerCt.editorPanel,b=b[0].data,a.sourcePanel.selectSource(b.file,b.lineNumber),0>b.lineNumber?a.executionStack.getStore().filterBy(function(a,b){return!1}):a.executionStack.updateTrace(b.frameSequenceNumber,b.sequenceNumber),a.executionTree.expandAndSelectNode(b.frameSequenceNumber),c=a.executionStack.findRecord(b.frameSequenceNumber),a.variablePanel.loadVariables(c,b.sequenceNumber))}}},columns:[{header:"Log Line #",
dataIndex:"sequenceNumber",sortable:!1,width:30,fixed:!1,hidden:!0},{header:LC.getLabel("ApexCSI","count"),dataIndex:"iteration",sortable:!1,width:30,fixed:!1,hidden:!0,renderer:function(a,b,c,d,f,e){return 0===a?"":a}},{header:"Timestamp",dataIndex:"nanosSinceRequestStart",sortable:!1,width:100,fixed:!1,renderer:function(a,b,c,d,f,e){return Ext.Date.format(Ext.Date.add(this.editorPanel.requestStartTime,Ext.Date.MILLI,a/1E6),"H:i:s:u")}},{header:"File",dataIndex:"file",sortable:!1,width:170,fixed:!1,
hidden:!0,renderer:"htmlEncode"},{header:"Method",dataIndex:"method",sortable:!1,width:170,fixed:!1,hidden:!0,renderer:"htmlEncode"},{header:"Event",dataIndex:"event",sortable:!1,width:100,fixed:!1},{header:"Details",dataIndex:"detail",sortable:!1,fixed:!1,width:300,renderer:function(a,b,c,d,f,e){b.attr='title\x3d"'+a+'"';return a}},{header:"Src#",dataIndex:"lineNumber",sortable:!1,width:40,fixed:!1,hidden:!0,renderer:function(a,b,c,d,f,e){return-1==a?"n/a":a+1}},{header:"Category",dataIndex:"category",
sortable:!1,hidden:!0}],initComponent:function(){Ext.apply(this,{store:Ext.create("LogPanelStore"),plugins:Ext.create("apex.plugins.GridColumnResizer",6)});this.callParent();this.filterStepsTask=new Ext.util.DelayedTask(function(){this.filterSteps(this.editorPanel.executionStack.getStore().bottom,!0)},this)},statics:{USER_DEBUG_STATEMENTS:"USER_DEBUG"}})})();
(function(){function t(){null===p&&(p=new Ext.util.DelayedTask(function(){q(!0)}));p.delay(250)}function r(a){d.setLoading(!0);try{var f=e.getSelectionModel().getSelection()[0];SfdcDevConsole.Extents[f.data.metatype].getRecords(function(a){var c=e.getSelectionModel().getSelection()[0];if(f.data.metatype===c.data.metatype){Ext.suspendLayouts();try{var b=d.getStore();Sfdc.isArray(a)||(a=[]);b.setRecords(a);q(!1);void 0!==b.selectedEnumOrId&&(d.selectRowByIdOrName(b.selectedEnumOrId),b.selectedEnumOrId=
void 0)}finally{Ext.resumeLayouts(!0)}d.setLoading(!1)}},!!a)}catch(c){throw d.setLoading(!1),c;}}function s(){return{xtype:"grid",forceFit:!0,layout:"fit",autoScroll:!0,flex:1}}function x(){var a=s();Sfdc.apply(a,{title:LC.getLabel("DevConsoleOpenRepository","EntityType"),columns:[{header:LC.getLabel("DevConsoleOpenRepository","EntityType"),dataIndex:"metatypeName"}],selModel:{mode:"SINGLE",listeners:{selectionchange:function(a,c,b){0!==c.length&&(k=c[0].data.metatype,l.getStore().removeAll(),r())}}}});
a.store=Ext.create("Ext.data.Store",{fields:["metatype","metatypeName","metatypeNameSingular","metatypeServerExtent"]});e=b.add(a);(function(a){var c=[];apex.ide.IDE.hasApex&&(c.push(["ApexClass","Classes","Class","CODE"]),c.push(["ApexTrigger","Triggers","Trigger","TRIGGERS"]));apex.ide.IDE.hasVisualforce&&(c.push(["ApexPage","Pages","Page","PAGES"]),c.push(["ApexComponent","Page Components","Page Component","PAGECOMPONENTS"]));apex.ide.IDE.restAPI&&c.push(["SObject","Objects","Object","OBJECTS"]);
apex.ide.IDE.dataPipelineDevConsole&&c.push(["DataPipeline","Data Pipelines","Data Pipeline",null]);c.push(["StaticResource","Static Resources","Static Resource",null]);c.push(["Package","Packages","Package","PACKAGES"]);a.add(c)})(e.getStore());return b.entityTypePanel=e}function y(a,f,c){if(0!==f.length&&(a=e.getSelectionModel().getSelection()[0].data.metatypeServerExtent)){l.getStore().removeAll();var b=l;b.setLoading(!0);b.currentRequest&&Ext.Ajax.abort(b.currentRequest);b.currentRequest=Ext.Ajax.request({url:"/_ui/common/apex/debug/ApexCSIAPI",
params:{action:"RELATED",extent:a,relatedEntityEnumOrId:SfdcDevConsole.Extents.getTableEnumOrId(f[0].data)},success:function(a,f){try{var c=Util.evalAjaxServletOutput(a.responseText);void 0!==c.relatedInstances&&void 0!==c.relatedInstances.relatedInstances?b.store.loadData(c.relatedInstances.relatedInstances,!1):b.store.removeAll()}finally{b.setLoading(!1),b.currentRequest=null}},failure:function(a,f){0<=a.status&&(b.setLoading(!1),b.currentRequest=null,b.store.removeAll(),SfdcDevConsole.ToolingAPI.handleFailedRequest(a,
LC.getLabel("DevConsoleOpenRepository","RelatedLoadError"),!0,!0))}})}}function z(a,f,c,d,g,k){a=e.getSelectionModel().getSelection();void 0!==a&&(0<a.length&&void 0!==f)&&(a=SfdcDevConsole.Extents[a[0].data.metatype],void 0!==a.open&&(a.open(f),b._closeIfNotPinned()))}function A(){var a=s();Ext.define("SfdcDevConsole.Repository.EntityModel",{extend:"Ext.data.Model",idProperty:"Id",fields:"Id Name NamespacePrefix custom triggerable undeletable queryable activateable createable customSetting deletable deprecatedAndHidden feedEnabled layoutable mergeable replicateable retrieveable searchable updateable ContentType ScriptType".split(" ")});
Sfdc.apply(a,{xtype:"bufferedmemorygrid",title:LC.getLabel("DevConsoleOpenRepository","Entities"),columns:[{header:"Id",dataIndex:"Id",sortable:!1,hidden:!0},{header:"Name",dataIndex:"Name",sortable:!0,renderer:escapeHTML},{header:"Namespace",dataIndex:"NamespacePrefix",sortable:!0},{header:"Createable",dataIndex:"createable",hidden:!0},{header:"Queryable",dataIndex:"queryable",hidden:!0},{header:"Deletable",dataIndex:"deletable",hidden:!0},{header:"Updateable",dataIndex:"updateable",hidden:!0},{header:"Custom",
dataIndex:"custom",hidden:!0},{header:"Triggerable",dataIndex:"triggerable",hidden:!0},{header:"Undeletable",dataIndex:"undeletable",hidden:!0},{header:"Activateable",dataIndex:"activateable",hidden:!0},{header:"CustomSetting",dataIndex:"customSetting",hidden:!0},{header:"DeprecatedAndHidden",dataIndex:"deprecatedAndHidden",hidden:!0},{header:"FeedEnabled",dataIndex:"feedEnabled",hidden:!0},{header:"Layoutable",dataIndex:"layoutable",hidden:!0},{header:"Mergeable",dataIndex:"mergeable",hidden:!0},
{header:"Replicateable",dataIndex:"replicateable",hidden:!0},{header:"Retrieveable",dataIndex:"retrieveable",hidden:!0},{header:"Searchable",dataIndex:"searchable",hidden:!0},{header:"MIME Type",dataIndex:"ContentType",hidden:!0,renderer:escapeHTML}],selModel:{mode:"SINGLE",listeners:{selectionchange:y}},listeners:{itemdblclick:z}},!0);a.store=new SfdcDevConsole.BufferedMemoryStore({model:"SfdcDevConsole.Repository.EntityModel",sorters:[{property:"NamespacePrefix",direction:"ASC"},{property:"Name",
direction:"ASC"}]});SfdcDevConsole.Events.EventDispatcher.on("extent:created",function(a,b,e){d.getStore().add(e)});SfdcDevConsole.Events.EventDispatcher.on("extent:deleted",function(a,b){d.getStore().removeById(b)});a.selectRowByIdOrName=function(a){d.selectRow("Id",a)||d.selectRow("Name",a)};d=b.add(a);b.entitiesPanel=d;d.filter=function(a){m.setValue(a?a:"");u(m)};d.filterOnNamespace=function(a){n.setValue(a)}}function B(a,b,c,h){0===c&&h&&(a=h.data.extent,b=e.getSelectionModel().getSelection()[0],
h=SfdcDevConsole.Extents.getTableEnumOrId(h.data),g.setValue(!1),n.setValue(!1),b.data.metatype===a?(q(!0),d.selectRowByIdOrName(h)):(d.getStore().selectedEnumOrId=h,h=e.getStore().findExact("metatype",a),e.getSelectionModel().select(h)))}function C(a,f,c,d,e,g){void 0!==f&&(a=SfdcDevConsole.Extents[f.data.extent],void 0!==a&&void 0!==a.open&&(a.open(f),b._closeIfNotPinned()))}function D(){var a=s();Sfdc.apply(a,{title:LC.getLabel("DevConsoleOpenRepository","Related"),columns:[{header:"",menuDisabled:!0,
width:30,fixed:!0,resizable:!1,renderer:function(a,b,d,e,g,k){return void 0!==SfdcDevConsole.Extents[d.data.extent]?(b.tdAttr='style\x3d"padding: 0px; width: 30px"','\x3cdiv style\x3d"text-align: center; font-size: 2em; width: 30px; margin-top: -5px; cursor: pointer;"\x3e\x26#8592;\x3c/div\x3e'):""}},{header:"Name",dataIndex:"name",renderer:escapeHTML},{header:"Extent",dataIndex:"extent"},{header:"Direction",dataIndex:"direction"},{header:"Type",dataIndex:"type",hidden:!0}],listeners:{cellclick:B,
itemdblclick:C}});a.store=new Ext.data.JsonStore({fields:["id","name","type","extent","direction"],idProperty:"id"});l=b.add(a);b.relatedEntitiesPanel=l}function v(){var a=e.getSelectionModel().getSelection();if(void 0!==a&&0<a.length){var a=SfdcDevConsole.Extents[a[0].data.metatype],f=d.getSelectionModel().getSelection();void 0!==a.open&&void 0!==f&&0<f.length?(a.open(f[0]),b._closeIfNotPinned()):Ext.Msg.alert(errorTitle,LC.getLabel("DeveloperConsole","OpenErrorNothingSelected"))}else Ext.Msg.alert(errorTitle,
LC.getLabel("DeveloperConsole","OpenErrorNothingSelected"))}function E(a){a=a.data.NamespacePrefix;return!a||""===a||SfdcDevConsole.hasNamespace(a)}function F(){var a=m.getValue().toLowerCase(),b=SfdcDevConsole.Core.Search.getWildcardFilterFunction(a);return function(a){return b(a.data.Name)}}function q(a){a&&(d.setLoading(!0),Ext.suspendLayouts());try{var b=d.getStore();b.clearFilter();var c=[];g.checked&&c.push(F());n.checked&&c.push(E);0<c.length&&b.filter(c)}finally{a&&(Ext.resumeLayouts(!0),
d.setLoading(!1))}}function u(a,b){0<a.getValue().length?(g.checked||(g.setValue(!0),a.focus()),t()):g.checked&&g.setValue(!1);a.focus(!1,10)}function G(){return[{text:LC.getLabel("DeveloperConsole","OpenButton"),enabled:!1,handler:v},{xtype:"checkbox",boxLabel:LC.getLabel("DeveloperConsole","Filter"),handler:t,listeners:{afterrender:function(a){g=a}}},{xtype:"textfield",width:250,enableKeyEvents:!0,emptyText:LC.getLabel("DevConsoleOpenRepository","FilterEmptyText"),listeners:{keyup:u,afterrender:function(a){m=
a}}},{xtype:"checkbox",boxLabel:LC.getLabel("ApexCSI","filterOnNamespace"),checked:!1,handler:function(a,b){q(!0)},listeners:{afterrender:function(a){n=a}}},{xtype:"tbfill"},{text:LC.getLabel("DeveloperConsole","Refresh"),handler:function(){r(!0)}}]}function w(a){var b=0;k&&(b=e.getStore().find("metatype",a));0<=b&&e.getView().select(b)}function H(){b=Ext.create("Ext.window.Window",{title:LC.getLabel("DeveloperConsole","OpenButton"),width:800,height:300,closeAction:"hide",layout:"fit"});b.add(Ext.create("Ext.ux.AuraView",
{url:"/developerConsole/developerConsole.app"}));b.selectExtent=function(){};b.openSelectedEntity=function(){};b.refreshCurrentEntity=function(){}}function I(){b=Ext.create("apex.ide.window.pinnable",{title:LC.getLabel("DeveloperConsole","OpenButton"),width:800,height:300,closeAction:"hide",layout:{type:"hbox",pack:"start",align:"stretch"},bbar:G()});x();A();D();b.on("afterrender",function(){w(k)});b.selectExtent=w;b.openSelectedEntity=v;b.refreshCurrentEntity=function(){r(!0)}}var b=null,e=null,
d=null,l=null,g=null,m=null,n=null,k=null,p=null;apex.ide.IDE.on("buildingWorkspace",function(a){a.selectedEntity=k});apex.ide.IDE.on("workspaceLoaded",function(a){k=a.selectedEntity});Sfdc.ns("SfdcDevConsole.Repository");SfdcDevConsole.Repository.open=function(){null===b&&(SfdcDevConsole.Preferences.get("enableNewOpenDialog")?H():I());b.show();return b};SfdcDevConsole.Repository.close=function(){p=k=n=m=g=l=d=e=null;Ext.destroy(b);b=null};SfdcDevConsole.Events.EventDispatcher.on("preferences:changed",
function(a,d){b.isVisible()?(b.hide(),SfdcDevConsole.Repository.close(),SfdcDevConsole.Repository.open()):SfdcDevConsole.Repository.close()})})();
Ext.define("apex.editor.DescribeResult",{idProperty:"id",extend:"Ext.data.Model",fields:["id","name","type"]});
Ext.define("apex.editor.EntityInfoViewer",{extend:"apex.ide.Viewer",alias:"widget.entityinfoviewer",getEntityName:function(){return escapeHTML((this.NamespacePrefix?this.NamespacePrefix+"__":"")+this.Name)},loadContent:function(){var d={describe:!0,tooling:!1,continuation:function(a){this.fields.store.loadData(a.fields,!1);this.fireEvent("afterLoad",a)}.bind(this),failure:function(a){this.fireEvent("failedLoad",a)}.bind(this)};SfdcDevConsole.ToolingAPI.sobject(this.getEntityName(),d)},initComponent:function(){var d=
{entity:this.getEntityName(),xtype:"grid",forceFit:!0,columns:[{header:"Name",dataIndex:"name"},{header:"Apex Type",dataIndex:"type"}],store:Ext.create("Ext.data.Store",{idField:"id",model:"apex.editor.DescribeResult",proxy:{type:"localstorage"}}),listeners:{afterrender:function(a){a.ownerCt.ownerCt.fields=a}},selModel:{mode:"MULTI"}};Ext.apply(this,{displayName:"Object",layout:"border",loaded:!1,items:[{region:"center",xtype:"panel",layout:"fit",items:[d]}]});d.bbar={items:[{xtype:"button",text:"Query",
listeners:{afterrender:function(a){a.editorGrid=a.ownerCt.ownerCt;a.editorGrid.queryButton=a},click:function(a){for(var b="SELECT ",e=[],d=a.editorGrid.getSelectionModel().getSelection(),g=!1,f=0;f<d.length;f++)"Id"===d[f].data.name&&(g=!0),e.push(d[f].data.name);g||(b+="Id",0<e.length&&(b+=", "));for(c=0;c<e.length;c++)b+=e[c],c<e.length-1&&(b+=", ");b=b+" FROM "+a.editorGrid.entity;Ext.getCmp("queryEditorText").setValue(b);Ext.getCmp("bottomPanel").setActiveTab(apex.query.QueryEditor)}}}]};this.callParent(arguments)}});
(function(){function m(){g||(g=Ext.create("Ext.window.Window",{title:LC.getLabel("DevConsoleQueryPlan","QueryPlan"),width:700,height:300,closeAction:"hide",layout:"border",items:[{region:"north",xtype:"grid",forceFit:!0,store:new Ext.data.JsonStore({fields:["cardinality",{name:"fields",type:"String"},"leadingOperationType","relativeCost","sobjectCardinality","sobjectType"]}),columns:[{header:LC.getLabel("DevConsoleQueryPlan","Cardinality"),dataIndex:"cardinality",width:70},{header:LC.getLabel("DevConsoleQueryPlan",
"Fields"),dataIndex:"fields"},{header:LC.getLabel("DevConsoleQueryPlan","LeadingOperationType"),dataIndex:"leadingOperationType"},{header:LC.getLabel("DevConsoleQueryPlan","Cost"),dataIndex:"relativeCost",width:50},{header:LC.getLabel("DevConsoleQueryPlan","sObjectCardinality"),dataIndex:"sobjectCardinality"},{header:LC.getLabel("DevConsoleQueryPlan","sObjectType"),dataIndex:"sobjectType"}]},{region:"south",name:"notes",xtype:"textarea",emptyText:LC.getLabel("DevConsoleQueryEditor","NotesDefaultText"),
readOnly:!0}],bbar:[{xtype:"tbfill"},{text:LC.getLabel("DeveloperConsole","CloseButton"),handler:function(){g.hide()}}]}));return g}function k(a){var b=m(),c=b.items.get(0).store;c.removeAll();b.show();b.setLoading(!0);SfdcDevConsole.ToolingAPI.query(a,{continuation:function(a){var b,d="";g.setLoading(!1);if(a.plans&&a.plans[0]&&a.plans[0].notes){for(b=0;b<a.plans[0].notes.length;b++)b&&(d+="\n"),d+=a.plans[0].notes[b].description+". Table: "+a.plans[0].notes[b].tableEnumOrId+" Fields: "+JSON.stringify(a.plans[0].notes[b].fields);
d.length&&(d="Notes:\n"+d);g.query("textarea[name\x3dnotes]")[0].setValue(d)}c.add(a.plans)},additionalFailureHandler:function(a){g.hide()},explain:!0,alertOnFailure:!0,gackOnFailure:!1,escape:encodeURIComponent});return b}function l(a){var b=Ext.getCmp("queryEditorText"),c;h&&(h[a?"show":"hide"](),b&&b.rendered&&(c=b.getValue(),b.emptyText=a?LC.getLabel("DevConsoleQueryEditor","DefaultText")+"\n"+LC.getLabel("DevConsoleQueryEditor","DefaultTextQueryPlan"):LC.getLabel("DevConsoleQueryEditor","DefaultText"),
b.reset(),c&&0<c.length&&b.setValue(c)))}SfdcDevConsole.Events.EventDispatcher.register("query:execute");var h=null,g=null;SfdcDevConsole.Events.EventDispatcher.on("preferences:changed",function(a,b){Sfdc.isBoolean(b.enableQueryPlan)&&l(b.enableQueryPlan)});Ext.define("apex.query.QueryEditor",{id:"queryTool",extend:"apex.ide.Browser",alias:"widget.queryeditor",singleton:!0,parseQuery:Ext.Function.createBuffered(function(a){this.parseQueryImpl(Ext.getCmp("queryEditorText").getValue(),a)},3E3),queryTypeEnum:{SOQL:{name:"SOQL",
prefix:"select "},SOSL:{name:"SOSL",prefix:"find "}},cleanupQuery:function(a,b){var c,e="",f=a.split(/'/),d=!1;for(c=0;c<f.length;c++)d?(d="\\"===f[c].charAt(f[c].length-1),e+="'"+(b?encodeURIComponent(f[c]):f[c]),d||(e+="'")):(e=b?e+f[c].replace(/\s*/gm,"").replace(/"/g,""):e+f[c].replace(/\r\n|\n|\r/gm," ").replace(/\s+/gm," ").replace(/\s*,\s*/gm,", "),d=!0);return e},startsWith:function(a,b){return 0===a.toLowerCase().indexOf(b)},getQueryUrl:function(a,b){return this.startsWith(a,this.queryTypeEnum.SOQL.prefix)?
SfdcDevConsole.ToolingAPI.URLs.query(a,b,{columns:!0}):this.startsWith(a,this.queryTypeEnum.SOSL.prefix)?SfdcDevConsole.ToolingAPI.URLs.search(a):null},getQueryType:function(a){return this.startsWith(a,this.queryTypeEnum.SOQL.prefix)?this.queryTypeEnum.SOQL:this.startsWith(a,this.queryTypeEnum.SOSL.prefix)?this.queryTypeEnum.SOSL:null},generateQueryPlan:k,parseQueryImpl:function(a,b){if(""!==a){var c=Ext.getCmp("useToolingAPI"),c=c&&c.getValue();if(c=this.getQueryUrl(a,c)){var e=Ext.getCmp("queryEditorError");
e.setValue("");SfdcDevConsole.ToolingAPI.request({url:c,escape:encodeURIComponent,continuation:function(a,c){"function"===typeof b&&b(a)},failure:function(a,b){e.setValue(SfdcDevConsole.ToolingAPI.handleFailedRequest(a,null,!1))}})}else Ext.Msg.alert(LC.getLabel("DevConsoleQueryEditor","InvalidQuery"),LC.getLabel("DevConsoleQueryEditor","QueryStartError"))}},initComponent:function(){Ext.apply(this,{layout:"border",title:LC.getLabel("DevConsoleQueryEditor","Title"),items:[{xtype:"panel",layout:"anchor",
region:"west",split:"true",flex:3,items:[{emptyText:LC.getLabel("DevConsoleQueryEditor","DefaultText"),anchor:"100% 50%",xtype:"textarea",id:"queryEditorText",listeners:{afterrender:function(a){SfdcDevConsole.Preferences.get("enableQueryPlan")?a.emptyText=LC.getLabel("DevConsoleQueryEditor","DefaultText")+"\n"+LC.getLabel("DevConsoleQueryEditor","DefaultTextQueryPlan"):a.emptyText=LC.getLabel("DevConsoleQueryEditor","DefaultText");a.reset();void 0!==apex.query.QueryEditor.initialQuery&&a.setValue(apex.query.QueryEditor.initialQuery)},
change:function(a){-1===!Ext.getCmp("queryEditorText").getValue().search(/^00[BO][A-Za-z0-9]{12}(:?[A-Za-z0-9]{3})?$/)&&this.ownerCt.ownerCt.parseQuery()}}},{anchor:"100% 50%",emptyText:LC.getLabel("DevConsoleQueryEditor","DefaultError"),id:"queryEditorError",xtype:"textarea",readOnly:!0}]},{xtype:"panel",region:"center",layout:"fit",flex:1,items:[{xtype:"executehistory"}]}],bbar:[{xtype:"button",text:LC.getLabel("DevConsoleQueryEditor","Execute"),id:"queryExecuteButton",listeners:{click:function(a,
b){var c=Ext.getCmp("queryEditorText").getValue();SfdcDevConsole.Events.EventDispatcher.fire("query:execute",[c])}}},{xtype:"button",text:LC.getLabel("DevConsoleQueryPlan","QueryPlan"),hidden:!0,handler:function(){k(Ext.getCmp("queryEditorText").getValue())},listeners:{afterrender:function(a){h=a;l(SfdcDevConsole.Preferences.get("enableQueryPlan"))}}},{boxLabel:LC.getLabel("DevConsoleQueryEditor","UseToolingApi"),id:"useToolingAPI",xtype:"checkbox",listeners:{change:function(a,b,c,e){a=Ext.getCmp("queryEditorText").getValue();
SfdcDevConsole.Events.EventDispatcher.fire("query:execute",[a])}}}]});this.callParent()}},function(){SfdcDevConsole.Events.EventDispatcher.on("executed:select",function(a,b){Ext.getCmp("queryEditorText").setValue(b.data.executed)});SfdcDevConsole.Events.EventDispatcher.on("query:execute",function(a,b){apex.query.QueryEditor.parseQueryImpl(b,function(a){var e;e=Ext.getCmp("useToolingAPI")?Ext.getCmp("useToolingAPI").getValue():!1;var f=b,f=apex.query.QueryEditor.cleanupQuery(b,!0),d=apex.query.QueryEditor.cleanupQuery(b),
g=apex.query.QueryEditor.getQueryType(b);g===apex.query.QueryEditor.queryTypeEnum.SOQL?apex.ide.Viewer.open({xtype:"queryresult",id:f,Name:d,queryMetadata:a,tooling:e}):g===apex.query.QueryEditor.queryTypeEnum.SOSL&&apex.ide.Viewer.open({xtype:"soslresult",searchMetadata:a,id:f,Name:d});SfdcDevConsole.Events.EventDispatcher.fire("executed:new",[b])})});apex.ide.IDE.on("buildingWorkspace",function(a){a.query=Ext.getCmp("queryEditorText").getValue();var b=Ext.getCmp("useToolingAPI"),b=b&&b.getValue();
a.queryUseTooling=b});apex.ide.IDE.on("workspaceLoaded",function(a){if(void 0!==a&&null!==a&&(void 0!==a.query&&""!==a.query&&(void 0!==Ext.getCmp("queryEditorText")?Ext.getCmp("queryEditorText").setValue(a.query):apex.query.QueryEditor.initialQuery=a.query),a.queryUseTooling)){var b=Ext.getCmp("useToolingAPI");b&&b.setValue(a.queryUseTooling)}})});Ext.define("apex.test.QueryResultViewer",{alias:"widget.queryresult",extend:"apex.ide.Viewer",loadContent:function(){this.resultGrid.getStore().load();
this.fireEvent("afterLoad")},workspace:function(){var a=this.callParent();Sfdc.apply(a,{xtype:"queryresult",displayName:LC.getLabel("DevConsoleQueryResult","Query"),queryMetadata:this.queryMetadata,tooling:this.tooling},!0);return a},initComponent:function(){var a=this.queryMetadata.entityName+"@"+Ext.Date.format(new Date,"g:i A");Ext.apply(this,{layout:"border",xtype:"panel",id:this.id,title:a,items:[{region:"north",xtype:"textarea",title:LC.getLabel("DevConsoleQueryResult","Query"),value:this.Name,
readOnly:!0,height:40},{region:"center",editable:!this.queryMetadata.groupBy&&this.queryMetadata.idSelected,sfdcNavigation:!this.queryMetadata.groupBy&&this.queryMetadata.idSelected,queryString:this.Name,queryMetadata:this.queryMetadata,xtype:"soqlgrid",version:apex.ide.IDE.apiVersion,listeners:{afterrender:function(a){a.queryTab=a.ownerCt;a.queryTab.resultGrid=a}},title:LC.getLabel("DevConsoleQueryResult","Result"),forceFit:!0,tooling:this.tooling}]});this.callParent()}})})();
Sfdc.ns("Test");Test.Constants=function(){return{COMPLETED:"Completed",FAIL:"Fail",PROCESSING:"Processing",ALL_METHODS_SELECTED:"All Methods Selected"}}();Ext.define("apex.test.AggregateCoverageModel",{extend:"Ext.data.Model",idProperty:"classId",fields:["classId",{name:"className",type:"string"},{name:"percent",type:"int"},"numLines"]});Ext.define("apex.test.TestResultDetailModel",{extend:"Ext.data.Model",idProperty:"methodid",fields:"jobid classid methodid className method duration result error stacktrace logid".split(" ")});
Ext.define("apex.test.CodeCoverageListModel",{extend:"Ext.data.Model",idProperty:"classId",fields:["testClassId",{name:"className",type:"string"},{name:"percent",type:"int"},"numLines"]});Ext.define("apex.test.classSelectModel",{extend:"Ext.data.Model",idProperty:"classId",fields:["className","classId","namespace"]});Ext.define("apex.test.testsSelectModel",{extend:"Ext.data.Model",idProperty:"methodName",fields:"methodName classId className testId namespace selectTestsGridIndex".split(" ")});
Ext.define("apex.test.TestSuite",{id:"TestSuite",extend:"Ext.util.Observable",alias:"widget.TestSuite",singleton:!0,newTestSuite:function(){Ext.Msg.prompt(LC.getLabel("Test","NewSuiteTitle"),LC.getLabel("Test","NewSuiteInstructions"),function(a,b){"ok"===a&&apex.test.TestSuite.createTestSuite(b)})},handleSuiteNameFailure:function(a,b){var c=a&&a.responseText||Sfdc.isString(a)&&a;if(c)try{var d=Ext.JSON.decode(c),e=Ext.Msg;Sfdc.isArray(d)&&0<d.length&&(d=d[0]);"REQUIRED_FIELD_MISSING"===d.errorCode?
e.alert(LC.getLabel("Test","NewSuiteBlankNameErrorTitle"),LC.getLabel("Test","NewSuiteBlankNameErrorMsg")):"STRING_TOO_LONG"===d.errorCode?e.alert(LC.getLabel("Test","NewSuiteTooLongErrorTitle"),LC.getLabel("Test","NewSuiteTooLongErrorMsg")):"DUPLICATE_VALUE"===d.errorCode?e.alert(LC.getLabel("Test","NewSuiteDuplicateErrorTitle"),LC.getLabel("Test","NewSuiteTooLongErrorMsg1")+escapeHTML(b)+LC.getLabel("Test","NewSuiteTooLongErrorMsg2")):SfdcDevConsole.ToolingAPI.handleFailedRequest(a,"Failed to create test suite.",
!0)}catch(f){SfdcDevConsole.ToolingAPI.handleFailedRequest(a,"Failed to create test suite.",!0)}},createTestSuite:function(a){SfdcDevConsole.ToolingAPI.create("ApexTestSuite",{TestSuiteName:a},{continuation:function(b,c){var d={id:b.id,testSuiteName:a};Ext.getCmp("testSuites").getStore().add(d);apex.test.TestSuite.editSuiteMembership(d).show();Ext.Msg.hide()},failure:function(b){apex.test.TestSuite.handleSuiteNameFailure(b,a)},failureMessage:LC.getLabel("Test","CreateSuiteFail")+escapeHTML(a)+LC.getLabel("Test",
"TryAgain"),alertOnFailure:!0})},queryMoreSuites:function(a,b,c,d){if(a.done){a=[];for(var e=0;e<b.length;e++)a.push({id:b[e].Id,testSuiteName:b[e].TestSuiteName});Ext.getCmp(c).getStore().loadData(a);d.setLoading(!1)}else SfdcDevConsole.ToolingAPI.request({url:a.nextRecordsUrl,continuation:function(a){apex.test.TestSuite.queryMoreSuites(a,b.concat(a.records),c,d)},failureMessage:LC.getLabel("Test","ListSuiteFail")})},createTestSuiteList:function(a){SfdcDevConsole.ToolingAPI.query("SELECT Id, TestSuiteName FROM ApexTestSuite",
{continuation:function(b,c){apex.test.TestSuite.queryMoreSuites(b,b.records,"testSuites",a)},failureMessage:LC.getLabel("Test","ListSuiteFail"),alertOnFailure:!0})},deleteTestSuite:function(a){a&&-1!==Sfdc.Array.indexOf(Ext.getCmp("testSuites").store.data.items,a)&&SfdcDevConsole.ToolingAPI.DELETE("ApexTestSuite",a.data.id,{success:function(b,c){Ext.StoreMgr.lookup("testSuites").remove(a)},failureMessage:LC.getLabel("Test","DeleteSuiteFail")+a.data.name+LC.getLabel("Test","TryAgain")})},TestSuiteWindow:Ext.create("Ext.window.Window",
{title:"Test Suite Manager",id:"TestSuiteWindow",height:200,width:400,layout:"fit",closeAction:function(){this.hide()},bbar:[{text:LC.getLabel("Test","SuiteManagerNewSuite"),listeners:{afterrender:function(a,b){Ext.getCmp("TestSuiteWindow").newButton=a}},handler:function(){apex.test.TestSuite.newTestSuite();Ext.getCmp("testSuites").getView().refresh()}},{text:LC.getLabel("Test","SuiteManagerRenameSuite"),listeners:{afterrender:function(a,b){Ext.getCmp("TestSuiteWindow").renameButton=a}},handler:function(){void 0!==
Ext.getCmp("testSuites").getSelectionModel().getSelection()[0]&&null!==Ext.getCmp("testSuites").getSelectionModel().getSelection()[0]&&Ext.Msg.prompt(LC.getLabel("Test","RenameSuiteTitle"),LC.getLabel("Test","RenameSuiteInstructions"),function(a,b){if("ok"===a){var c={};c.Id=Ext.getCmp("testSuites").getSelectionModel().getSelection()[0].data.id;c.TestSuiteName=b;Ext.getCmp("TestSuiteWindow").setLoading(!0);SfdcDevConsole.ToolingAPI.save("ApexTestSuite",c,{continuation:function(a){Ext.getCmp("testSuites").getStore().findRecord("id",
Ext.getCmp("testSuites").getSelectionModel().getSelection()[0].data.id).data.testSuiteName=b;Ext.getCmp("testSuites").getView().refresh();Ext.getCmp("TestSuiteWindow").setLoading(!1)},failure:function(a){Ext.getCmp("TestSuiteWindow").setLoading(!1);apex.test.TestSuite.handleSuiteNameFailure(a,b)},alertOnFailure:!0})}})}},{text:LC.getLabel("Test","SuiteManagerEditSuite"),listeners:{afterrender:function(a,b){a.testBrowser=Ext.getCmp("testResults");a.testBrowser.newRun=a}},handler:function(){var a=Ext.getCmp("testSuites").getSelectionModel().getSelection()[0];
void 0!==a&&apex.test.TestSuite.editSuiteMembership(a.data).show()}},{text:LC.getLabel("Test","SuiteManagerDeleteSuite"),listeners:{afterrender:function(a,b){Ext.getCmp("TestSuiteWindow").deleteButton=a}},handler:function(){var a=Ext.getCmp("testSuites").getSelectionModel().getSelection()[0];void 0!==a&&Ext.Msg.show({title:LC.getLabel("Test","SuiteManagerConfirmDeleteTitle")+a.data.testSuiteName+"?",msg:null,width:300,closable:!0,buttons:Ext.Msg.YESNO,buttonText:{yes:"Delete",no:"Cancel"},fn:function(b,
c,d){"yes"==b&&apex.test.TestSuite.deleteTestSuite(a)},icon:Ext.Msg.QUESTION})}},{xtype:"tbfill"},{text:LC.getLabel("DeveloperConsole","CloseButton"),listeners:{afterrender:function(a,b){Ext.getCmp("TestSuiteWindow").cancelButton=a}},handler:function(){apex.test.TestSuite.TestSuiteWindow.hide()}}],listeners:{show:function(a){a.setLoading(!0);apex.test.TestSuite.createTestSuiteList(a)}},items:[{xtype:"grid",id:"testSuites",forceFit:!0,selModel:{mode:"SINGLE"},listeners:{celldblclick:function(a,b,c,
d,e,f,h,g){apex.test.TestSuite.editSuiteMembership(d.getData()).show();membershipWindow.show()}},columns:[{header:"id",dataIndex:"id",hidden:!0},{header:"Suite Name",width:100,dataIndex:"testSuiteName",editor:{allowBlank:!1},renderer:function(a,b,c){return escapeHTML(c.data.testSuiteName)}}],store:Ext.create("Ext.data.Store",{storeId:"testSuites",idField:"id",fields:[{name:"id"},{name:"testSuiteName",type:"string"}],sorters:[{property:"testSuiteName",direction:"ASC"}]})}]}),addToSelectedTests:function(a){if(!(void 0===
a||null===a)){var b=Ext.getCmp("allSelectedTests"),c=Ext.getCmp("allTestClasses");b.getStore().add(a);c.getStore().remove(a);b.getStore().sort();b.getView().refresh();c.getView().refresh()}},removeFromSelectedTests:function(a){if(!(void 0===a||null===a)){var b=Ext.getCmp("allSelectedTests"),c=Ext.getCmp("allTestClasses");b.getStore().remove(a);c.getStore().add(a);a=Ext.getCmp("testClassFilterSuites").getValue();var d=SfdcDevConsole.Core.Search.getWildcardFilterFunction(a);c.getStore().filter(function(a){return d(a.data.className)});
c.getStore().sort();b.getView().refresh();c.getView().refresh()}},suiteMembershipWindow:null,editSuiteMembership:function(a){return this.suiteMembershipWindow=new Ext.Window({title:escapeHTML(a.testSuiteName),numTestMethods:{},modal:!0,layout:{type:"hbox",align:"stretch"},width:Math.floor(Ext.getCmp("apexCSIViewport").getWidth()/2),height:Math.floor(Ext.getCmp("apexCSIViewport").getHeight()/2),closeAction:"destroy",bodyStyle:"background: #fff;",listeners:{show:function(b){b.setLoading(!0);Ext.getCmp("allTestClasses").getStore().removeAll();
Ext.getCmp("allSelectedTests").getStore().removeAll();var c={};SfdcDevConsole.ToolingAPI.query("SELECT ApexClassId, Id FROM TestSuiteMembership  WHERE ApexTestSuiteId \x3d '"+a.id+"'",{continuation:function(a,e){if(a.done){for(var f=0;f<a.records.length;f++)c[a.records[f].ApexClassId]=!0;apex.test.TestResult.getTestClasses(function(a,d){try{for(var e=[],f=0;f<d.length;f++)e.push({namespace:d[f][0]});Ext.getCmp("testClassNamespacesOptions").getStore().loadData(e);for(var e=[],f=[],l=0,m=a.length;l<
m;l++){var n=ApiUtils.to18CharId(a[l].id);!0!==c[n]?e.push({className:a[l].name,classId:n,namespace:a[l].ns}):f.push({className:a[l].name,classId:n,namespace:a[l].ns})}Ext.getCmp("allTestClasses").getStore().loadData(e);Ext.getCmp("allSelectedTests").getStore().loadData(f);Ext.getCmp("origMembership").getStore().loadData(f);var p="["+LC.getLabel("Page_ApexTestQueue","MyNamespace")+"]";Ext.getCmp("allTestClasses").getStore().filter("namespace",p);Ext.getCmp("testClassNamespacesOptions").setValue(p)}finally{b.setLoading(!1)}})}},
failureMessage:LC.getLabel("Test","ListMembershipFail"),alertOnFailure:!0})}},items:[{xtype:"panel",forceFit:!0,flex:2,layout:{type:"vbox",align:"stretch"},items:[{title:LC.getLabel("Test","AvailableClassesForMem"),xtype:"grid",id:"allTestClasses",forceFit:!0,layout:"fit",flex:1,multiSelect:!0,columns:[{header:"Name",dataIndex:"className"}],store:Ext.create("Ext.data.Store",{model:"apex.test.classSelectModel",sorters:[{property:"className",direction:"ASC"}]})}]},{xtype:"panel",forceFit:!0,layout:{type:"vbox",
pack:"center"},items:[{id:"addMembershipButton",xtype:"button",text:"\x3e",handler:function(a){a=Ext.getCmp("allTestClasses").getSelectionModel().getSelection();for(var c=[],d=0;d<a.length;d++)c.push(a[d]);apex.test.TestSuite.addToSelectedTests(c)}},{id:"removeMembershipButton",xtype:"button",text:"\x3c",handler:function(a){a=Ext.getCmp("allSelectedTests").getSelectionModel().getSelection();for(var c=[],d=0;d<a.length;d++)c.push(a[d]);apex.test.TestSuite.removeFromSelectedTests(c)}}]},{xtype:"panel",
forceFit:!0,flex:2,layout:{type:"vbox",align:"stretch"},items:[{title:LC.getLabel("Test","SelectedClassesForMem"),xtype:"grid",id:"allSelectedTests",forceFit:!0,layout:"fit",flex:2,multiSelect:!0,columns:[{header:"Name",dataIndex:"className"}],store:Ext.create("Ext.data.Store",{model:"apex.test.classSelectModel",sorters:[{property:"className",direction:"ASC"}]})}]},{xtype:"panel",forceFit:!0,hidden:!0,flex:2,layout:{type:"vbox",align:"stretch"},items:[{title:"Original Membership",xtype:"grid",id:"origMembership",
forceFit:!0,layout:"fit",flex:2,columns:[{header:"Name",dataIndex:"className"}],store:Ext.create("Ext.data.Store",{model:"apex.test.classSelectModel",sorters:[{property:"name",direction:"ASC"}]})}]}],bbar:[{id:"testClassFilterSuites",xtype:"textfield",width:165,emptyText:LC.getLabel("Test","TestClassFilter"),enableKeyEvents:!0,listeners:{keyup:function(a,c){apex.test.TestSuite.suiteMembershipWindow.filterTestClassesTask.delay(500)}}},{xtype:"combobox",id:"testClassNamespacesOptions",typeAhead:!0,
store:Ext.create("Ext.data.Store",{fields:["namespace"]}),queryMode:"local",displayField:"namespace",listeners:{select:function(a,c,d){0!==c.length&&(a=c[0].data.namespace,c=Ext.getCmp("selectTestClassesGrid").getStore(),d="["+LC.getLabel("Page_ApexTestQueue","AllNamespaces")+"]",c.clearFilter(),a!==d&&c.filter("namespace",a))}}},{xtype:"tbfill"},{xtype:"button",text:LC.getLabel("DeveloperConsole","CancelButton"),id:"closeWindow",handler:function(a){apex.test.TestSuite.suiteMembershipWindow.destroy()}},
{xtype:"button",text:"Save",id:"confirmButton",handler:function(b){Ext.MessageBox.progress(LC.getLabel("Test","MembershipProgressTitle"),null,LC.getLabel("Test","MembershipBarText"));var c=Ext.getCmp("origMembership").getStore().data;b=Ext.getCmp("allSelectedTests").getStore().data;if(200<c.length)Ext.Msg.alert("Error",LC.getLabel("Test","SuiteOver200TestsError"));else{for(var c=[],d=0;d<b.length;d++)c.push(b.items[d].data.classId);200<c.length?Ext.Msg.alert("Error",LC.getLabel("Test","MakeTestSuiteOver200")):
(b={},b.Id=a.id,b.ApexClassIds=c,SfdcDevConsole.ToolingAPI.save("ApexTestSuite",b,{continuation:function(){Ext.MessageBox.hide()},failureMessage:LC.getLabel("Test","MakeTestSuiteOver200"),alertOnFailure:!0}),apex.test.TestSuite.suiteMembershipWindow.destroy())}}}],filterTestClasses:function(){for(var a=Ext.getCmp("allTestClasses"),c=[],d=0;d<a.getSelectionModel().selected.items.length;d++)c[d]=a.getSelectionModel().selected.items[d];a.getStore().clearFilter();var d=Ext.getCmp("testClassFilterSuites").getValue(),
e=SfdcDevConsole.Core.Search.getWildcardFilterFunction(d);a.getStore().filter(function(a){return e(a.data.className)});a.getStore().sort();a.getSelectionModel().select(c,!0,!0)},filterTestClassesTask:new Ext.util.DelayedTask(function(a){apex.test.TestSuite.suiteMembershipWindow.filterTestClasses()})})},addToSuiteRun:function(a){if(!(void 0===a||null===a)){var b=Ext.getCmp("allSuites"),c=Ext.getCmp("allSelectedSuites");c.getStore().add(a);b.getStore().remove(a);b.getView().refresh();c.getView().refresh()}},
removeFromSuiteRun:function(a){if(!(void 0===a||null===a)){var b=Ext.getCmp("allSuites"),c=Ext.getCmp("allSelectedSuites");c.getStore().remove(a);b.getStore().add(a);b.getView().refresh();c.getView().refresh()}},runSuitesWindow:null,getRunSuitesWindow:function(){null===this.runSuitesWindow&&(this.runSuitesWindow=new Ext.Window({title:LC.getLabel("Test","NewTestSuiteRun"),numTestMethods:{},maxFailedTests:"",modal:!0,layout:{type:"hbox",align:"stretch"},width:Math.floor(Ext.getCmp("apexCSIViewport").getWidth()/
2),height:Math.floor(Ext.getCmp("apexCSIViewport").getHeight()/2),closeAction:"hide",bodyStyle:"background: #fff;",selected:[],listeners:{show:function(a){a.setLoading(!0);Ext.getCmp("allSuites").getStore().removeAll();Ext.getCmp("allSelectedSuites").getStore().removeAll();SfdcDevConsole.ToolingAPI.query("SELECT Id, TestSuiteName FROM ApexTestSuite",{continuation:function(b,c){apex.test.TestSuite.queryMoreSuites(b,b.records,"allSuites",a)},failureMessage:LC.getLabel("Test","ListSuiteFail"),alertOnFailure:!0})},
beforeclose:function(a){null===Ext.getCmp("suiteNumFailsWindow")||void 0===Ext.getCmp("suiteNumFailsWindow")||Ext.getCmp("suiteNumFailsWindow").close()},beforehide:function(a){null===Ext.getCmp("suiteNumFailsWindow")||void 0===Ext.getCmp("suiteNumFailsWindow")||Ext.getCmp("suiteNumFailsWindow").close()}},items:[{xtype:"panel",forceFit:!0,flex:2,layout:{type:"vbox",align:"stretch"},items:[{title:LC.getLabel("Test","AvailableSuitesForRun"),xtype:"grid",id:"allSuites",forceFit:!0,layout:"fit",flex:1,
multiSelect:!0,columns:[{header:"Name",dataIndex:"testSuiteName",renderer:function(a,b,c){return escapeHTML(c.data.testSuiteName)}}],store:Ext.create("Ext.data.Store",{storeId:"leftPanelRunSuites",idField:"testSuiteName",fields:[{name:"id"},{name:"testSuiteName",type:"string"}],sorters:[{property:"testSuiteName",direction:"ASC"}]})}]},{xtype:"panel",forceFit:!0,layout:{type:"vbox",pack:"center"},items:[{id:"addSuite",xtype:"button",text:"\x3e",handler:function(a){a=Ext.getCmp("allSuites").getSelectionModel().getSelection();
for(var b=[],c=0;c<a.length;c++)b.push(a[c]);apex.test.TestSuite.addToSuiteRun(b)}},{id:"removeSuite",xtype:"button",text:"\x3c",handler:function(a){a=Ext.getCmp("allSelectedSuites").getSelectionModel().getSelection();for(var b=[],c=0;c<a.length;c++)b.push(a[c]);apex.test.TestSuite.removeFromSuiteRun(b)}}]},{xtype:"panel",forceFit:!0,flex:2,layout:{type:"vbox",align:"stretch"},items:[{title:LC.getLabel("Test","SelectedSuitesForRun"),xtype:"grid",id:"allSelectedSuites",forceFit:!0,layout:"fit",flex:2,
multiSelect:!0,columns:[{header:"Name",dataIndex:"testSuiteName",renderer:function(a,b,c){return escapeHTML(c.data.testSuiteName)}}],store:Ext.create("Ext.data.Store",{storeId:"rightPanelRunSuites",idField:"testSuiteName",fields:[{name:"id"},{name:"testSuiteName",type:"string"}],sorters:[{property:"testSuiteName",direction:"ASC"}]})}]}],bbar:[{xtype:"tbfill"},{xtype:"button",text:LC.getLabel("DeveloperConsole","CancelButton"),id:"closeSuiteRunWindow",handler:function(a){apex.test.TestSuite.runSuitesWindow.hide()}},
{xtype:"button",text:"Settings",id:"suiteSettingsButton",handler:function(a){null===Ext.getCmp("suiteNumFailsWindow")||void 0===Ext.getCmp("suiteNumFailsWindow")?Ext.create("Ext.window.Window",{title:"Specify Run Parameters",id:"suiteNumFailsWindow",height:130,width:300,bodyPadding:10,buttons:[{text:"Cancel",handler:function(a){Ext.getCmp("suiteNumFailsWindow").destroy()}},{text:"OK",id:"suiteNumFailsWindowOkButton",formBind:!0,handler:function(a){apex.test.TestSuite.getRunSuitesWindow().maxFailedTests=
Ext.getCmp("suiteFailuresTextField").getValue();Ext.getCmp("suiteNumFailsWindow").destroy()}}],items:[{id:"suiteFailuresTextField",xtype:"numberfield",fieldLabel:"Number of failures allowed",labelSeparator:"",value:apex.test.TestSuite.getRunSuitesWindow().maxFailedTests,anchor:"100%",hideTrigger:!0,keyNavEnabled:!1,mouseWheelEnabled:!1,validator:function(a){if(""===a||-1<=a&&1E6>=a)return Ext.getCmp("suiteNumFailsWindowOkButton").enable(),!0;Ext.getCmp("suiteNumFailsWindowOkButton").disable();return"Value must be an integer. To limit the number of failed tests, use an integer between 0 and 1,000,000. To allow all tests to run, use -1."}}]}).show():
Ext.getCmp("suiteNumFailsWindow").toFront(!1)}},{xtype:"button",text:LC.getLabel("Test","ConfirmSuiteRunButton"),id:"confirmSuiteRunButton",handler:function(a){var b=Ext.getCmp("allSelectedSuites").getStore().data.items;for(a=[];0<b.length;)a.push(b.pop().data.id);b=apex.test.TestSuite.getRunSuitesWindow().maxFailedTests;null===b||""===b?apex.ide.IDE.runTests(a,{failure:function(a){apex.test.TestSuite.runSuitesWindow.handleRunSuiteError(a)}},-1):apex.ide.IDE.runTests(a,{failure:function(a){apex.test.TestSuite.runSuitesWindow.handleRunSuiteError(a)}},
b);apex.test.TestSuite.getRunSuitesWindow().maxFailedTests="";apex.test.TestSuite.runSuitesWindow.hide()}}],handleRunSuiteError:function(a){var b=a&&a.responseText||Sfdc.isString(a)&&a;if(b)try{var c=Ext.JSON.decode(b);Sfdc.isArray(c)&&0<c.length&&(c=c[0]);if("MISSING_ARGUMENT"===c.errorCode){var d=Ext.Msg;d.buttonText.ok=LC.getLabel("Test","OnlyEmptySuitesErrorButton");d.alert(LC.getLabel("Test","OnlyEmptySuitesErrorTitle"),LC.getLabel("Test","OnlyEmptySuitesErrorMessage"))}else SfdcDevConsole.ToolingAPI.handleFailedRequest(a,
"Failed to enqueue tests.",!0)}catch(e){SfdcDevConsole.ToolingAPI.handleFailedRequest(a,"Failed to enqueue tests.",!0)}}}));return this.runSuitesWindow}});
Ext.define("apex.test.TestResultBrowser",{id:"testResults",extend:"apex.ide.Browser",alias:"widget.testresultbrowser",singleton:!0,testResultList:[],overallCoveragePercentage:0,runAllJobId:null,initComponent:function(){Ext.apply(this,{xtype:"panel",layout:"border",title:"Tests",listeners:{afterrender:function(a){a.testBrowser=a;apex.test.TestResultBrowser.loadTestResults()}},items:[{id:"testResultBrowser",region:"center",layout:"fit",items:[{xtype:"treepanel",id:"testResultTree",autoScroll:!0,showRoot:!1,
forceFit:!0,rootVisible:!1,viewConfig:{markDirty:!1},root:{text:"Test Runs",allowDrag:!1,allowDrop:!1,leaf:!1,isTarget:!1,expanded:!0,key:"",root:!0,value:""},fields:["name",{name:"enqueuedTime",type:"date"},"duration","status","failures","total","classid","methodid","parentid","parentinfo","runid","jobid","result","error","stacktrace","sync"],columns:[{dataIndex:"status",header:"Status",maxWidth:45,minWidth:45,renderer:function(a,b,c,d,e,f){b=a=c.data.status;if("Pass"==a)a="Completed";else if("Fail"==
a||"CompileFail"==a||"Skip"==a)a="Failed";return'\x3cdiv class\x3d"clipwrapper"\x3e\x3cimg src\x3d"/img/apex/'+("Processing"==a?"processing.gif":"test_queue_sprite.png")+'" alt\x3d"'+b+'" title\x3d"'+b+'" class\x3d"clip '+a+'"/\x3e\x3c/div\x3e'}},{dataIndex:"name",header:"Test Run",xtype:"treecolumn",flex:2},{dataIndex:"enqueuedTime",header:"Enqueued Time",maxWidth:175,minWidth:175},{dataIndex:"duration",header:"Duration",flex:1},{dataIndex:"failures",header:"Failures",maxWidth:50,minWidth:50},{dataIndex:"total",
header:"Total",maxWidth:50,minWidth:50}],listeners:{viewready:function(a,b){a.store.sort({direction:"DESC",property:"enqueuedTime"})},beforeitemexpand:function(a,b){"root"!==a.data.parentId&&Ext.getCmp("testResultBrowser").ownerCt.expandClassNode(a)},beforeitemdblclick:function(a,b,c,d,e,f){a=apex.test.TestResultBrowser.getRunNode(b);Sfdc.isEmpty(a.data.runid)?apex.ide.Viewer.open({id:a.data.name,Name:a.data.name,xtype:"testresultsync",methodid:b.data.methodid}):apex.ide.Viewer.open({id:a.data.runid,
Name:a.data.name,xtype:"testresult",methodid:b.data.methodid});return!1}}}]},{xtype:"bufferedmemorygrid",region:"east",layout:"fit",title:"Overall Code Coverage",id:"aggregateCoverageGrid",width:350,collapsible:!0,store:new SfdcDevConsole.BufferedMemoryStore({id:"aggregateCoverageStore",model:"apex.test.AggregateCoverageModel"}),columns:[{dataIndex:"className",text:"Class",flex:4},{dataIndex:"percent",text:"Percent",flex:1,renderer:function(a,b,c){return 0===c.getId()?"\x3cb\x3e"+a+"%\x3c/b\x3e":
"-"===c.data.numLines?"-":a+"%"}},{dataIndex:"numLines",text:"Lines",flex:1}],listeners:{itemdblclick:function(a,b,c,d,e,f){var h=b.data.classId;h&&apex.ide.Viewer.open({id:h,Name:b.data.className,xtype:"apexeditor"},function(){var a=Ext.getCmp(h).coverageCycle.menu.items.items[1];Ext.getCmp(h).coverageCycle.setActiveItem(a)})},afterrender:function(a){a.testBrowser=a.ownerCt;a.testBrowser.codeCoverage=a;a.load()},sortchange:function(a,b,c){Ext.getCmp("aggregateCoverageGrid").updateOverallCoverage()}},
load:function(){apex.test.TestResultBrowser.getAggregateCoveragePercentages(function(a){Ext.getStore("aggregateCoverageStore").setRecords(a);apex.test.TestResultBrowser.getOrgCodeCoveragePercent(apex.test.TestResultBrowser.setCodeCovFunc);a=Ext.getCmp("editors").items.items;for(var b=0;b<a.length;b++)tab=a[b],"apexeditor"===tab.xtype&&tab.updateCoverageCycle()})},updateOverallCoverage:function(){var a=Ext.getStore("aggregateCoverageStore");a.remove([a.getById(0)]);a.insert(0,[{className:"\x3cb\x3eOverall\x3c/b\x3e",
percent:apex.test.TestResultBrowser.overallCoveragePercentage,classId:0}],!0)}}]});this.callParent()},testSelectWindow:null,selectClass:function(a){for(var b=Ext.getCmp("selectedTestsList"),c=Ext.getCmp("selectedTestsList").getStore(),d=Ext.getCmp("selectTestsGrid").getSelectionModel(),e=b.getStore().getGroups(),f=0;f<e.length;f++)if(e[f].name===a.data.classId){b.getStore().remove(e[f].children);break}c.add({methodName:Test.Constants.ALL_METHODS_SELECTED,classId:a.data.classId,className:a.data.className,
testId:"All",namespace:a.data.namespace});d.selectAll(!0);b.getView().refresh()},deSelectClass:function(a){var b=Ext.getCmp("selectedTestsList"),c=Ext.getCmp("selectedTestsList").getStore();a=c.find("classId",a.data.classId);c.removeAt(a);b.getView().refresh()},updateTestMethods:function(){var a=Ext.getCmp("selectTestsGrid"),b=a.getStore().data.items[0].data.classId;Ext.getCmp("selectedTestsList").getStore();var c=Ext.getCmp("selectedTestsList").getStore().getGroups();a.getSelectionModel().deselectAll(!0);
for(i=0;i<c.length;i++)if(c[i].name===b)if("All"===c[i].children[0].data.testId){a.getSelectionModel().selectAll(!0);break}else{var d=c[i].children;for(j=0;j<d.length;j++){var e=a.getStore().find("methodName",d[j].data.methodName);a.getSelectionModel().select(e,!0,!0)}}},getTestSelectWindow:function(){null===this.testSelectWindow&&(this.testSelectWindow=new Ext.Window({title:"Select Tests",numTestMethods:{},maxFailedTests:"",modal:!0,layout:{type:"hbox",align:"stretch"},width:Math.floor(Ext.getCmp("apexCSIViewport").getWidth()/
2),height:Math.floor(Ext.getCmp("apexCSIViewport").getHeight()/2),closeAction:"hide",bodyStyle:"background: #fff;",selected:[],listeners:{show:function(a){a.setLoading(!0);Ext.getCmp("selectTestClassesGrid").getStore().removeAll();Ext.getCmp("selectTestsGrid").getStore().removeAll();Ext.getCmp("selectedTestsList").getStore().removeAll();Ext.getCmp("selectTestsGrid").getSelectionModel().toggleUiHeader(!1);apex.test.TestResult.getTestClasses(function(b,c){try{for(var d=[],e=0;e<c.length;e++)d.push({namespace:c[e][0]});
Ext.getCmp("testClassNamespaces").getStore().loadData(d);for(var d=[],e=[],f=0,h=b.length;f<h;f++)-1===Sfdc.Array.indexOf(a.selected,b[f].id)?d.push({className:b[f].name,classId:b[f].id,namespace:b[f].ns}):e.push({className:b[f].name,classId:b[f].id,namespace:b[f].ns});Ext.getCmp("selectTestClassesGrid").getStore().loadData(d);Ext.getCmp("selectTestsGrid").getStore().loadData(e);var g="["+LC.getLabel("Page_ApexTestQueue","MyNamespace")+"]";Ext.getCmp("selectTestClassesGrid").getStore().filter("namespace",
g);Ext.getCmp("testClassNamespaces").setValue(g)}finally{a.setLoading(!1)}})},beforeclose:function(a){null===Ext.getCmp("numFailsWindow")||void 0===Ext.getCmp("numFailsWindow")||Ext.getCmp("numFailsWindow").close()},beforehide:function(a){null===Ext.getCmp("numFailsWindow")||void 0===Ext.getCmp("numFailsWindow")||Ext.getCmp("numFailsWindow").close()}},items:[{xtype:"panel",forceFit:!0,flex:1,layout:{type:"vbox",align:"stretch"},items:[{title:"Test Classes",xtype:"grid",id:"selectTestClassesGrid",
forceFit:!0,layout:"fit",flex:1,multiSelect:!0,listeners:{itemclick:function(a,b,c,d,e){Ext.getCmp("selectTestsGrid").setTitle(b.data.className+" Tests");var f=b.data.classId;SfdcDevConsole.ToolingAPI.query("select id, symboltable from apexclass where id \x3d '"+f+"'",{continuation:function(a){var b=[];a=a.records[0];for(var c=0;c<a.SymbolTable.methods.length;c++){var d=a.SymbolTable.methods[c],e=f+d.name;if(void 0!==d.annotations&&0!==d.annotations.length)for(var m=0;m<d.annotations.length;m++)if("IsTest"===
d.annotations[m].name){b.push({methodName:d.name,classId:f,className:a.SymbolTable.name,testId:e,namespace:a.SymbolTable.namespace});break}}apex.test.TestResultBrowser.getTestSelectWindow().numTestMethods[f]=b.length;a=Ext.getCmp("selectTestsGrid");a.getStore().loadData(b);a.getView().refresh();Ext.getCmp("testResults").updateTestMethods()}})}},columns:[{header:"Name",dataIndex:"className"}],store:Ext.create("Ext.data.Store",{model:"apex.test.classSelectModel",sorters:[{property:"className",direction:"ASC"}]})},
{id:"selectTestsSelectAllButton",xtype:"button",text:"Add Selected",handler:function(a){a=Ext.getCmp("selectTestClassesGrid").getSelectionModel().getSelection();for(var b=0;b<a.length;b++){var c=a[b];Ext.getCmp("testResults").selectClass(c)}Ext.getCmp("testResults").updateTestMethods()}}]},{title:"Tests",xtype:"grid",id:"selectTestsGrid",forceFit:!0,layout:"fit",flex:1,multiSelect:!0,selType:"checkboxmodel",selModel:{checkOnly:!0,injectCheckbox:1,showHeaderCheckbox:!0,listeners:{select:function(a,
b,c,d){a=Ext.getCmp("selectTestsGrid");c=Ext.getCmp("selectTestClassesGrid");d=Ext.getCmp("selectedTestsList");if(a.getStore().getCount()===a.getSelectionModel().getCount()){var e=c.getStore().find("classId",b.data.classId);Ext.getCmp("testResults").selectClass(c.getStore().data.items[e])}else-1==d.getStore().findBy(function(a,c){return a.get("testId")===b.data.testId?!0:!1})&&d.getStore().add({methodName:b.data.methodName,className:b.data.className,classId:b.data.classId,testId:b.data.testId,namespace:b.data.namespace,
selectTestsGridIndex:b.index});d.getView().refresh();a.getView().refresh()},deselect:function(a,b,c,d){a=Ext.getCmp("selectedTestsList");c=Ext.getCmp("selectTestsGrid");d=function(a){return function(b,c){if(b.get("testId")===a.data.testId)return!0}};for(var e=a.getStore().getGroups(),f=0;f<e.length;f++)if(e[f].name===b.data.classId){if("All"===e[f].children[0].data.testId){a.getStore().remove(e[f].children);b=[];for(d=0;d<c.getSelectionModel().selected.items.length;d++)b.push(c.getSelectionModel().selected.items[d]);
a.getStore().add(b);c.getView().refresh()}else b=a.getStore().findBy(d(b)),a.getStore().removeAt(b);a.getView().refresh();break}}}},columns:[{header:"Name",dataIndex:"methodName"}],store:Ext.create("Ext.data.Store",{model:"apex.test.testsSelectModel",sorters:[{property:"methodName",direction:"ASC"}]})},{xtype:"panel",forceFit:!0,flex:1,layout:{type:"vbox",align:"stretch"},items:[{title:"Selected Tests",xtype:"grid",id:"selectedTestsList",forceFit:!0,layout:"fit",flex:1,multiSelect:!0,features:[{ftype:"grouping",
groupHeaderTpl:"{[values.rows[0].data.className]}",hideGroupedHeader:!0,startCollapsed:!1}],columns:[{header:"Name",dataIndex:"methodName"}],store:Ext.create("Ext.data.Store",{model:"apex.test.testsSelectModel",groupField:"classId",sorters:[{property:"className",direction:"ASC"}]})},{id:"selectTestsRemoveAllButton",xtype:"button",text:"Remove Selected",handler:function(a){a=Ext.getCmp("selectedTestsList");var b=a.getSelectionModel().getSelection();a.getStore().remove(b);a.getView().refresh();Ext.getCmp("testResults").updateTestMethods()}}]}],
bbar:[{id:"testClassFilterText",xtype:"textfield",width:165,emptyText:"Filter test classes (* \x3d any)",enableKeyEvents:!0,listeners:{keyup:function(a,b){apex.test.TestResultBrowser.getTestSelectWindow().filterTestClassesTask.delay(500)}}},{xtype:"combobox",id:"testClassNamespaces",typeAhead:!0,store:Ext.create("Ext.data.Store",{fields:["namespace"]}),queryMode:"local",displayField:"namespace",listeners:{select:function(a,b,c){0!==b.length&&(a=b[0].data.namespace,b=Ext.getCmp("selectTestClassesGrid").getStore(),
c="["+LC.getLabel("Page_ApexTestQueue","AllNamespaces")+"]",b.clearFilter(),a!==c&&b.filter("namespace",a))}}},{xtype:"tbfill"},{xtype:"button",text:"Settings",id:"settingsButton",handler:function(a){null===Ext.getCmp("numFailsWindow")||void 0===Ext.getCmp("numFailsWindow")?Ext.create("Ext.window.Window",{title:"Specify Run Parameters",id:"numFailsWindow",height:130,width:300,bodyPadding:10,buttons:[{text:"Cancel",handler:function(a){Ext.getCmp("numFailsWindow").destroy()}},{text:"OK",id:"numFailsWindowOkButton",
formBind:!0,handler:function(a){apex.test.TestResultBrowser.getTestSelectWindow().maxFailedTests=Ext.getCmp("failuresTextField").getValue();Ext.getCmp("numFailsWindow").destroy()}}],items:[{id:"failuresTextField",xtype:"numberfield",fieldLabel:"Number of failures allowed",labelSeparator:"",value:apex.test.TestResultBrowser.getTestSelectWindow().maxFailedTests,anchor:"100%",hideTrigger:!0,keyNavEnabled:!1,mouseWheelEnabled:!1,validator:function(a){if(""===a||-1<=a&&1E6>=a)return Ext.getCmp("numFailsWindowOkButton").enable(),
!0;Ext.getCmp("numFailsWindowOkButton").disable();return"Value must be an integer. To limit the number of failed tests, use an integer between 0 and 1,000,000. To allow all tests to run, use -1."}}]}).show():Ext.getCmp("numFailsWindow").toFront(!1)}},{xtype:"button",text:"Run",id:"testSelectRunButton",handler:function(a){a=[];for(var b=Ext.getCmp("selectedTestsList").getStore().getGroups(),c=0;c<b.length;c++){for(var d=[],e=b[c].children,f=0;f<e.length;f++)d.push(e[f].data.methodName);b[c].children[0].data.methodName===
Test.Constants.ALL_METHODS_SELECTED&&(d=null);a.push({classId:b[c].name,testMethods:d})}0<a.length?(b=apex.ide.IDE.runTestsSynchronously(a),c=apex.test.TestResultBrowser.getTestSelectWindow().maxFailedTests,null===c||""===c?apex.ide.IDE.runSelectedTests(a,b,{},-1):apex.ide.IDE.runSelectedTests(a,b,{},c),apex.test.TestResultBrowser.getTestSelectWindow().hide(),apex.test.TestResultBrowser.getTestSelectWindow().maxFailedTests=""):Ext.Msg.alert("Run Test Error","Select at least one test.")}}],filterTestClasses:function(){Ext.getCmp("selectTestsGrid").setTitle("Tests");
Ext.getCmp("selectTestsGrid").getStore().removeAll();Ext.getCmp("selectTestsGrid").getView().refresh();for(var a=Ext.getCmp("selectTestClassesGrid"),b=[],c=0;c<a.getSelectionModel().selected.items.length;c++)b[c]=a.getSelectionModel().selected.items[c];a.getStore().clearFilter();var c=Ext.getCmp("testClassFilterText").getValue(),d=SfdcDevConsole.Core.Search.getWildcardFilterFunction(c);a.getStore().filter(function(a){return d(a.data.className)});a.getStore().sort();a.getSelectionModel().select(b,
!0,!0)},filterTestClassesTask:new Ext.util.DelayedTask(function(a){apex.test.TestResultBrowser.getTestSelectWindow().filterTestClasses()})}));return this.testSelectWindow},loadTestResults:function(){if(void 0===this.loadTestResultsRequest||null!==this.loadTestResultsRequest.response)this.loadTestResultsRequest=SfdcDevConsole.ToolingAPI.request({url:"/_ui/common/apex/test/ApexTestQueueServlet",data:{action:"STATUS"},success:function(a,b){var c=Util.evalAjaxServletOutput(a);c.success?apex.test.TestResultBrowser.processTestResults(c):
Ext.Msg.alert("Internal Salesforce.com Error",c.error)},alertOnFailure:!0})},initTestBrowser:function(){var a=Ext.getCmp("testResultTree").getRootNode(),b=Ext.getCmp("editors");for(i=0;i<b.items.items.length;){var c=b.items.items[i];"testresult"===c.xtype&&!a.findChild("runid",c.id)?c.ownerCt.remove(c):i++}Ext.getCmp("testResultTree").loaded=!0;Ext.getCmp("aggregateCoverageGrid").load()},getRunStatus:function(a){for(var b=!0,c=!0,d=!1,e=!1,f=!0,h=!1,g=0;g<a.length;g++){var k=a[g].status;k||(k=a[g].data.status);
b=b&&("Completed"===k||"Aborted"===k);c=c&&("Queued"===k||"Aborted"===k);d=d||"Queued"===k;e=e||"Processing"===k;f=f&&"Aborted"===k;h=h||"Failed"===k}return e||h&&d?"Processing":h?"Failed":f?"Aborted":c?"Queued":b?"Completed":"Processing"},getTestClassData:function(a){var b=/\((\d+).(\d+)\)/.exec(a.extstatus),c=null,d=null;b&&3==b.length&&(d=parseInt(b[2],10),c=d-parseInt(b[1],10));a={name:a.classname,status:a.status&&0<c?"Failed":a.status,failures:c,total:d,jobid:a.id,classid:a.classid,leaf:!0,expandable:!1};
if("Completed"===a.status||"Failed"===a.status)a.expandable=!0,a.leaf=!1,apex.test.TestResult.invalidateCoverageForTestClass(a.classid);return a},processTestResults:function(a){Ext.getCmp("testResultTree").loaded||apex.test.TestResultBrowser.initTestBrowser();if(a&&a.apexTestJobs&&0!==a.apexTestJobs.length){var b=!1,c=Ext.getCmp("testResultTree").getRootNode();Ext.suspendLayouts();try{var d=[],e={};if(null!==c.children)for(var f=0;f<c.childNodes.length;f++){var h=c.childNodes[f],g=e[h.parentid];g||
(g={node:h,children:{}},e[h.data.runid]=g);if(null!==h.childNodes)for(var k=0;k<h.childNodes.length;k++){var q=h.childNodes[k];g.children[q.data.jobid]=q}}h={};g=[];k=[];for(f=0;f<a.apexTestJobs.length;f++){var l=a.apexTestJobs[f],m=e[l.parentid],n=this.getTestClassData(l);if(m){var p=m.node,r=m.children[l.id];if(r){if(n.status!==r.data.status&&n.failures!==r.data.failures&&n.total!==r.data.total){var t=r.data.failures,u=r.data.total;r.set("status",n.status);r.set("failures",n.failures);r.set("total",
n.total);p.set("failures",n.failures-t);p.set("total",n.total-u);if("Completed"===r.data.status||"Failed"===r.data.status)r.set("expandable",!0),r.set("leaf",!1);k.push(p);b=!0}}else p.appendChild(n),p.set("failures",p.data.failures+n.failures),p.set("total",p.data.total+n.total),k.push(p),b=!0}else{var s=h[l.parentid];if(!s){var v=SfdcDevConsole.ToolingAPI.getMilliSecondsFromAPIDate(l.date),s={name:l.parentid,enqueuedTime:(new Date(v)).toLocaleString(),runid:l.parentid,status:status,failures:0,total:0,
children:[]};h[l.parentid]=s;d.push(s);g.push(s)}s.children.push(n);s.failures+=n.failures;s.total+=n.total;b=!0}}for(f=0;f<g.length;f++)s=g[f],s.status=this.getRunStatus(s.children);for(f=0;f<k.length;f++)p=k[f],p.set("status",this.getRunStatus(p.childNodes)),p.commit();0<d.length&&(c.appendChild(d),c.commit());Ext.getCmp("testResultTree").loaded?b&&Ext.getCmp("aggregateCoverageGrid").load():apex.test.TestResultBrowser.initTestBrowser()}finally{Ext.resumeLayouts(!0)}}},loadClassNodes:function(a,
b,c){for(var d=[],e=0;e<a.childNodes.length;e++)d.push(a.childNodes[e].data.jobid);b.loadData([],!0);0===d.length?"function"===typeof c&&c():Ext.Ajax.request({url:"/_ui/common/apex/test/ApexTestQueueServlet",params:{action:"GET_MULTIPLE_TEST_RESULTS",jobid:d},success:function(d,h){var g=Util.evalAjaxServletOutput(d.responseText);if(g.success){var k=[];try{for(e=0;e<g.testResults.length;e++){var q=g.testResults[e],l=a.findChild("classid",q.classid);0<l.childNodes.length&&!l.childNodes[0].isLeaf()&&
l.removeChild(l.childNodes[0]);var m=l.findChild("methodid",q.id);m||(m=l.appendChild({name:q.method,duration:q.duration,status:q.outcome,classid:q.classid,methodid:q.id,error:q.message,stacktrace:q.stacktrace,logid:q.logid,leaf:!0}));k.push({jobid:l.data.jobid,classid:l.data.classid,methodid:m.data.methodid,className:l.data.name,method:m.data.name,duration:m.data.duration,result:m.data.status,error:m.data.error,stacktrace:m.data.stacktrace,logid:q.logid})}b.loadData(k,!0);b.fireEvent("load",this);
Ext.getCmp("testResultTree").getView().refresh()}finally{"function"===typeof c&&c()}}else Ext.Msg.alert("Internal Salesforce.com Error",g.error)},failure:function(a,b){Ext.MessageBox.alert("Error","Could not load test result")}})},expandClassNode:function(a,b){if(0<a.childNodes.length){if(a.childNodes[0].isLeaf())return;a.removeChild(a.childNodes[0])}Ext.Ajax.request({url:"/_ui/common/apex/test/ApexTestQueueServlet",params:{action:"GET_TEST_RESULTS",jobid:a.data.jobid},success:function(c,d){var e=
Util.evalAjaxServletOutput(c.responseText);if(e.success){for(var f=0;f<e.testResults.length;f++)testResult=e.testResults[f],a.findChild("methodid",testResult.id)||a.appendChild({name:testResult.method,duration:testResult.duration,status:testResult.outcome,classid:testResult.classid,methodid:testResult.id,error:testResult.message,stacktrace:testResult.stacktrace,logid:testResult.logid,leaf:!0});"function"===typeof b&&b(a)}else Ext.Msg.alert("Internal Salesforce.com Error",e.error)},failure:function(a,
b){Ext.MessageBox.alert("Error","Could not load test result")}})},getRunNode:function(a){return"root"!==a.data.parentId?apex.test.TestResultBrowser.getRunNode(a.parentNode):a},expandAllChildren:function(a){for(var b=0;b<a.childNodes.length;b++)a.childNodes[b].expand(),arguments.callee(a.childNodes[b])},collapseAllChildren:function(a){for(var b=0;b<a.childNodes.length;b++)a.childNodes[b].collapse(),arguments.callee(a.childNodes[b])},abortTestRuns:function(a,b,c){a={action:"ABORT",jobid:a};b&&0<b.length&&
(a.classid=b);Ext.Ajax.request({url:"/_ui/common/apex/test/ApexTestQueueServlet",params:a,success:function(a,b){"function"===typeof c&&c()},failure:function(a,b){Ext.MessageBox.alert("Error","Unabled to abort test runs.")}})},clearTestResults:function(a){Ext.MessageBox.progress("Clearing test data...");Ext.Ajax.request({url:"/_ui/common/apex/test/ApexTestQueueServlet",params:{action:"CLEAR_TEST_RESULTS"},success:function(b,c){"function"===typeof a&&a();Ext.MessageBox.updateProgress(1,"Success","Test data has been cleared");
Ext.MessageBox.hide()},failure:function(a,c){Ext.MessageBox.alert("Error","Unable to clear test data.")}})},getAggregateCoveragePercentages:function(a){SfdcDevConsole.ToolingAPI.query("SELECT ApexClassOrTriggerId, ApexClassOrTrigger.Name, NumLinesCovered, NumLinesUncovered FROM ApexCodeCoverageAggregate  WHERE ApexClassOrTriggerId !\x3d NULL AND ApexClassOrTrigger.Name !\x3d NULL AND (NumLinesCovered \x3e 0 OR NumLinesUncovered \x3e 0) AND NumLinesCovered !\x3d NULL AND NumLinesUncovered !\x3d NULL ORDER BY ApexClassOrTrigger.Name",
{continuation:function(b){for(var c=[],d=0;d<b.records.length;d++){var e=b.records[d],f=null,h="-";null!==e.NumLinesCovered&&null!==e.NumLinesUncovered&&(f=apex.test.TestResult.getPercent(e.NumLinesCovered,e.NumLinesUncovered),h=apex.test.TestResult.getNumLineStr(e.NumLinesCovered,e.NumLinesUncovered));c.push({classId:e.ApexClassOrTriggerId,className:e.ApexClassOrTrigger.Name,percent:f,numLines:h})}"function"===typeof a&&a(c)},alertOnFailure:!0,failureMessage:"Could not load code coverage"})},getOrgCodeCoveragePercent:function(a){SfdcDevConsole.ToolingAPI.query("SELECT PercentCovered FROM ApexOrgWideCoverage",
{continuation:function(b){b&&b.records&&0!==b.records.length&&"function"===typeof a&&a(b.records[0].PercentCovered)},failure:function(a,c){SfdcDevConsole.ToolingAPI.handleFailedRequest(a,"Could not load overall code coverage percent",!0)}})},setCodeCovFunc:function(a){apex.test.TestResultBrowser.overallCoveragePercentage=a;Ext.getCmp("aggregateCoverageGrid").updateOverallCoverage()}});
Ext.define("apex.test.TestResult",{alias:"widget.testresult",extend:"apex.ide.Viewer",loaded:!1,status:{COMPLETED:"Completed",FAIL:"Fail"},initComponent:function(){Ext.apply(this,{layout:"border",items:[{region:"center",xtype:"panel",layout:"fit",items:[{xtype:"grid",store:Ext.create("Ext.data.Store",{model:"apex.test.TestResultDetailModel"}),columns:[{dataIndex:"className",text:"Class",width:150},{dataIndex:"method",text:"Method",width:150},{dataIndex:"duration",text:"Duration",maxWidth:53,minWidth:53},
{dataIndex:"result",text:"Result",maxWidth:50,minWidth:50},{dataIndex:"error",text:"Errors",width:230},{dataIndex:"stacktrace",text:"Stack Trace",width:230}],plugins:[Ext.create("apex.plugins.GridColumnResizer",5),Ext.create("apex.plugins.GridCellPopup",4)],listeners:{afterrender:function(a){a.testResultTab=a.ownerCt.ownerCt;a.testResultTab.resultGrid=a},celldblclick:function(a,b,c,d,e,f,h,g){if(4>c){var k=ApiUtils.to18CharId(d.data.logid);a=Ext.getCmp("traceGrid").getStore().snapshot.findBy(function(a){return a.data.Id===
k});apex.ide.Viewer.open({id:"l-"+k,logId:k,Name:a?"Log "+a.data.Operation+" @"+(new Date(a.data.StartTime)).toLocaleString():"Log ",xtype:"logviewer"});return!1}}},selModel:{mode:"SINGLE",listeners:{selectionchange:function(a,b,c){(record=b[0])&&a.view.ownerCt.testResultTab.loadCoverageForMethod(record.data.classid,record.data.method)}}}}]},{xtype:"grid",region:"east",layout:"fit",title:"Class Code Coverage",width:350,collapsible:!0,store:Ext.create("Ext.data.Store",{model:"apex.test.CodeCoverageListModel"}),
columns:[{dataIndex:"className",header:"Class",flex:4},{dataIndex:"percent",text:"Percent",flex:1,renderer:function(a,b,c){return a+"%"}},{dataIndex:"numLines",text:"Lines",flex:1}],listeners:{itemdblclick:function(a,b,c,d,e,f){var h=b.data.classId,g=b.data.testClassId;apex.ide.Viewer.open({id:h,Name:b.data.className,xtype:"apexeditor"},function(){for(var a=Ext.getCmp(h),b=a.coverageCycle.menu.items.items[0],c=2;c<a.coverageCycle.menu.items.items.length;c++){var d=a.coverageCycle.menu.items.items[c];
if(d.testId&&d.testId===g){b=d;break}}a.coverageCycle.setActiveItem(b)})},afterrender:function(a){a.testResultTab=a.ownerCt;a.testResultTab.coverageGrid=a}}}],listeners:{afterrender:function(a){a.testResultDetailStore=a.items.items[0].items.items[0].store;a.coverageStore=a.items.items[1].items.items[0].store}}});this.callParent()},loadContent:function(){this.methodid&&(record=this.resultGrid.store.getById(this.methodid))&&this.resultGrid.getSelectionModel().select(record);!0===this.loaded?this.fireEvent("afterLoad"):
this.refresh()},refresh:function(){Ext.getCmp("testResultTree").getRootNode();if(Ext.getCmp("testResultTree").loaded){var a=this,b=Ext.getCmp("testResultTree").getRootNode().findChild("runid",a.id);b?(a.testResultDetailStore.removeAll(),a.resultGrid.setLoading(!0),apex.test.TestResultBrowser.loadClassNodes(b,a.testResultDetailStore,function(){a.resultGrid.setLoading(!1);a.fireEvent("afterLoad")}),a.loaded=!0):a.ownerCt.remove(a)}else"function"===typeof b&&b()},loadCoverageForMethod:function(a,b){var c=
this;c.coverageGrid.setLoading(!0);Ext.suspendLayouts();apex.test.TestResult.getNumLinesCoveredForMethod(a,b,function(a){c.coverageStore.loadData(a,!1)},function(){c.coverageGrid.setLoading(!1);Ext.resumeLayouts(!0)})},statics:{testCoverageCache:{},testCoverageCacheByClass:{},invalidatedCoverageClassIds:{},updateTimeConstant:30,classesUpdateTime:0,triggersUpdateTime:0,invalidateCoverageForClass:function(a){if(a=apex.test.TestResult.testCoverageCacheByClass[a])for(var b=0;b<a.length;b++)a[b]&&(a[b].valid=
!1),delete a[b]},invalidateCoverageForTestClass:function(a){delete apex.test.TestResult.testCoverageCache[a]},getCoverageCache:function(a,b,c){apex.test.TestResult.testCoverageCache[b]||(apex.test.TestResult.testCoverageCache[b]={});apex.test.TestResult.testCoverageCache[b][c]||(apex.test.TestResult.testCoverageCache[b][c]={});return null===apex.test.TestResult.testCoverageCache[b][c][a]?null:void 0===apex.test.TestResult.testCoverageCache[b][c][a]||!1===apex.test.TestResult.testCoverageCache[b][c][a].valid?
void 0:apex.test.TestResult.testCoverageCache[b][c][a]},cacheCoverage:function(a,b,c,d){apex.test.TestResult.testCoverageCache[a]||(apex.test.TestResult.testCoverageCache[a]={});apex.test.TestResult.testCoverageCache[a][b]||(apex.test.TestResult.testCoverageCache[a][b]={});apex.test.TestResult.testCoverageCache[a][b][c]=d;apex.test.TestResult.testCoverageCacheByClass[c]||(apex.test.TestResult.testCoverageCacheByClass[c]=[]);apex.test.TestResult.testCoverageCacheByClass[c].push(d)},getNumLinesCoveredForMethod:function(a,
b,c,d){SfdcDevConsole.ToolingAPI.query("SELECT ApexClassOrTriggerId, ApexClassOrTrigger.Name, NumLinesCovered, NumLinesUncovered  FROM ApexCodeCoverage  WHERE ApexTestClassId \x3d '"+a+"' AND TestMethodName \x3d '"+b+"'",{continuation:function(b){try{(!b||!b.records)&&SfdcDevConsole.ToolingAPI.handleFailedRequest(null,"Could not load code coverage",!0);for(var f=[],h=0;h<b.records.length;h++){var g=b.records[h];f.push({className:g.ApexClassOrTrigger.Name,percent:0<g.NumLinesUncovered+g.NumLinesCovered?
Math.floor(100*g.NumLinesCovered/(g.NumLinesCovered+g.NumLinesUncovered)):0,numLines:g.NumLinesCovered+"/"+(g.NumLinesCovered+g.NumLinesUncovered),testClassId:a,classId:g.ApexClassOrTriggerId})}"function"===typeof c&&c(f)}finally{"function"===typeof d&&d()}},failure:function(a,b){"function"===typeof d&&d();SfdcDevConsole.ToolingAPI.handleFailedRequest(a,"Could not load code coverage",!0)}})},getCodeCoverageForMethod:function(a,b,c,d){SfdcDevConsole.ToolingAPI.query("SELECT ApexClassOrTriggerId, ApexClassOrTrigger.Name, Coverage  FROM ApexCodeCoverage  WHERE ApexTestClassId \x3d '"+
b+"' AND TestMethodName \x3d '"+c+"' AND ApexClassOrTriggerId \x3d '"+a+"'",{continuation:function(a){(!a||!a.records)&&SfdcDevConsole.ToolingAPI.handleFailedRequest(null,"Could not load code coverage",!0);0!==a.records.length&&(a=a.records[0],a={classId:a.ApexClassOrTriggerId,locationsCovered:a.Coverage.coveredLines,locationsNotCovered:a.Coverage.uncoveredLines,name:a.ApexClassOrTrigger.Name,percentage:0!==a.Coverage.uncoveredLines.length+a.Coverage.coveredLines.length?Math.floor(100*a.Coverage.coveredLines.length/
(a.Coverage.uncoveredLines.length+a.Coverage.coveredLines.length)):0},"function"===typeof d&&d(a))},alertOnFailure:!0,failureMessage:"Could not load code coverage"})},getAggregateCodeCoverage:function(a,b){SfdcDevConsole.ToolingAPI.query("SELECT ApexClassOrTriggerId, ApexClassOrTrigger.Name, Coverage  FROM ApexCodeCoverageAggregate WHERE ApexClassOrTriggerId \x3d '"+a+"'",{continuation:function(a){(!a||!a.records)&&SfdcDevConsole.ToolingAPI.handleFailedRequest(null,"Could not load code coverage",
!0);0!==a.records.length&&(a=a.records[0],a={classId:a.ApexClassOrTriggerId,locationsCovered:a.Coverage.coveredLines,locationsNotCovered:a.Coverage.uncoveredLines,name:a.ApexClassOrTrigger.Name,numLinesCovered:a.Coverage.coveredLines.length,numLinesUncovered:a.Coverage.uncoveredLines.length},"function"===typeof b&&b(a))},alertOnFailure:!0,failureMessage:"Could not load code coverage"})},updateClassesAndTriggers:function(){apex.test.TestResult.classesUpdateTime=0;apex.test.TestResult.triggersUpdateTime=
0},getTestClasses:function(a,b){var c=this;b||!c.testClasses||void 0===c.testClassesUpdateTime||c.testClassesUpdateTime+1E3*apex.test.TestResult.updateTimeConstant<(new Date).getTime()?(Ext.Ajax.request({url:"/_ui/common/apex/test/ApexTestQueueServlet",params:{action:"GET_TESTS"},success:function(b,e){var f=Util.evalAjaxServletOutput(b.responseText);f.success&&(c.testClasses=f.testClasses,c.namespaces=f.namespaces,"function"===typeof a&&a(c.testClasses,c.namespaces))}}),c.testClassesUpdateTime=(new Date).getTime()):
"function"===typeof a&&a(c.testClasses,c.namespaces)},isTest:function(a,b){Ext.Ajax.request({url:"/_ui/common/apex/test/ApexTestQueueServlet",params:{action:"IS_TEST",classid:a},success:function(a,d){var e=Util.evalAjaxServletOutput(a.responseText);e.success&&"function"===typeof b&&b(e.isTest)},failureMessage:"Could not determine if class contains a test"})},getTestsFor:function(a,b){SfdcDevConsole.ToolingAPI.query("SELECT ApexTestClassId, ApexTestClass.Name, TestMethodName, ApexClassOrTriggerId, NumLinesCovered, NumLinesUncovered FROM ApexCodeCoverage WHERE ApexClassOrTriggerId \x3d '"+
a+"'",{continuation:function(c){(!c||!c.records)&&SfdcDevConsole.ToolingAPI.handleFailedRequest(null,"Unabled to find test classes for class or trigger id "+a,!1,!0);"function"===typeof b&&b(c.records)},alertOnFailure:!0,failureMessage:"Unabled to find test classes for class or trigger id "+a})},getNumLineStr:function(a,b){return(a?a:"0")+"/"+(a+b)},getPercent:function(a,b){return 0!==a+b?Math.floor(100*a/(a+b)):0}}});
Ext.define("apex.test.TestResultSync",{alias:"widget.testresultsync",extend:"apex.ide.Viewer",loaded:!1,initComponent:function(){Ext.apply(this,{layout:"border",items:[{region:"center",xtype:"panel",layout:"fit",items:[{xtype:"grid",store:Ext.create("Ext.data.Store",{model:"apex.test.TestResultDetailModel"}),columns:[{dataIndex:"className",text:"Class",width:150},{dataIndex:"method",text:"Method",width:150},{dataIndex:"duration",text:"Duration",maxWidth:53,minWidth:53},{dataIndex:"result",text:"Result",
maxWidth:50,minWidth:50},{dataIndex:"error",text:"Errors",width:230},{dataIndex:"stacktrace",text:"Stack Trace",width:230}],plugins:[Ext.create("apex.plugins.GridColumnResizer",5),Ext.create("apex.plugins.GridCellPopup",4)],listeners:{afterrender:function(a){a.testResultTab=a.ownerCt.ownerCt;a.testResultTab.resultGrid=a}},selModel:{mode:"SINGLE",listeners:{selectionchange:function(a,b,c){(record=b[0])&&a.view.ownerCt.testResultTab.loadCoverageForMethod(record.data.classid,record.data.method)}}}}]}],
listeners:{afterrender:function(a){a.testResultDetailStore=a.items.items[0].items.items[0].store}}});this.callParent()},loadContent:function(){if(!0===this.loaded)this.fireEvent("afterLoad");else if(Ext.getCmp("testResultTree").getRootNode(),Ext.getCmp("testResultTree").loaded){var a=this,b=Ext.getCmp("testResultTree").getRootNode().findChild("name",a.id);b?(a.testResultDetailStore.removeAll(),a.resultGrid.setLoading(!0),a.loadClassNodes(b,a.testResultDetailStore,function(){a.resultGrid.setLoading(!1);
a.fireEvent("afterLoad")}),a.loaded=!0):a.ownerCt.remove(a)}else b()},loadClassNodes:function(a,b,c){try{var d=[],e=a.getChildAt(0);Sfdc.isDefAndNotNull(e)&&(a.getChildAt(0).eachChild(function(a){var b=a.data;Sfdc.isDefAndNotNull(a.data)&&d.push({className:e.data.name,method:b.name,duration:b.duration,result:b.status,error:b.error,stacktrace:b.stacktrace})}),b.loadData(d,!0),b.fireEvent("load",this))}finally{c()}}});
Ext.define("apex.ide.Editor",{extend:"apex.ide.Viewer",dirty:!1,DIRTY_FLAG:" *",setDirty:function(){this.dirty=!0;0>escapeHTML(this.title||this.Name).indexOf(this.DIRTY_FLAG)&&this.setTitle(this.title+this.DIRTY_FLAG)},clearDirty:function(){this.dirty=!1;var a=escapeHTML(this.title||this.Name);this.setTitle(a.replace(this.DIRTY_FLAG,""))},canDelete:function(){return this.canEdit()},canEdit:function(){return!0},save:function(a){if(!this.canEdit())throw"You don't have permissions to save this file.";
},performSave:function(a,b){throw"performSave function is not overwritten";},onClose:function(){},getItems:function(){return[]},initComponent:function(){Ext.apply(this,{layout:"border",items:this.getItems()});this.on({beforeclose:function(){if(this.dirty){var a=this;Ext.Msg.confirm("Close without saving?",'The tab "'+this.Name+'" has changes. Would you like to close without saving?',function(b){"yes"===b&&(a.onClose(),a.ownerCt.remove(a))});return!1}return!0}});this.callParent()},DELETE:function(){var a=
Ext.getCmp("editors");if(this.canDelete()){var b=this.id,c=this;Ext.Msg.confirm("Confirm",LC.getLabel("DeveloperConsole","DeletionMsgNonEssentialType",this.Name),function(d,e){"yes"===d&&(a.remove(c),SfdcDevConsole.Extents.getExtentFromId(b).DELETE(b,function(){apex.test.TestResult.updateClassesAndTriggers()}))})}}});
Ext.define("apex.ide.RestApiWriter",{extend:"Ext.data.writer.Json",writeRecords:function(a,b){this.callParent(arguments);if("create"===a.operation.action)a.operation.batch.on("operationcomplete",function(a,c){if(c.response&&c.response.responseText&&0<c.response.responseText.length){var b=Ext.JSON.decode(c.response.responseText).id;c.records[0].set("Id",b)}});else if(void 0===a.jsonData.Id)throw"ID column must be selected for this operation to be performed";a.jsonData=Ext.clone(a.jsonData);void 0!==
a.jsonData.Id&&(a.jsonData.Id=void 0);"update"===a.operation.action&&(this.model&&this.model.fields)&&Sfdc.each(this.model.fields.items,function(b){"boolean"===typeof b.updatable&&!b.updatable&&delete a.jsonData[b.name]});return a}});
Ext.define("apex.ide.RestApiProxy",{extend:"Ext.data.proxy.Rest",actionMethods:{create:"POST",read:"GET",update:"PATCH",destroy:"DELETE"},constructor:function(a){var b=[];if(void 0!==a.model){var d=Ext.create(a.model);d.fields.each(function(a){if(!Sfdc.isBoolean(a.queriable)||a.queriable){var c=a.queryExpr;void 0===c&&(c=a.name);b.push(c)}},this);for(var c="",e=0;e<b.length;e++)c+=b[e],e<b.length-1&&(c+=", ");a.queryString="SELECT "+c+" FROM "+a.entity;a.queryQuals&&(a.queryString+=" WHERE "+a.queryQuals);
a.orderBy&&(a.queryString+=" ORDER BY "+a.orderBy)}if(!SfdcDevConsole.SID)throw"You can not define a RestAPIProxy on JS load. Wait until load is complete.";c=a.version?a.version:apex.ide.IDE.apiVersion;Ext.apply(a,{writer:Ext.create("apex.ide.RestApiWriter",{model:d}),appendId:!0,pageParam:void 0,headers:{Authorization:"OAuth "+SfdcDevConsole.SID,Accept:"application/json"},api:{create:window.location.protocol+"//"+window.location.host+"/services/data/"+c+(a.tooling?"/tooling":"")+"/sobjects/"+a.entity,
read:window.location.protocol+"//"+window.location.host+"/services/data/"+c+(a.tooling?"/tooling":"")+"/query/?"+Ext.urlEncode({q:a.queryString}),update:window.location.protocol+"//"+window.location.host+"/services/data/"+c+(a.tooling?"/tooling":"")+"/sobjects/"+a.entity,destroy:window.location.protocol+"//"+window.location.host+"/services/data/"+c+(a.tooling?"/tooling":"")+"/sobjects/"+a.entity},startParam:void 0,limitParam:void 0,autoSync:!0,listeners:{exception:function(a,b,c,e){SfdcDevConsole.ToolingAPI.handleFailedRequest(b,
c.error,!0,!0)}}});a.reader||Ext.apply(a,{reader:{type:"json",root:"records",totalProperty:"totalSize"}});this.callParent(arguments)}});Ext.define("apex.soql.SOQLPanel",{extend:"Ext.grid.Panel",alias:"widget.soqlpanel",initComponent:function(){Ext.apply(this,{});this.callParent()}});
Ext.define("apex.soql.SOQLGrid",{extend:"apex.ide.QueryGrid",alias:"widget.soqlgrid",pathRenderer:function(a,b,d,c,e,f){return a?(b=this.columns[e].columnMetadata,Sfdc.isObject(a)?a[b.columnName]:a):"(null "+this.columns[e].parentColumnMetadata.columnName+")"},aggRenderer:function(a,b,d,c,e,f){b=this.columns[e].columnMetadata;c=[];if(a&&a.records){a=a.records;for(f=0;f<a.length;f++){for(var h={},g=0;g<b.joinColumns.length;g++){var k=b.joinColumns[g].columnName;h[k]=a[f][k]}c.push(h)}a=Ext.JSON.encode(c);
return d.data[this.columns[e].dataIndex]=a}return d&&d.data&&void 0!==d.data[b.columnName]?d.data[b.columnName]:""},makeColumn:function(a,b){var d="textfield",c,e,f=void 0;a.textType?d="textfield":a.booleanType?d="checkbox":a.numberType&&(d="numberfield",f=20);void 0!==b?(c=b.displayName+"."+a.displayName,e=b.columnName):(c=a.displayName,e=a.columnName);d={editor:{xtype:d,readOnly:!a.updatable,decimalPrecision:f},dataIndex:e,header:c,columnMetadata:a};void 0!==b?(d.renderer=this.pathRenderer,d.parentColumnMetadata=
b):a.aggregate?d.renderer=this.aggRenderer:a.textType&&(d.renderer=Ext.util.Format.htmlEncode);return Ext.create("Ext.grid.column.Column",d)},initComponent:function(){var a=this.bbar&&this.bbar.items?this.bbar.items:[];Ext.apply(this,{selModel:{mode:"MULTI"},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:2})]});a.push({xtype:"label",text:"Query Grid:"},{text:"Save Rows",xtype:"button",listeners:{afterrender:function(a){this.queryGrid=this.ownerCt.ownerCt;this.queryGrid.saveButton=
this},click:function(a,b){this.queryGrid.validateAction("save rows",function(){this.queryGrid.getStore().sync()},this)}}},{text:"Insert Row",xtype:"button",listeners:{afterrender:function(a){this.queryGrid=this.ownerCt.ownerCt;this.queryGrid.addButton=this},click:function(a,b){this.queryGrid.validateAction("insert a record",function(){var a=Ext.create(this.ownerCt.ownerCt.ownerCt.Name);this.queryGrid.getStore().insert(0,a)},this)}}},{text:"Delete Row",xtype:"button",listeners:{afterrender:function(a){this.queryGrid=
this.ownerCt.ownerCt;this.queryGrid.deleteButton=this},click:function(a,b){this.queryGrid.validateAction("delete rows",function(){var a=this.queryGrid.getSelectionModel().getSelection();if(0<a.length){var b;if(-1!==this.queryGrid.queryString.toLowerCase().search("ideworkspace"))for(b=0;b<a.length;b++)if(a[b].internalId===ApiUtils.to18CharId(apex.ide.IDE.workspaceId)){Ext.Msg.alert("Error","Cannot delete current workspace");return}Ext.Msg.confirm("Confirm Delete","Delete "+a.length+" rows from "+this.queryGrid.queryMetadata.entityName+
"?",function(b,c){if("yes"==b){for(var d=0;d<a.length;d++)this.queryGrid.getStore().remove(a[d]);this.queryGrid.getStore().sync()}},this)}},this)}}});a.push({text:"Refresh Grid",xtype:"button",listeners:{afterrender:function(a){this.queryGrid=this.ownerCt.ownerCt;this.queryGrid.refreshButton=this},click:function(a,b){this.ownerCt.ownerCt.getStore().load()}}});!this.bbar&&0<a.length&&(this.bbar={items:a});a=Ext.ModelManager.getModel(this.queryString);if(void 0===a||null===a){for(var b=[],a=0;a<this.queryMetadata.columnMetadata.length;a++)b.push({name:this.queryMetadata.columnMetadata[a].columnName,
persist:this.queryMetadata.columnMetadata[a].updatable});Ext.define(this.queryString,{extend:"Ext.data.Model",fields:b,idProperty:"Id"})}if(void 0===this.store)if(this.data)this.store=Ext.create("Ext.data.Store",{model:this.queryString,data:this.data,proxy:{type:"localstorage"}});else{var d=this;this.store=Ext.create("Ext.data.Store",{model:this.queryString,proxy:Ext.create("apex.ide.RestApiProxy",{queryString:this.queryString,version:this.version,entity:this.queryMetadata.entityName,tooling:d.tooling}),
listeners:{datachanged:function(a,b){d.setTitle("Query Results - Total Rows: "+a.getTotalCount())}}})}if(void 0===this.columns){b=[];for(a=0;a<this.queryMetadata.columnMetadata.length;a++)if(this.queryMetadata.columnMetadata[a].aggregate||!this.queryMetadata.columnMetadata[a].joinColumns||0>=this.queryMetadata.columnMetadata[a].joinColumns)b.push(this.makeColumn(this.queryMetadata.columnMetadata[a]));else for(var c=0;c<this.queryMetadata.columnMetadata[a].joinColumns.length;c++)b.push(this.makeColumn(this.queryMetadata.columnMetadata[a].joinColumns[c],
this.queryMetadata.columnMetadata[a]));this.columns=b}this.callParent()}});
Ext.define("apex.sosl.SOSLPanel",{extend:"Ext.tab.Panel",alias:"widget.soslpanel",initComponent:function(){var a={},c=0,d,e,b,f;if(Sfdc.isDefAndNotNull(this.searchMetadata.searchRecords)){e=this.searchMetadata.searchRecords;for(b=0;b<e.length;b++)d=e[b].attributes.type,a[d]||(a[d]=[]),a[d].push(e[b])}this.items=[];for(f in a)a[f]&&(c+=a[f].length,this.items.push({title:f+" ("+a[f].length+")",xtype:"soslgrid",searchMetadata:a[f],forceFit:!0,entityName:f,queryString:this.queryString}));this.setTitle("Search Results - Total Rows: "+
c);this.callParent()}});
Ext.define("apex.sosl.SOSLGrid",{extend:"apex.ide.QueryGrid",alias:"widget.soslgrid",initComponent:function(){var a=this.searchMetadata[0],c=a.attributes.type+" : "+this.queryString,d=Ext.ModelManager.getModel(c);if(void 0===d||null===d){var d=[],e;for(e in a)e&&"attributes"!==e&&d.push({name:e});Ext.define(c,{extend:"Ext.data.Model",fields:d,idProperty:"Id"})}void 0===this.store&&(this.store={data:this.searchMetadata,model:c});if(void 0===this.columns){var c=[],b;for(b in a)b&&"attributes"!==b&&
c.push(Ext.create("Ext.grid.column.Column",{text:b,dataIndex:b,renderer:Ext.util.Format.htmlEncode}));this.columns=c}this.callParent()}});
Ext.define("apex.test.SOSLResultViewer",{alias:"widget.soslresult",extend:"apex.ide.Viewer",loadContent:function(){this.fireEvent("afterLoad")},workspace:function(){var a=this.callParent();Sfdc.apply(a,{xtype:"soslresult",displayName:"Search",searchMetadata:this.searchMetadata},!0);return a},initComponent:function(){var a="SOSL@"+Ext.Date.format(new Date,"g:i A");Ext.apply(this,{layout:"border",title:a,xtype:"panel",id:this.id,items:[{region:"north",xtype:"textarea",value:this.Name,readOnly:!0,height:40},
{region:"center",xtype:"soslpanel",title:"Search Results",queryString:this.Name,searchMetadata:this.searchMetadata}]});this.callParent()}});
Ext.define("apex.editor.SourceFileEditor",{extend:"apex.ide.Editor",alias:"widget.sourcefileeditor",editorXType:"ux-codemirror",mode:"text/apex",getAddons:function(){var a={highlightSelectionMatches:!0,extraKeys:{}};("javascript"===this.mode||"css"===this.mode)&&Sfdc.apply(a,{matchBrackets:!0,autoCloseBrackets:!0,foldGutter:{rangeFinder:new CodeMirror.fold.combine(CodeMirror.fold.brace,CodeMirror.fold.comment)},continueComments:!0});"xml"===this.mode&&(Sfdc.apply(a,{matchTags:{bothTags:!0},autoCloseTags:!0,
foldGutter:!0}),a.extraKeys=Sfdc.apply(a.extraKeys,{"Ctrl-H":"toMatchingTag"}));a.extraKeys=Sfdc.apply(a.extraKeys,{F11:function(a){a.setOption("fullScreen",!a.getOption("fullScreen"))},Esc:function(a){a.getOption("fullScreen")&&a.setOption("fullScreen",!1)}});return a},editorListeners:{afterrender:function(a){a.editor=a.ownerCt.ownerCt;a.editor.source=a}},workspace:function(){var a=this.callParent();a.position={ch:0,line:0};void 0!==this.cmEditor&&(a.position=this.cmEditor.codeEditor.getCursor());
return a},getValue:function(a){return this.cmEditor&&this.cmEditor.getValue?this.cmEditor.getValue():null},setValue:function(a){this.cmEditor&&this.cmEditor.getValue&&this.cmEditor.setValue(a);this.size=a.length},clearHistory:function(){this.cmEditor&&this.cmEditor.clearHistory&&this.cmEditor.clearHistory()},initBody:function(a){var b=SfdcDevConsole.Extents.getExtentFromId(this.id);b&&b.contentField&&Sfdc.isString(a[b.contentField])?this.setValue(a[b.contentField]):Sfdc.isString(a)&&this.setValue(a);
this.clearHistory()},onChange:function(){this.loading||this.setDirty()},clear:function(){this.cmEditor&&(this.cmEditor.clearHighlights(),this.cmEditor.clearErrors(),this.shownCoverage&&this.showCoverage(this.shownCoverage))},setSaving:function(a){this.saving=a;var b=this,c=function(){SfdcDevConsole.Menu.toolbar.refresh();var a=escapeHTML(b.title||b.Name);b.saving?b.setTitle("Saving: "+a):(b.setTitle(a.replace("Saving: ","")),b.dirty&&b.setDirty())};if(this.opened)c();else this.on("afterOpen",function(a){c();
this.un("afterOpen",arguments.callee)})},save:function(a){var b=this.cmEditor;if(this.canEdit()){if(!this.saving&&this.dirty){this.setSaving(!0);var c=b.getValue(),e=this,d=(new Date).getTime(),g=SfdcDevConsole.Extents.getExtentFromId(e.id);try{g&&apex.ide.IDE.sendPerformanceMetrics("Saving file "+e.id+" "+g.entityType,0,c.length,apex.ide.IDE.getOpenTabsInfo(),d)}catch(f){}SfdcDevConsole.Session.initialize();this.performSave(c,function(b,f){e.setSaving(!1);b||e.clearDirty();try{var k=(new Date).getTime(),
m=k-d;if(g){var h="Saved file "+e.id+" "+g.entityType,h=h+(b?" ERROR":"");apex.ide.IDE.sendPerformanceMetrics(h+(f?" in deployment "+f:""),m,c.length,apex.ide.IDE.getOpenTabsInfo(),k)}}catch(n){}Ext.getCmp("aggregateCoverageGrid").visible&&Ext.getCmp("aggregateCoverageGrid").load();"function"===typeof a&&a()})}}else Ext.MessageBox.hide(),Ext.MessageBox.alert("Save failed","You don't have permissions to save this file.")},saveEditor:function(a){var b=null;"apexeditor"===a.xtype?b=function(){a.updateCoverageCycle();
a.refreshRelatedVFWindows();a.updateRunTestButtonVisibility();a.clearCoverage();apex.test.TestResult.invalidateCoverageForClass(a.id)}:"visualforceeditor"===a.xtype&&(b=function(){a.openOrRefreshWindow(!1)});a.save(b)},toolbarButtons:function(){return[]},getItems:function(){var a=this.callParent();a.push({region:"center",xtype:"panel",layout:"fit",items:[{sourceFileId:this.id,xtype:this.editorXType,mode:this.mode,enableKeyEvents:!0,hasBreakpoints:this.hasBreakpoints,listeners:this.editorListeners}]});
return a},initComponent:function(){Ext.apply(this,{id:this.id,title:escapeHTML(this.title||this.Name),displayName:"File",loaded:!1,tbar:this.toolbarButtons()});this.on({show:function(){this.cmEditor&&(this.cmEditor.fireEvent("show"),this.cmEditor.codeEditor.refresh())},beforehide:function(){this.cmEditor&&this.cmEditor.fireEvent("beforehide")},afterLoad:function(a){void 0===this.cmEditor&&(this.cmEditor=this.items.items[0].items.items[0]);this.initBody(a);if(a=a.LastModifiedDate||a.LastModifiedByDate)this.timestamp=
SfdcDevConsole.ToolingAPI.getMilliSecondsFromAPIDate(a);void 0!==this.position&&this.cmEditor.codeEditor.setCursor(this.position);this.cmEditor.focus();this.cmEditor.codeEditor.on("change",function(a,c){this.onChange()}.bind(this))}});this.callParent()},showCoverage:function(a){function b(a,b){if(a){if(Sfdc.isObject(a)){var d=c.codeEditor.lineInfo(a);if(!d)return a;a=d.line+1}d="CodeMirror-line-highlight-"+(b?"covered":"notcovered");e&&(d+="-stale");return c.highlightLine(a,d)}}this.shownCoverage=
a;var c=this.cmEditor,e=this.staleCoverage;c&&c.clearHighlights();if(c&&a&&Sfdc.isObject(a)){for(var d=0;d<a.locationsCovered.length;d++){var g=a.locationsCovered[d];a.locationsCovered[d]=b(g,!0)}for(d=0;d<a.locationsNotCovered.length;d++)g=a.locationsNotCovered[d],a.locationsNotCovered[d]=b(g,!1)}},clearCoverage:function(a){this.showCoverage(null);apex.test.TestResultBrowser.overallCoveragePercentage=0;!1!==a&&Ext.getCmp("aggregateCoverageGrid").load()},updateCoverageCycle:function(){var a=this;
if(a.coverageCycle.menu.items.items){for(var b=0,c=1;c<a.coverageCycle.menu.items.items.length;c++)if(a.coverageCycle.menu.items.items[c]==a.coverageCycle.getActiveItem()){b=c;break}apex.test.TestResult.getTestsFor(a.id,function(e){var d=[],c=a.coverageCycle.menu.items.items[0];for(a.coverageCycle.setActiveItem(c);1<a.coverageCycle.menu.items.items.length;)a.coverageCycle.menu.remove(a.coverageCycle.menu.items.items[1]);for(var f=0;f<e.length;f++){var l=apex.test.TestResult.getPercent(e[f].NumLinesCovered,
e[f].NumLinesUncovered);d.push({xtype:"menucheckitem",group:c.group,checkHandler:c.checkHandler,scope:c.scope,text:e[f].ApexTestClass.Name+"."+e[f].TestMethodName+" "+l+"%",testId:e[f].ApexTestClassId,method:e[f].TestMethodName,className:e[f].ApexTestClass.Name})}e=Ext.getCmp("aggregateCoverageGrid").getStore();0<d.length&&(f="",e.getById(a.id)&&(f=e.getById(a.id).data.percent+"%"),d.splice(0,0,{xtype:"menucheckitem",group:c.group,checkHandler:c.checkHandler,scope:c.scope,text:"All Tests "+f}));a.coverageCycle.menu.add(d);
a.coverageCycle.suspendEvents(!1);a.coverageCycle.setActiveItem(b);a.coverageCycle.resumeEvents()})}},updateRunTestButtonVisibility:function(){var a=this;apex.test.TestResult.isTest(a.id,function(b){a.runTestButton&&a.runTestButton.setVisible(b)})},find:function(){CodeMirror.commands.find(this.cmEditor.codeEditor)},findNext:function(){CodeMirror.commands.findNext(this.cmEditor.codeEditor)},replace:function(){CodeMirror.commands.replace(this.cmEditor.codeEditor)},replaceAll:function(){CodeMirror.commands.replaceAll(this.cmEditor.codeEditor)},
autoIndent:function(){CodeMirror.commands.indentAuto(this.cmEditor.codeEditor)},getSelection:function(){return this.cmEditor.codeEditor.getSelection()}});
Sfdc.ns("SfdcDevConsole.TraceFlags");
(function(){function h(e,c){return new Ext.form.Time({valueField:e,mode:"local",increment:30})}function k(e){try{return 2008===e.getFullYear()&&0===e.getMonth()&&2===e.getDay()}catch(c){return!1}}var f=null,l={show:function(){f&&f.isVisible()?f.focus():(f=Ext.create("Ext.window.Window",{layout:{align:"stretch",type:"vbox"},bodyStyle:"padding:15px",width:800,height:450,autoScroll:!0,plain:!0,title:LC.getLabel("TraceFlags","Title"),items:[{id:"DevLogSettings",title:LC.getLabel("TraceFlags","DeveloperLogSettings"),
xtype:"traceFlagGrid",queryQuals:"TracedEntityId\x3d'"+Sfdc.UserContext.userId+"' AND LogType\x3d'DEVELOPER_LOG' ",margin:"5 0 5 0",showExpiration:!0,expirationLimit:1},{id:"ClassTracing",title:LC.getLabel("TraceFlags","TraceOverrides"),xtype:"traceFlagGrid",queryQuals:"TracedEntityId NOT IN (select id FROM user) AND LogType\x3d'CLASS_TRACING'",canDelete:!0,margin:"5 0 5 0",showExpiration:!0,logType:"CLASS_TRACING",expirationLimit:10},{id:"UserTracing",title:LC.getLabel("TraceFlags","UserTracing"),
xtype:"traceFlagGrid",queryQuals:"LogType\x3d'USER_DEBUG'",canDelete:!0,margin:"5 0 5 0",showExpiration:!0,logType:"USER_DEBUG",expirationLimit:10}],buttons:[{id:"changeLogLevelsDone",xtype:"button",text:LC.getLabel("DeveloperConsole","DoneButton"),handler:function(){this.ownerCt.ownerCt.items.items[0].store.sync();this.ownerCt.ownerCt.items.items[1].store.sync();this.ownerCt.ownerCt.items.items[2].store.sync();this.ownerCt.ownerCt.destroy()}}],listeners:{show:function(){this.items.items[0].store.load();
this.items.items[1].store.load();this.items.items[2].store.load()}}}),f.show(),f.setLoading(!0),f.items.get(0).store.load(function(){f.items.get(1).store.load(function(){f.setLoading(!1)})}))}};Sfdc.Test&&(l.uninitialize=function(){});Ext.define("DebugLevelModel",{extend:"Ext.data.Model",fields:"Id MasterLabel DeveloperName Database Callout ApexCode Validation Workflow ApexProfiling Visualforce System".split(" "),idProperty:"Id"});Ext.define("TraceFlagModel",{extend:"Ext.data.Model",fields:["Id",
{name:"TracedEntity.NamespacePrefix",persist:!1,queriable:!1},{name:"TracedEntity.Name",persist:!1},{name:"TracedEntityId",updatable:!1},{name:"LogType",updatable:!1},{name:"DebugLevel.DeveloperName",persist:!1,updatable:!1},"StartDate","ExpirationDate","DebugLevelId"],idProperty:"Id"});Ext.define("Ext.data.reader.traceFlagJson",{extend:"Ext.data.reader.Json",alias:"reader.traceFlagJson",extractData:function(e){var c=this.record,b=[],d,a;if(c){d=e.length;!d&&Ext.isObject(e)&&(d=1,e=[e]);for(a=0;a<
d;a++)b[a]=e[a][c]}else b=e;Sfdc.isArray(b)&&Sfdc.Array.forEach(b,function(a){a.DebugLevel||(a.DebugLevel={})});return this.callParent([b])}});Ext.define("DebugLevelGridEmpty",{extend:"Ext.grid.Panel",alias:"widget.debugLevelGridEmpty",initComponent:function(e){e=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1});Ext.apply(this,{forceFit:!0,autoScroll:!0,columns:function(c){var b=[];c.includeName&&b.push({dataIndex:"DeveloperName",text:"DebugLevel",flex:1});b=b.concat([{dataIndex:"Database",
text:"DB",flex:1},{dataIndex:"Callout",text:"Callouts",flex:1},{dataIndex:"ApexCode",text:"ApexCode",flex:1},{dataIndex:"Validation",text:"Validation",flex:1},{dataIndex:"Workflow",text:"Workflow",flex:1},{dataIndex:"ApexProfiling",text:"Profiling",flex:1}]);apex.ide.IDE.hasVisualforce&&b.push({dataIndex:"Visualforce",text:"Visualforce",flex:1});b.push({dataIndex:"System",text:"System",flex:1});if(c.editable)for(var d in b)if("DeveloperName"!==b[d].dataIndex){c=b[d];var a;a=b[d].dataIndex;var g=void 0;
switch(a){case "Database":case "Callout":g=[["NONE","NONE"],["INFO","INFO"],["FINEST","FINEST"]];break;case "ApexCode":g=[["NONE","NONE"],["ERROR","ERROR"],["WARN","WARN"],["INFO","INFO"],["DEBUG","DEBUG"],["FINE","FINE"],["FINER","FINER"],["FINEST","FINEST"]];break;case "Validation":g=[["NONE","NONE"],["INFO","INFO"]];break;case "Workflow":g=[["NONE","NONE"],["ERROR","ERROR"],["WARN","WARN"],["INFO","INFO"],["FINE","FINE"],["FINER","FINER"]];break;case "ApexProfiling":g=[["NONE","NONE"],["INFO",
"INFO"],["FINE","FINE"],["FINEST","FINEST"]];break;case "Visualforce":g=[["NONE","NONE"],["INFO","INFO"],["FINE","FINE"],["FINER","FINER"]];break;case "System":g=[["NONE","NONE"],["INFO","INFO"],["DEBUG","DEBUG"],["FINE","FINE"]]}a=new Ext.form.ComboBox({typeAhead:!0,selectOnTab:!0,category:a,triggerAction:"all",forceSelection:!0,mode:"local",editable:!1,store:g,listeners:null});c.editor=a}else b[d].editor={xtype:"textfield"};return b}(this),plugins:[e],listeners:{beforerender:function(c){var b=Ext.create("DebugLevelModel",
{MasterLabel:"",DeveloperName:"",Database:"INFO",Callout:"INFO",ApexCode:"DEBUG",Validation:"INFO",Workflow:"INFO",ApexProfiling:"INFO",Visualforce:"INFO",System:"DEBUG"});c.store.add(b)}}});this.callParent()}});Ext.define("DebugLevelGrid",{extend:"DebugLevelGridEmpty",alias:"widget.debugLevelGrid",multiSelect:!0,initComponent:function(e){Ext.apply(this,{store:Ext.create("Ext.data.Store",{model:"DebugLevelModel",autoLoad:!0,proxy:Ext.create("apex.ide.RestApiProxy",{version:apex.ide.IDE.apiVersion,
entity:"DebugLevel",model:"DebugLevelModel",tooling:!0,queryQuals:this.queryQuals})})});this.callParent()}});Ext.define("TraceFlagGrid",{extend:"Ext.grid.Panel",alias:"widget.traceFlagGrid",multiSelect:!0,initComponent:function(e){e=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1});Ext.apply(this,{forceFit:!0,autoScroll:!0,store:new Ext.create("Ext.data.Store",{model:"TraceFlagModel",autoLoad:!0,proxy:Ext.create("apex.ide.RestApiProxy",{version:apex.ide.IDE.apiVersion,entity:"TraceFlag",
model:"TraceFlagModel",tooling:!0,queryQuals:this.queryQuals,reader:{type:"traceFlagJson",root:"records",totalProperty:"totalSize"}})}),columns:function(c){var b=[];b.push({dataIndex:"TracedEntity.Name",text:"Name",flex:c.showExpiration?1:2,renderer:function(a){return Sfdc.isDefAndNotNull(c.canDelete)?escapeHTML(a):"General"}});b.push({dataIndex:"StartDate",text:"Start Date",flex:1,editor:h("StartDate",null),renderer:function(a,c){if(Sfdc.isDefAndNotNull(a))return k(a)||1<a.split("+").length&&(a=
a.split("+")[0]+"Z"),Ext.util.Format.dateRenderer("g:i A")(a)}});var d=c.expirationLimit;c.showExpiration&&b.push({dataIndex:"ExpirationDate",text:"Expiration",flex:1,editor:h("ExpirationDate",null),renderer:function(a,c){if(Sfdc.isDefAndNotNull(a)){var b;k(a)?(Date.parse(a),b=new Date,b.setHours(a.getHours()),b.setMinutes(a.getMinutes()),b.setSeconds(0)):(1<a.split("+").length&&(a=a.split("+")[0]+"Z"),b=new Date(Date.parse(a)));b=Sfdc.Date.differenceInMinutes(new Date,b);c.style=b>d?"background-color:green;":
0>b?"background-color:red;":"background-color:yellow;"}return Ext.util.Format.dateRenderer("g:i A")(a)}});b.push({dataIndex:"LogType",text:"LogType",flex:1});b.push({dataIndex:"DebugLevel.DeveloperName",text:"DebugLevel",flex:1});b.push({text:"DebugLevel Action",forcefit:!0,align:"center",flex:1,renderer:function(b,d,e,m,f,n,p){return'\x3ca href\x3d"#" onclick\x3d"SfdcDevConsole.TraceFlags.changeDebugLevel(\''+c.logType+"', '"+c.id+"',"+m+'); return false;"\x3eAdd/Change\x3c/a\x3e'}});return b}(this),
plugins:[e],buttons:function(c){if(!0===c.canDelete)return[{id:"add_"+c.logType,xtype:"button",text:LC.getLabel("DeveloperConsole","AddButton"),handler:function(){var b=[];SfdcDevConsole.ToolingAPI.query("SELECT name, id, namespaceprefix FROM ApexClass",{continuation:function(d){for(var a in d.records)"string"===typeof a&&(null!==d.records[a].NamespacePrefix?b.push([d.records[a].Id,d.records[a].NamespacePrefix+"."+d.records[a].Name,d.records[a].Name]):b.push([d.records[a].Id,d.records[a].Name,d.records[a].Name]));
SfdcDevConsole.ToolingAPI.query("SELECT name, id, namespaceprefix FROM ApexTrigger",{continuation:function(a){for(var d in a.records)"string"===typeof d&&(null!==a.records[d].NamespacePrefix?b.push([a.records[d].Id,a.records[d].NamespacePrefix+"."+a.records[d].Name,a.records[d].Name]):b.push([a.records[d].Id,a.records[d].Name,a.records[d].Name]));b.sort(function(a,b){return a[2].toLowerCase().localeCompare(b[2].toLowerCase())});var e=Ext.create("Ext.Button",{id:"confirmAddTraceFlag",text:LC.getLabel("DeveloperConsole",
"AddButton"),handler:function(){var a=null,b=null;"CLASS_TRACING"===c.logType?(a=ApiUtils.to18CharId(Ext.getCmp("classTraceFlagSelect").getValue()),b=Ext.getCmp("classTraceFlagSelect").getRawValue()):(a=ApiUtils.to18CharId(this.ownerCt.ownerCt.items.items[0].lastValue),b=this.ownerCt.ownerCt.items.items[0].lastValue);a=Ext.create("TraceFlagModel",{"TracedEntity.Name":b,TracedEntityId:a,LogType:c.logType,ExpirationDate:(new Date(Date.now()+18E5)).toGMTString()});c.store.add(a);this.ownerCt.ownerCt.destroy()}});
a=LC.getLabel("TraceFlags","AddUserTitle");"CLASS_TRACING"===c.logType&&(a=LC.getLabel("TraceFlags","AddEntityTitle"));a=Ext.create("Ext.window.Window",{id:"addClassWindow",layout:"auto",bodyStyle:"padding:15px",height:150,labelWidth:65,labelPad:8,plain:!0,title:a,buttons:[e],listeners:{beforeshow:function(){e.disable()}}});d=Ext.get("classTraceFlagSelect");var f=Ext.get("userIdTraceFlagInput");d||f?d.focus():("CLASS_TRACING"===c.logType?a.add([{id:"classTraceFlagSelect",xtype:"combobox",fieldLabel:"Choose Class or Trigger",
grow:!0,typeAhead:!0,selectOnTab:!0,triggerAction:"all",forceSelection:!0,mode:"local",value:"-",emptyText:"Select",store:b,listeners:{change:function(a){e.enable()}}}]):"USER_DEBUG"===c.logType&&a.add([{id:"userIdTraceFlagInput",xtype:"textfield",name:"UserId",fieldLabel:"User Id",allowBlank:!1,listeners:{change:function(a,b){""!==b?e.enable():e.disable()}}}]),a.show())}})}})}},{id:"remove"+c.logType,xtype:"button",text:LC.getLabel("DeveloperConsole","RemoveButton"),handler:function(){0<c.selModel.selected.length&&
c.store.remove(c.selModel.getSelection())}}]}(this),listeners:{edit:function(c,b,d){b.value?(c=new Date,d=new Date(Date.parse(b.value)),c.setHours(d.getHours()),c.setMinutes(d.getMinutes()),c.setSeconds(0)):c=new Date(Date.parse(b.originalValue));d=c;d="[object Date]"!==Object.prototype.toString.call(d)?!1:!isNaN(d.getTime());c=d?c.toGMTString():"";"ExpirationDate"===b.field?b.record.data.ExpirationDate=c:"StartDate"===b.field&&(b.record.data.StartDate=c)}}});this.callParent()}});SfdcDevConsole.TraceFlags=
l;SfdcDevConsole.TraceFlags.changeDebugLevel=function(e,c,b){e=Ext.create("Ext.Button",{id:"changeDebugLevelDoneButton",text:LC.getLabel("DeveloperConsole","DoneButton"),handler:function(){var d=Ext.getCmp(c).store.getAt(b),a=Ext.getCmp("debugLevelSelection").store,e=Ext.getCmp("debugLevelSelection").getSelectionModel().getSelection();0<e.length&&(d.set("DebugLevelId",e[0].data.Id),d.set("DebugLevel.DeveloperName",e[0].data.DeveloperName));a.sync();Ext.getCmp("changeDebugLevelWindow").destroy()}});
e=Ext.create("Ext.window.Window",{id:"changeDebugLevelWindow",layout:"auto",bodyStyle:"padding:15px",width:700,height:250,labelWidth:65,autoScroll:!0,labelPad:8,plain:!0,buttons:[e],title:LC.getLabel("TraceFlags","ChangeDebugLevel")});e.add({id:"addDebugLevel",xtype:"button",text:LC.getLabel("DeveloperConsole","AddButton"),handler:function(){var b=Ext.create("Ext.data.Store",{model:"DebugLevelModel"}),a=Ext.create("Ext.Button",{id:"createDebugLevelAddButton",text:LC.getLabel("DeveloperConsole","AddButton"),
handler:function(){var a=this.ownerCt.ownerCt.items.items[0].lastValue,c=Ext.getCmp("debugLevelSelection").store,e=b.getAt(0).data;e.DeveloperName=a;e.MasterLabel=a;c.add(e);c.sync({success:function(){c.load()}});this.ownerCt.ownerCt.destroy()}}),c=Ext.create("Ext.window.Window",{layout:"auto",bodyStyle:"padding:15px",width:600,height:200,labelWidth:65,labelPad:8,plain:!0,title:LC.getLabel("TraceFlags","AddDebugLevel"),buttons:[a],listeners:{beforeshow:function(){a.disable()}}});c.add([{id:"addDebugLevelName",
xtype:"textfield",name:"DebugLevel Name",fieldLabel:"DebugLevel Name",allowBlank:!1,listeners:{change:function(){a.enable()}}},{id:"debugLevelCreateGrid",xtype:"debugLevelGridEmpty",store:b,editable:!0}]);c.show()}},{xtype:"button",text:LC.getLabel("DeveloperConsole","RemoveButton"),handler:function(){var b=Ext.getCmp("debugLevelSelection");b.store.remove(b.getSelectionModel().getSelection());b.store.sync({success:function(){b.store.load()}})}},{id:"debugLevelSelection",xtype:"debugLevelGrid",editable:!0,
includeName:!0});Ext.getCmp("debugLevelSelection").columns[0].flex=1.5;e.show()}})();
Ext.define("apex.csi.ApexLog",{extend:"Ext.data.Model",fields:"Id Application Status Operation StartTime LogLength LogUserId LogUser.Name".split(" "),idProperty:"Id"});Ext.define("apex.csi.LogRecord",{extend:"Ext.data.Model",fields:"id application status operation time read user userId timeMillis size".split(" "),idProperty:"id"});
Sfdc.onReady(function(){var g=new Ext.menu.Menu({record:null,items:[{text:LC.getLabel("DevConsoleMenuItem","OpenLog"),handler:function(){apex.csi.LogBrowser.openLog()}},{text:LC.getLabel("DevConsoleMenuItem","OpenRawLog"),handler:function(){apex.csi.LogBrowser.openLog("rawlogviewer")}},{text:LC.getLabel("DevConsoleMenuItem","DownloadLog"),handler:function(){apex.csi.LogBrowser.downloadLog()}}]});Ext.define("apex.csi.LogBrowser",{extend:"apex.ide.Browser",alias:"widget.logbrowser",singleton:!0,parseLogSizeLimitBytes:0,
preventWarningMessageFromAutoClosing:function(){return!1},initComponent:function(){Ext.apply(this,{id:"newTraceGrid",layout:"fit",title:LC.getLabel("ApexCSI","logs"),items:[{xtype:"gridpanel",id:"traceGrid",forceFit:!0,store:new Ext.create("Ext.data.Store",{storeId:"apexLogs",model:"apex.csi.ApexLog",listeners:{load:function(a,b,c,e,d){apex.csi.LogBrowser.updateLogFilter()}},sorters:[{property:"StartTime",direction:"DESC"},"Operation"],proxy:Ext.create("apex.ide.RestApiProxy",{version:apex.ide.IDE.apiVersion,
entity:"ApexLog",model:"apex.csi.ApexLog",tooling:!0,batchOrder:"destroy,create,update",orderBy:"StartTime DESC"})}),listeners:{itemcontextmenu:function(a,b,c,e,d){g.skipNextClick?g.skipNextClick=!1:(d.stopEvent(),g.showAt(d.xy))},itemdblclick:function(a,b,c,e,d,f){a.eventsSuspended||(Sfdc.Perf.mark("LoadLogFile"),apex.csi.LogBrowser.openLog())},afterrender:function(a){a.store.load()}},columns:[{text:"Id",dataIndex:"Id",hidden:!0},{header:"User",dataIndex:"LogUser.Name",sortable:!0,renderer:function(a,
b,c,e,d,f){a=escapeHTML(a);return c.data.User=a}},{text:"Application",dataIndex:"Application",sortable:!0},{text:"Operation",dataIndex:"Operation",sortable:!0,renderer:"htmlEncode"},{header:"Time",dataIndex:"StartTime",sortable:!0,renderer:function(a,b,c,e,d,f){a=new Date(SfdcDevConsole.ToolingAPI.getMilliSecondsFromAPIDate(c.data.StartTime));c.data.Date=a.toLocaleString();return c.data.Date}},{text:"Status",dataIndex:"Status",sortable:!0,renderer:"htmlEncode"},{header:"Read",fixed:!0,dataIndex:"read",
sortable:!0,renderer:function(a,b,c,e,d,f){return void 0===c.data.read||""===c.data.read?"Unread":""}},{header:"Size",dataIndex:"LogLength",sortable:!0,renderer:function(a,b,c,e,d,f){return 1048576<=a?Math.round(100*a/1048576)/100+" MB":1024<=a?Math.round(100*a/1024)/100+" KB":a+" bytes"}},{header:" ",dataIndex:"",width:28,fixed:!0,renderer:function(a,b,c,e,d,f){return c.data.LogLength>apex.csi.LogBrowser.parseLogSizeLimitBytes?(b.attr='title\x3d"'+LC.getLabel("ApexCSI","rawLogModeMsg")+'"','\x3cimg src\x3d"/img/msg_icons/warning16.png"/\x3e'):
""}}],bbar:[{id:"logShowThese",xtype:"checkbox",boxLabel:"Filter",handler:function(a,b){apex.csi.LogBrowser.updateLogFilter()}},{xtype:"tbspacer",width:10},{id:"logShowMatchText",xtype:"textfield",width:200,enableKeyEvents:!0,style:{color:"gray"},value:"Click here to filter the log list",listeners:{keyup:function(a,b){0<a.getValue().length?(Ext.getCmp("logShowThese").checked||(Ext.getCmp("logShowThese").setValue(!0),a.focus()),apex.csi.LogBrowser.updateLogFilter()):Ext.getCmp("logShowThese").checked&&
Ext.getCmp("logShowThese").setValue(!1);a.focus(!1,10)},focus:function(a,b){"Click here to filter the log list"===a.getValue()&&(a.setValue(""),a.getEl().setStyle({color:"black"}))}}}]}]});this.callParent()},getLogOpenXtype:function(a){var b="logviewer";if(a>this.parseLogSizeLimitBytes&&(b="rawlogviewer",a=apex.ide.IDE.getIDECookie("warnedLogTooBig"),null===a||void 0===a))apex.ide.IDE.setIDECookie("warnedLogTooBig","log_too_big"),Ext.MessageBox.addListener("beforehide",this.preventWarningMessageFromAutoClosing),
Ext.MessageBox.show({title:"Warning",msg:"This log is larger than "+this.parseLogSizeLimitBytes/1E3+"k, opening as a raw log file.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING,fn:function(a){Ext.MessageBox.removeListener("beforehide",apex.csi.LogBrowser.preventWarningMessageFromAutoClosing);Ext.MessageBox.hide()}});return b},openLog:function(a){var b=Ext.getCmp("traceGrid");if(!b.eventsSuspended&&(b=b.getSelectionModel().hasSelection()?b.getSelectionModel().getSelection()[0]:null,null!==
b)){if(void 0===b.data.read||""===b.data.read)b.set("read",!0),apex.csi.LogBrowser.readLogs[b.data.Id]=!0;if(null===a||void 0===a)a=this.getLogOpenXtype(b.data.LogLength);var c=b.data.Id,e=b.data.Operation;e.indexOf("tooling/executeAnonymous")&&(e="executeAnonymous");apex.ide.Viewer.open({id:a.substring(0,1)+"-"+c,logId:c,Name:("rawlogviewer"===a?"Raw ":"")+"Log "+e+" @"+b.data.Date,xtype:a,rawLogSize:b.data.LogLength});Ext.getCmp("hideAutomatically").checked&&Ext.getCmp("bottomPanel").collapse(Ext.Component.DIRECTION_TOP)}},
downloadLog:function(){var a=Ext.getCmp("traceGrid"),a=a.getSelectionModel().hasSelection()?a.getSelectionModel().getSelection()[0]:null;null!==a&&this.downloadLogViaDownloadServlet(a.data.Id)},downloadLogViaDownloadServlet:function(a){this.downloadLogViaURL("/servlet/servlet.FileDownload?file\x3d"+a,a)},downloadLogViaURL:function(a,b){var c=document.createElement("a");c.download="apex-"+b+".log";c.href=a;c.onclick=function(a){document.body.removeChild(a.target)};c.style.display="none";document.body.appendChild(c);
c.click()},readLogs:{},selectId:void 0,openNext:!1,updateLogFilter:function(){if(void 0!==apex.csi.LogBrowser.selectId){var a=Ext.getCmp("traceGrid");0<a.store.data.length&&(a.getSelectionModel().select(a.store.find("Id",apex.csi.LogBrowser.selectId)),apex.csi.LogBrowser.openNext&&apex.csi.LogBrowser.openLog());apex.csi.LogBrowser.selectLast=!1;apex.csi.LogBrowser.openNext=!1}var b=Ext.getCmp("logShowThese").checked,c=Ext.getCmp("logShowMatchText").getValue(),e;e=b?function(a,d){return b&&0<c.length?
-1<a.data.Operation.indexOf(c)||-1<a.data.User.indexOf(c)||-1<a.data.StartTime.indexOf(c)||-1<a.data.Status.indexOf(c)||-1<a.data.Application.indexOf(c)?!0:!1:!0}:function(a,b){return!0};for(var a=Ext.StoreMgr.lookup("apexLogs"),d=0;d<a.data.length;d++)apex.csi.LogBrowser.readLogs[a.data.get(d).data.Id]&&(a.data.get(d).data.read=!0);var f,g;Ext.getCmp("mySessionLogsOnly").checked?(f=function(a,b){return a.data.LogUserId===SfdcDevConsole.myUserId},g=function(a,b){return SfdcDevConsole.ToolingAPI.getMilliSecondsFromAPIDate(a.data.StartTime)>=
apex.ide.IDE.showUpdatesFromTime}):(f=function(a,b){return!0},g=function(a,b){return!0});var d=function(a,b){return g(a,b)&&f(a,b)&&e(a,b)},h=Ext.getCmp("traceGrid"),k=h.getSelectionModel().hasSelection()?h.getSelectionModel().getSelection()[0]:null;null!==k&&!d(k,k.id)&&(apex.ide.IDE.incrementProgress("Clearing log selection"),h.getSelectionModel().clearSelections());h.setLoading(!0);h.suspendEvents();try{a.clearFilter(),a.filterBy(d)}finally{h.resumeEvents(),h.setLoading(!1)}}},function(){SfdcDevConsole.Events.EventDispatcher.on("devconsole:loaded",
function(a,b){this.parseLogSizeLimitBytes=a.parseLogSizeLimitBytes},this);apex.ide.IDE.on("clear",function(a){this.updateLogFilter()},this);new Ext.util.KeyMap(Ext.getBody(),[{ctrl:!1,shift:!0,alt:!0,key:"g",fn:function(){apex.ide.IDE.clearList()},defaultEventAction:"stopEvent"}]);apex.ide.ShortcutRegistry.add({name:"Clear log panel",key:"G",ctrl:!1,shift:!0,alt:!0})});SfdcDevConsole.isTesting&&(apex.csi.LogBrowser.logContextMenu=g)});
Ext.define("apex.fewmet.ApexExecutionOverlayResult",{idProperty:"Id",extend:"Ext.data.Model",fields:["Id","Namespace","ClassName","Line",{name:"CreatedDate",type:"date"},"UserId"]});
Ext.define("apex.fewmet.ApexExecutionOverlayAction",{idProperty:"Id",extend:"Ext.data.Model",fields:[{name:"Id"},{name:"ExecutableEntity.Name",persist:!1},{name:"ExecutableEntityId",updatable:!1},{name:"Line",type:"int"},{name:"Iteration",type:"int"},{name:"IsDumpingHeap",type:"boolean"},"ActionScriptType","ActionScript",{name:"handle",persist:!1,queriable:!1}]});
Sfdc.onReady(function(){Ext.define("apex.fewmet.FewmetBrowser",{extend:"apex.ide.Browser",alias:"widget.heapdumpbrowser",singleton:!0,saveAction:function(){var a=Ext.StoreMgr.lookup("fewmetConfig"),b=Ext.getCmp("fewmetConfigGrid").getSelectionModel().getSelection()[0];b.set("ActionScriptType",Ext.getCmp("editActionScriptType").getValue().action);b.set("IsDumpingHeap",Ext.getCmp("editIsDumpingHeap").getValue());b.set("ActionScript",Ext.getCmp("editActionScript").getValue());a.sync();Ext.getCmp("executionProperties").hide()},
initComponent:function(){Ext.apply(this,{id:"fewmetWrapper",layout:"border",title:"Checkpoints",listeners:{activate:function(a){Ext.getCmp("fewmetClearButton").setVisible(!1);Ext.getCmp("fewmetClearButton").setVisible(!0);Ext.getCmp("fewmetList").doLayout()}},items:[{id:"fewmetList",xtype:"grid",region:"center",title:"Checkpoints",forceFit:!0,layout:"fit",flex:1,store:Ext.create("Ext.data.Store",{storeId:"fewmetList",model:"apex.fewmet.ApexExecutionOverlayResult",listeners:{load:function(a){apex.fewmet.FewmetBrowser.updateFewmetFilter()}},
proxy:Ext.create("apex.ide.RestApiProxy",{version:apex.ide.IDE.apiVersion,entity:"ApexExecutionOverlayResult",model:"apex.fewmet.ApexExecutionOverlayResult",tooling:!0,batchOrder:"destroy,create,update"})}),columns:[{header:"Id",dataIndex:"Id",sortable:!0,hidden:!0},{header:"Namespace",dataIndex:"Namespace",sortable:!0},{header:"Class",dataIndex:"ClassName",sortable:!0},{header:"Line",dataIndex:"Line",sortable:!0,width:30},{header:"Date",dataIndex:"CreatedDate",sortable:!0,renderer:function(a,b,c,
d,f,e){return Ext.Date.format(new Date(a),"m/d H:i:s")}}],listeners:{itemdblclick:function(a,b,c,d,f,e){apex.fewmet.FewmetBrowser.sniffFewmet(b.data.Id,b.data.ClassName+":"+b.data.Line+"@"+Ext.Date.format(b.data.CreatedDate,"m/d H:i:s"))},afterrender:function(a){a.store.load()}}},{title:"Checkpoint Locations",split:!0,xtype:"gridpanel",id:"fewmetConfigGrid",region:"east",forceFit:!0,flex:1,bbar:{xtype:"toolbar",items:[{id:"propertiesButon",xtype:"button",text:"Edit Properties",locationWindow:Ext.create("Ext.window.Window",
{title:"Execution Action Properties",id:"executionProperties",height:200,width:400,xtype:"panel",layout:"fit",modal:!0,closeAction:function(){this.hide()},listeners:{show:function(a){a=Ext.getCmp("fewmetConfigGrid").getSelectionModel().getSelection()[0];Ext.getCmp("editIsDumpingHeap").setValue(a.data.IsDumpingHeap);Ext.getCmp("editActionScriptType").setValue({action:void 0!==a.data.ActionScriptType&&null!==a.data.ActionScriptType&&""!==a.data.ActionScriptType?a.data.ActionScriptType:"none"});Ext.getCmp("editActionScript").setValue(a.data.ActionScript)}},
items:{xtype:"form",bodyPadding:5,layout:"anchor",defaults:{anchor:"100%"},items:[{xtype:"checkbox",fieldLabel:"Dump Heap",id:"editIsDumpingHeap",allowBlank:!1},{xtype:"radiogroup",fieldLabel:"Action Script Type",id:"editActionScriptType",defaultType:"radiofield",items:[{boxLabel:"None",name:"action",inputValue:"none",width:50},{boxLabel:"SOQL",name:"action",inputValue:"SOQL",width:50},{boxLabel:"Apex Code",name:"action",inputValue:"Apex",width:80}]},{xtype:"textarea",fieldLabel:"Action Script ",
id:"editActionScript",allowBlank:!0,renderer:escapeHTML}],buttons:[{xtype:"button",text:"Cancel",listeners:{click:function(){Ext.getCmp("executionProperties").hide()}}},{xtype:"button",text:"OK",listeners:{click:function(){if("SOQL"===Ext.getCmp("editActionScriptType").getValue().action){var a=apex.ide.IDE.queryUrl(Ext.getCmp("editActionScript").getValue(),!1,{columns:!0});SfdcDevConsole.ToolingAPI.request({url:a,gackOnFailure:!1,alertOnFailure:!0,success:function(a,c){apex.fewmet.FewmetBrowser.saveAction()}})}else apex.fewmet.FewmetBrowser.saveAction()}}}]}}),
listeners:{click:function(a,b){var c=Ext.getCmp("fewmetConfigGrid").getSelectionModel().getSelection();void 0===c||0===c.length?Ext.Msg.alert("Edit Properties","Select a checkpoint location to edit its properties"):a.locationWindow.show()}}}]},store:Ext.create("Ext.data.Store",{storeId:"fewmetConfig",model:"apex.fewmet.ApexExecutionOverlayAction"}),columns:[{header:"Id",dataIndex:"Id",hidden:!0},{header:"File",dataIndex:"ExecutableEntity.Name"},{header:"Line",dataIndex:"Line",width:20},{header:"Iteration",
dataIndex:"Iteration",width:50,field:{xtype:"numberfield",cls:"iterationField",allowBlank:!1,minValue:1,maxValue:1E5,listeners:{blur:function(a,b,c,d){Ext.StoreMgr.lookup("fewmetConfig").sync()}}}},{header:"Dump Heap?",dataIndex:"IsDumpingHeap",readOnly:!0,width:70,hidden:!0,field:{xtype:"checkboxfield",listeners:{blur:function(a,b,c,d){Ext.StoreMgr.lookup("fewmetConfig").sync()}}}},{hidden:!0,header:"Script Action",dataIndex:"ActionScriptType",readOnly:!0},{hidden:!0,header:"Script",dataIndex:"ActionScript",
renderer:escapeHTML,readOnly:!0,field:{xtype:"textfield",listeners:{blur:function(a,b,c,d){Ext.StoreMgr.lookup("fewmetConfig").sync()}}}}],plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})]}]});this.callParent()},comboRenderer:function(a){return function(b){return(b=a.findRecord(a.valueField,b))?b.get(a.displayField):a.valueNotFoundText}},updateFewmetFilter:function(){if(apex.ide.IDE.bytecode){var a=Ext.getCmp("fewmetList").store,b;b=Ext.getCmp("mySessionFewmetsOnly").checked?function(a,
b){return a.data.CreatedDate?a.data.CreatedDate.getTime()>apex.ide.IDE.showUpdatesFromTime:!1}:function(a,b){return!0};var c=Ext.getCmp("fewmetList"),d=c.getSelectionModel().hasSelection()?c.getSelectionModel().getSelection()[0]:null;null!==d&&!b(d,d.id)&&c.getSelectionModel().clearSelections();c.suspendEvents();a.suspendUpdate=!0;a.filterBy(function(a,c){return b(a,c)});a.suspendUpdate=!1;c.resumeEvents()}},processFewmets:function(a){apex.ide.IDE.addNewRecordsToStore(Ext.StoreMgr.lookup("fewmetList"),
a)},haveIds:[],sniffFewmet:function(a,b){apex.ide.IDE.bytecode&&apex.ide.Viewer.open({id:a,Name:b,xtype:"heapdumpviewer"})}},function(){apex.ide.IDE.on("clear",function(a){apex.ide.IDE.hasHeapdumps()?this.updateFewmetFilter():apex.ide.IDE.un("clear",arguments.callee)},this);SfdcDevConsole.Events.EventDispatcher.on("devconsole:loaded",function(a,b){apex.ide.IDE.hasHeapdumps()&&(Ext.StoreMgr.lookup("fewmetConfig").setProxy(Ext.create("apex.ide.RestApiProxy",{version:apex.ide.IDE.apiVersion,entity:"ApexExecutionOverlayAction",
model:"apex.fewmet.ApexExecutionOverlayAction",queryQuals:"ScopeId\x3d'"+SfdcDevConsole.myUserId+"'",tooling:!0,batchOrder:"destroy,create,update"})),Ext.StoreMgr.lookup("fewmetConfig").load(),apex.ide.IDE.on("clear",function(a){apex.fewmet.FewmetBrowser.updateFewmetFilter()}))},this)})});Ext.define("apex.fewmet.HeapDump",{fields:"typeName totalSize count definition collectionType extent inboundReferences lastSelected".split(" "),idProperty:"typeName",extend:"Ext.data.Model"});
Ext.define("apex.fewmet.Address",{fields:["address","size","value","symbols"],idProperty:"address",extend:"Ext.data.Model"});Ext.define("apex.fewmet.Field",{fields:["field","value","type"],idProperty:"field",extend:"Ext.data.Model"});Ext.define("apex.fewmet.InboundReference",{fields:["id","field","type"],idProperty:"id",extend:"Ext.data.Model"});Ext.define("apex.fewmet.ReferencingInstance",{fields:["address","size","type"],idProperty:"address",extend:"Ext.data.Model"});
Ext.define("apex.fewmet.FewmetViewer",{extend:"apex.ide.Viewer",alias:"widget.heapdumpviewer",__isPrimitive:function(a){return"string"===typeof a||"number"===typeof a||"boolean"===typeof a},loadContent:function(){SfdcDevConsole.ToolingAPI.sobject("ApexExecutionOverlayResult",{id:this.id,continuation:function(a){this.fireEvent("afterLoad",a)}.bind(this),failure:function(a){this.fireEvent("failedLoad",a)}.bind(this)})},loadHeapDump:function(a,b){var c=this;c.typeGrid.store.getProxy().data=a.HeapDump;
c.typeGrid.store.load({callback:function(d,f,e){c.afterLoad(d,f,e,{apexResult:a.ApexResult,soqlResult:a.SOQLResult,actionScript:a.ActionScript},b)},params:{log:c.traceId,extent:"fewmet",doDelete:!1}})},afterLoad:function(a,b,c,d,f){if(c){b=d.actionScript;c=void 0;var e=d.soqlResult;d=d.apexResult;b&&(e&&(e.queryError&&(c=Ext.create("Ext.panel.Panel",{layout:"border",items:[{region:"north",xtype:"textarea",title:"Query",value:b,readOnly:!0,height:300},{region:"center",xtype:"textarea",title:"Error",
value:e.queryError,readOnly:!0}]})),e.queryResult&&(c=Ext.create("Ext.panel.Panel",{layout:"border",title:"Query Results",items:[{region:"north",xtype:"textarea",title:"Query",value:b,renderer:escapeHTML,readOnly:!0,height:40},{region:"center",xtype:"soqlgrid",forceFit:!0,title:"Query Results",queryMetadata:e.queryMetadata,queryString:b,data:e.queryResult,sfdcNavigation:!0}]}))),d&&(c=Ext.create("Ext.panel.Panel",{layout:"border",title:"Apex Execution Results",items:[{region:"north",xtype:"textarea",
title:"Anonymous Block",value:b,renderer:escapeHTML,readOnly:!0,height:60,split:!0},{region:"center",xtype:"propertygrid",title:"Results",source:d.apexExecutionResult,readOnly:!0}]})));void 0!==c&&(this.heapView.add(c),this.heapView.doLayout());d=0;b=this.items.get(0).items.get(1).getRootNode();c=[];var e=this.typeGrid.store,h;for(h=0;h<a.length;h++){var g=a[h];d+=Ext.JSON.encode(g.raw).length;var l={},k;for(k=0;k<g.data.extent.length;k++)if(l[g.data.extent[k].address]=g.data.extent[k],g.data.extent[k].symbols){var m=
g.data.extent[k];if(m)for(var p=0;p<g.data.extent[k].symbols.length;p++){var s=g.data.extent[k].symbols[p],t=[];attributeDomain=this.getAttributeDomain(g,g.data.extent[k]);if(this.__isPrimitive(attributeDomain))member=this.makeAttributeNode("value","",attributeDomain,e,!0),t.push(member);else for(var n=0;n<attributeDomain.length;n++){var q=null;m.value.value&&n<m.value.value.length?q=m.value.value[n]:m.value.entry&&n<m.value.entry.length&&(q=m.value.entry[n].value);if(q){var u=this.getType(g,n),q=
this.getValue(q,n);member=this.makeAttributeNode(attributeDomain[n].keyDisplayValue,u,q,e,!0);t.push(member)}}s=this.makeSymbolNode(s,g.data.typeName,g.data.extent[k].size,t);c.push(s)}}g.set("index",l);for(var r in g.data.definition.entry)"string"===typeof r&&"function"!==typeof g.data.definition.entry[r]&&(l=e.getById(g.data.definition.entry[r].value.value),void 0!==l&&null!==l&&(""===l.data.inboundReferences&&(l.data.inboundReferences=[]),k=g.data.definition.entry[r].keyDisplayValue,l.data.inboundReferences.push({type:g.data.typeName,
field:k,id:g.data.typeName+"."+k})))}0<c.length&&b.appendChild(c);this.heapView.setActiveTab(1);Ext.MessageBox.hide();this.size=d;"function"===typeof f&&f(this);"function"===typeof f&&f(self)}},initComponent:function(){Ext.apply(this,{id:this.id,displayName:"Checkpoint",layout:"border",traceId:this.id,title:this.Name,items:[{region:"center",xtype:"tabpanel",listeners:{afterrender:function(a){a.fewmetViewer=a.ownerCt;a.fewmetViewer.heapView=a}},activeTab:0,items:[{xtype:"panel",forceFit:!0,layout:"border",
title:"Heap",items:[{layout:{type:"hbox",pack:"start",align:"stretch"},region:"center",listeners:{afterrender:function(a){a.fewmetViewer=a.ownerCt.ownerCt.ownerCt;a.fewmetViewer.heapTab=a}},items:[{flex:1,xtype:"grid",title:"Types",forceFit:!0,split:!0,listeners:{afterrender:function(a){a.fewmetViewer=a.ownerCt.ownerCt.ownerCt.ownerCt;a.fewmetViewer.typeGrid=a}},columns:[{header:"Type",dataIndex:"typeName",renderer:function(a,b,c,d,f,e){return Ext.util.Format.htmlEncode(a)}},{header:"Count",dataIndex:"count",
sortable:!0},{header:"Total Size",dataIndex:"totalSize",sortable:!0}],selModel:{mode:"SINGLE",listeners:{selectionchange:{scope:this,fn:function(a,b,c){this.stateGrid.store.removeAll();0!==b.length&&(this.instanceGrid.store.loadData(b[0].data.extent,!1),this.referencingInstancesGrid.store.removeAll(),this.inboundReferenceGrid.store.loadData(b[0].data.inboundReferences,!1),null===b[0].data.definition||""===b[0].data.definition?this.stateGrid.columns[2].setVisible(!0):this.stateGrid.columns[2].setVisible(!1))}}}},
store:Ext.create("Ext.data.Store",{proxy:{type:"memory",reader:{type:"json",root:"extents"}},autoLoad:!1,model:"apex.fewmet.HeapDump",listeners:{exception:function(){Ext.MessageBox.show({icon:Ext.MessageBox.ERROR,title:"Error...",msg:"Could not read address file",width:400,buttons:Ext.MessageBox.OK})}}})},{flex:1,xtype:"grid",forceFit:!0,title:"Instances",listeners:{afterrender:function(a){a.fewmetViewer=a.ownerCt.ownerCt.ownerCt.ownerCt;a.fewmetViewer.instanceGrid=a},afterlayout:function(a,b,c){a.getView().focusRow(a.getSelectionModel().getSelection()[0])}},
columns:[{header:"Address",dataIndex:"address"},{header:"Size",dataIndex:"size",sortable:!0}],selModel:{mode:"SINGLE",listeners:{selectionchange:{scope:this,fn:function(a,b,c){this.referencingInstancesGrid.getStore().removeAll();if(0!==b.length){a=this.typeGrid.getSelectionModel().getSelection()[0];a.set("lastSelected",b[0].data.address);c=[];var d=this.getAttributeDomain(a,b[0].data);if(this.__isPrimitive(d))c.push({field:"value",value:d,type:""});else for(var f=0;f<d.length;f++){var e=d[f],e=e.keyDisplayValue?
e.keyDisplayValue:f,h=this.getValue(b[0].data.value,f),g=this.getType(a,f);c.push({field:e,value:h,type:g})}this.stateGrid.store.grid=this.stateGrid;this.stateGrid.store.loadData(c,!1);b=this.calcReferencingInstances();this.referencingInstancesGrid.store.loadData(b,!1)}}}}},store:Ext.create("Ext.data.Store",{model:"apex.fewmet.Address",autoLoad:!1,listeners:{datachanged:function(a,b){var c=Ext.getCmp("editors").activeTab,d=c.instanceGrid,c=c.typeGrid.getSelectionModel().getSelection()[0];void 0!==
c.data.lastSelected&&0<c.data.lastSelected.length&&(c=d.getStore().indexOf(d.getStore().getById(c.data.lastSelected)),-1<c?d.getSelectionModel().select(c):apex.ide.IDE.sendGack("Unable to find item 'lastSelected' in instance grid to select it."))}}})},{flex:1,split:!0,xtype:"grid",forceFit:!0,title:"State",listeners:{afterrender:function(a){a.fewmetViewer=a.ownerCt.ownerCt.ownerCt.ownerCt;a.fewmetViewer.stateGrid=a;a.getSelectionModel().suspendEvents()},cellclick:function(a,b,c,d,f,e,h){b=a.ownerCt.fewmetViewer;
3==c?(b.lowerTab.setActiveTab(1),b.searchBox.setValue(b.stateGrid.store.getAt(e).data.value),b.searchButton.fireEvent("click",b.searchButton)):(a.ownerCt.getSelectionModel().deselectAll(!0),a.ownerCt.getSelectionModel().resumeEvents(),a.ownerCt.getSelectionModel().select(e))}},columns:[{header:"Field",dataIndex:"field",sortable:!0},{header:"Value",dataIndex:"value",sortable:!0,renderer:function(a,b,c,d,f,e){return Ext.util.Format.htmlEncode(a)}},{header:"Type",dataIndex:"type",renderer:function(a,
b,c,d,f,e){return Ext.util.Format.htmlEncode(a)},sortable:!0},{header:" ",dataIndex:"",renderer:function(a,b,c,d,f,e){return'\x3cimg class\x3d"SearchIcon" src\x3d"/img/func_icons/util/search16.png"/\x3e'},width:28,fixed:!0}],selModel:{mode:"SINGLE",listeners:{selectionchange:{fn:function(a,b,c){0!==b.length&&(c=this.typeGrid.store.getById(b[0].data.type),void 0!==c&&null!==c&&(c.set("lastSelected",b[0].data.value),this.instanceGrid.getSelectionModel().clearSelections(),this.typeGrid.getSelectionModel().select(c)),
a.suspendEvents())},scope:this}}},store:Ext.create("Ext.data.Store",{model:"apex.fewmet.Field",autoLoad:!1})}]},{xtype:"tabpanel",region:"south",height:150,collapsable:!0,split:!0,listeners:{afterrender:function(a){a.fewmetViewer=a.ownerCt.ownerCt.ownerCt;a.fewmetViewer.lowerTab=a}},layout:{type:"hbox",pack:"start",align:"stretch"},items:[{title:"References",split:!0,layout:{type:"hbox",pack:"start",align:"stretch"},items:[{flex:1,xtype:"grid",forceFit:!0,title:"Inbound References",listeners:{afterrender:function(a){a.fewmetViewer=
a.ownerCt.ownerCt.ownerCt.ownerCt.ownerCt;a.fewmetViewer.inboundReferenceGrid=a}},columns:[{header:"Field",dataIndex:"field",sortable:!0},{header:"Type",dataIndex:"type",renderer:function(a,b,c,d,f,e){return Ext.util.Format.htmlEncode(a)},sortable:!0}],selModel:{mode:"SINGLE",listeners:{selectionchange:{scope:this,fn:function(a,b,c){a=this.calcReferencingInstances();this.referencingInstancesGrid.store.loadData(a,!1)}}}},store:Ext.create("Ext.data.Store",{model:"apex.fewmet.InboundReference",autoLoad:!1})},
{flex:1,xtype:"grid",title:"Referencing Instances",forceFit:!0,listeners:{afterrender:function(a){a.fewmetViewer=a.ownerCt.ownerCt.ownerCt.ownerCt.ownerCt;a.fewmetViewer.referencingInstancesGrid=a},itemdblclick:function(a,b,c,d,f,e){b=a.fewmetViewer.typeGrid.store.getById(selectedRecords[0].data.type);void 0!==b&&null!==b&&(b.set("lastSelected",selectedRecords[0].data.address),a.fewmetViewer.instanceGrid.getSelectionModel().clearSelections(),a.fewmetViewer.typeGrid.getSelectionModel().select(a.fewmetViewer.typeGrid.store.indexOf(b)),
a.store.removeAll())}},columns:[{header:"Address",dataIndex:"address"},{header:"Size",dataIndex:"size",sortable:!0}],store:Ext.create("Ext.data.Store",{autoLoad:!1,model:"apex.fewmet.ReferencingInstance"})}]},{title:"Search",xtype:"panel",forceFit:!0,layout:{type:"vbox",pack:"start",align:"stretch"},items:[{xtype:"toolbar",items:[{xtype:"tbfill"},{xtype:"textfield",width:200,style:{color:"gray"},value:"Enter value to search checkpoint",listeners:{afterrender:function(a){a.fewmetViewer=a.ownerCt.ownerCt.ownerCt.ownerCt.ownerCt.ownerCt;
a.fewmetViewer.searchBox=a},focus:function(a,b){a.getValue()===a.originalValue&&a.setValue("")},specialkey:function(a,b){b.getKey()==b.ENTER&&a.fewmetViewer.searchButton.fireEvent("click",a.fewmetViewer.searchButton)},valid:function(a){void 0!==a.originalValue&&(a.getValue()!==a.originalValue&&"gray"===a.getEl().getStyle("color"))&&a.getEl().setStyle({color:"black"})}}},{xtype:"tbspacer",width:10},{text:"Search",xtype:"button",listeners:{afterrender:function(a){a.fewmetViewer=a.ownerCt.ownerCt.ownerCt.ownerCt.ownerCt.ownerCt;
a.fewmetViewer.searchButton=a},click:function(a,b){var c=a.fewmetViewer.typeGrid.store,d=a.fewmetViewer.searchResultsGrid.store;d.loadData([],!1);if(!(""===a.fewmetViewer.searchBox.getValue()||a.fewmetViewer.searchBox.getValue()===a.fewmetViewer.searchBox.originalValue)){var f=a.fewmetViewer.searchBox.getValue().toLowerCase(),e=null!==f.match(/0x[0-9a-f]+/);for(i=0;i<c.getTotalCount();i++){var h=c.getAt(i);for(j=0;j<h.data.count;j++){var g=h.data.extent[j],l=0,k;for(k in g.value)if("string"===typeof k&&
"function"!==typeof g.value[k]){var m=g.value[k],p=null!==c.getById(a.fewmetViewer.getMemberType(h));if(e||!p)p?m.toString().toLowerCase()==f&&d.insert(0,d.model.create({type:h.internalId,instance:g.address,field:k,value:m,typeIndex:i,instanceIndex:j,stateIndex:l})):-1!=m.toString().toLowerCase().search(f)&&d.insert(0,d.model.create({type:h.internalId,instance:g.address,field:k,value:m,typeIndex:i,instanceIndex:j,stateIndex:l})),l++}}}}}}}]},{flex:1,xtype:"grid",forceFit:!0,listeners:{afterrender:function(a){a.fewmetViewer=
a.ownerCt.ownerCt.ownerCt.ownerCt.ownerCt;a.fewmetViewer.searchResultsGrid=a},rowclick:function(a,b,c){a.getSelectionModel().select(b)}},columns:[{header:"Type",dataIndex:"type",renderer:function(a,b,c,d,f,e){return Ext.util.Format.htmlEncode(a)},sortable:!0},{header:"Instance",dataIndex:"instance",renderer:function(a,b,c,d,f,e){return Ext.util.Format.htmlEncode(a)},sortable:!0},{header:"Field",dataIndex:"field",renderer:function(a,b,c,d,f,e){return Ext.util.Format.htmlEncode(a)},sortable:!0},{header:"Value",
dataIndex:"value",renderer:function(a,b,c,d,f,e){return Ext.util.Format.htmlEncode(a)},sortable:!0}],selModel:{mode:"SINGLE",listeners:{selectionchange:function(a,b,c){0!==b.length&&(a=a.view.ownerCt.fewmetViewer,b=b[0],a.typeGrid.getSelectionModel().select(b.data.typeIndex),a.typeGrid.getView().focusRow(b.data.typeIndex),a.instanceGrid.getSelectionModel().select(b.data.instanceIndex),a.instanceGrid.getView().focusRow(b.data.instanceIndex),a.stateGrid.getSelectionModel().suspendEvents(!1),a.stateGrid.getSelectionModel().select(b.data.stateIndex),
a.stateGrid.getView().focusRow(b.data.stateIndex),a.stateGrid.getSelectionModel().resumeEvents())}}},store:new Ext.data.ArrayStore({fields:"type instance field value typeIndex instanceIndex stateIndex".split(" "),autoDestroy:!0})}]}]}]},{xtype:"treepanel",title:"Symbols",autoScroll:!0,showRoot:!1,forceFit:!0,root:{text:"Key",allowDrag:!1,allowDrop:!1,leaf:!1,isTarget:!1,expanded:!0,key:"",root:!0,value:""},fields:["text","key","value"],columns:[{dataIndex:"text",header:"Symbol",xtype:"treecolumn"},
{dataIndex:"key",align:"right",header:"Key"},{dataIndex:"value",align:"right",header:"Value",renderer:"htmlEncode"}],listeners:{afterrender:function(a){a.fewmetViewer=a.ownerCt.ownerCt;a.fewmetViewer.symbolTab=a},beforeitemexpand:function(a,b){this.fewmetViewer.expandReferenceNode(a,b)}}}]}]});this.callParent();this.on("afterOpen",function(a,b){this.loadHeapDump(a,b)})},makeAttributeNode:function(a,b,c,d,f){var e={};f&&void 0!==c&&void 0!==d.getById(b)&&null!==d.getById(b)?(e.expandable=!0,e.leaf=
!1):(e.expandable=!1,e.leaf=!0);e.text=a;e.key=void 0===b||null===b||""===b?a:a+" ("+b+")";e.value=c;e.type=b;e.editor=this;return e},makeSymbolNode:function(a,b,c,d){var f={};f.text=a;f.key=a;f.value="Type "+b+" ("+c+" bytes)";f.children=d;return f},expandReferenceNode:function(a,b){if(!(0<a.childNodes.length)){var c=Ext.util.Format.htmlDecode(a.data.key).replace(/.*\(/,""),c=c.substring(0,c.length-1);if(0!==c.length){var c=this.typeGrid.store.getById(c),d=c.data.index[a.data.value],f=[],e=this.getAttributeDomain(c,
d);if(this.__isPrimitive(e))f.push(this.makeAttributeNode("value","",e,this.typeGrid.store,!0));else for(var h=0;h<e.length;h++){var g=c.data.definition[h];void 0===g&&void 0!==c.data.collectionType&&(g=c.data.collectionType);var l=this.getValue(d.value,h),g=this.makeAttributeNode(e[h].keyDisplayValue?e[h].keyDisplayValue:h,g,l,this.typeGrid.store,!0);f.push(g)}a.appendChild(f)}}},calcReferencingInstances:function(){var a=this.inboundReferenceGrid.getSelectionModel().getSelection();if(void 0===a||
0===a.length)return[];var b=this.instanceGrid.getSelectionModel().getSelection();if(void 0===b||0===b.length)return[];for(var c=this.typeGrid.store.getById(a[0].data.type),d=[],f=0;f<c.data.extent.length;f++)c.data.extent[f].value[a[0].data.field]===b[0].data.address&&d.push({address:c.data.extent[f].address,size:c.data.extent[f].size,type:c.data.typeName});return d},getMemberType:function(a){var b="",c;for(c in a.data.definition)"string"===typeof c&&"function"!==typeof attributeDomain[c]&&""!==a.data.definition&&
(b=a.data.definition[c]);""===b&&""!==a.data.collectionType&&(b=a.data.collectionType);return b},getValue:function(a,b){var c="";return c=a.entry?a.entry[b].value.value:a.value&&"object"===typeof a.value?a.value[b].value:a.value},getType:function(a,b){return 0<=b&&a.data.definition[b]?a.data.definition[b].type:""!==a.data.collectionType?a.data.collectionType:""},getAttributeDomain:function(a,b){var c=a.data.definition.entry;if(!c||0===c.length)c=b.value.entry?b.value.entry:b.value.value;return c}});
Ext.define("apex.editor.CompileableSourceEditor",{extend:"apex.editor.SourceFileEditor",alias:"widget.compileablesourceeditor",shownCoverage:null,instance:0,workspace:function(){var a=this.callParent();this.containerMemberId&&(this.cmEditor&&this.cmEditor.hasErrors())&&(a.errors=!0);this.metadata&&(a.apiVersion=this.metadata.apiVersion);return a},clearDirty:function(){this.callParent();this.containerMemberId=null},loadContent:function(){if(this.containerMemberId){var a=SfdcDevConsole.Extents.getExtentFromId(this.id);
if(!a)throw"No extent for an open entity that has a container member.";SfdcDevConsole.ToolingAPI.sobject(a.memberType,{id:this.containerMemberId,continuation:function(a){this.timestamp=Ext.Date.parse(a.LastSyncDate,"c").getTime();this.fireEvent("afterLoad",a)}.bind(this),failure:function(a){this.fireEvent("failedLoad",a)}.bind(this)})}else this.callParent()},onChange:function(){if(!this.loading&&(this.instance++,this.setDirty(),this.staleCoverage=!0,this.showCoverage(this.shownCoverage),this.canEdit())){this.startCompiling();
var a=apex.editor.CompileableSourceEditor,c=Date.now()>=apex.ide.IDE.NextEarliestCompileTime?a.typeDelay:Math.max(a.typeDelay,apex.ide.IDE.NextEarliestCompileTime-Date.now());a.saveContainerDeploySingleTask.delay(c,null,null,[{editor:this,containerId:apex.ide.IDE.containerId,checkOnly:!0,runTests:!1,instance:this.instance}])}},onClose:function(){this.containerMemberId&&apex.ide.Container.deleteContainerMember(apex.ide.IDE.containerId,this)},setVersion:function(a){this.fireEvent("versionLoaded",a)},
setTriggerActive:function(a){this.fireEvent("triggerActiveLoaded",a)},performSave:function(a,c){apex.editor.CompileableSourceEditor.saveContainerDeploySingleTask.cancel();apex.ide.Container.saveContainerDeployMulti([this],apex.ide.IDE.containerId,!1,!1,c)},initComponent:function(){this.callParent();this.on("afteropen",function(){if(this.containerMemberId&&this.errors){var a=this;SfdcDevConsole.ToolingAPI.query("SELECT Id, DeployDetails, SystemModstamp, IsCheckOnly, State FROM ContainerAsyncRequest WHERE MetadataContainerId \x3d '"+
apex.ide.IDE.containerId+"' AND State \x3d 'Failed' AND IsCheckOnly \x3d true ORDER BY SystemModstamp DESC LIMIT 1",{continuation:function(c){if(1===c.records.length){c=c.records[0].DeployDetails.componentFailures;for(var k=c.length;k--;){var h=[],e=c[k];e.id===a.id&&h.push(e);SfdcDevConsole.Events.EventDispatcher.fire("problems:new",[h])}}else apex.ide.Container.createDeployment(apex.ide.IDE.containerId,null,!1,!0)}})}});this.containerMemberId&&this.setDirty();this.on("afterOpen",function(a){this.metadata||
(this.metadata={});this.metadata.apiVersion=a.ApiVersion||a.metadata&&a.metadata.apiVersion||this.apiVersion||void 0;this.versionButton&&this.versionButton.store.loadData(this.loadInitialVersions());this.metadata.apiVersion?(this.setVersion(this.metadata.apiVersion),this.metadata.apiVersion<=SfdcDevConsole.ToolingAPI.version-SfdcDevConsole.ToolingAPI.availableVersions&&this.versionButton.store.add({version:this.metadata.apiVersion})):this.versionButton.hide();a.Status&&(this.metadata.status=a.Status||
a.metadata.status,this.setTriggerActive("Active"==this.metadata.status))})},compiling:!1,compiled:!1,startCompiling:function(){this.compiling=!0},finishedCompiling:function(a,c){this.compiling=!1;(this.compiled=void 0!==c?c:!0)&&"function"===typeof a&&a(this)},initBody:function(a){a.Metadata&&(this.metadata=a.Metadata);Sfdc.isString(a.Body)?this.setValue(a.Body):this.callParent([a]);this.clearHistory()},loadInitialVersions:function(){versions=[];for(var a=0;a<SfdcDevConsole.ToolingAPI.availableVersions;a++)versions.push({version:SfdcDevConsole.ToolingAPI.version-
a});return versions},versionButtonDefinition:{xtype:"combo",editable:!1,fieldLabel:"API Version",labelWidth:70,width:120,store:Ext.create("Ext.data.Store",{fields:["version"],data:[]}),queryMode:"local",displayField:"version",valueField:"version",listeners:{afterrender:function(a){a.editor=a.ownerCt.ownerCt;a.editor.versionButton=a;a.editor.on("versionLoaded",function(c){a.setValue(c)})},change:function(a,c){a.editor.metadata?a.editor.metadata.apiVersion!=c&&a.editor.setDirty():a.editor.metadata=
{};a.editor.metadata.apiVersion=c}}},toolbarButtons:function(){return[this.versionButtonDefinition]},statics:{typeDelay:5E3,availableVersionNumber:5,processResults:function(a,c,k,h,e){try{if(null===a){if(SfdcDevConsole.Events.EventDispatcher.fire("problems:clear"),"function"===typeof e)for(var d=Ext.getCmp("editors"),f=0;f<d.items.length;f++){var b=d.items.get(f);b.opened&&e(b)}}else{d=Ext.getCmp("editors");for(f=0;f<d.items.length;f++)b=d.items.get(f),b instanceof apex.editor.CompileableSourceEditor&&
(b.opened&&(b.clear(),b.finishedCompiling()),a.symbolTables&&a.symbolTables[b.id]&&b.setSymbolTable(a.symbolTables[b.id]),a.metadataRecords[b.id]&&(b.metadata=a.metadataRecords[b.id],b.setVersion(b.metadata.apiVersion),b.metadata.status&&b.setTriggerActive("Active"==b.metadata.status)));b=d.getActiveTab();setTimeout(function(){b&&(b instanceof apex.editor.CompileableSourceEditor&&b.opened&&a.symbolTables&&a.symbolTables[b.id])&&b.applySymbolTable();"function"===typeof e&&e(b)},100);k&&SfdcDevConsole.Events.EventDispatcher.fire("problems:clear");
SfdcDevConsole.Events.EventDispatcher.fire("problems:new",[a.results]);if(c&&void 0!==a.timestamps){c=function(b){for(var c=a.results||a.metadataRecords,d=0;d<c.length;d++)if(a.results[d].id===b)return!0;return!1};for(var g in a.timestamps)if("string"===typeof g&&!c(g)){SfdcDevConsole.Events.EventDispatcher.fire("problems:clear",[[g]]);var b=d.items.get(d.items.findIndex("id",g)),l=SfdcDevConsole.Extents.getExtentFromId(b.id);b.timestamp=a.timestamps[g].timestamp;b.Name=a.timestamps[g].name;b.title=
escapeHTML(b.Name)+"."+l.getExtension(b);b.clearDirty();!h||h[b.id]>=b.instance?Sfdc.log("Instance of editor same as what we saved, all done"):(Sfdc.log("Instance of editor more recent than what we saved, mark dirty again"),b.setDirty());b.Name=a.timestamps[g].name}}}}catch(m){apex.ide.IDE.sendGack(m)}finally{Ext.getCmp("saveAllButton").enable(),Ext.getCmp("saveAllButton").setText(SfdcDevConsole.Menu.menuEntryWithShortcut("Save All",!0,!0,!1,"S"))}},saveContainerDeploySingleTask:new Ext.util.DelayedTask(function(a){a.editor.saving||
(apex.ide.IDE.NextEarliestCompileTime=apex.ide.IDE.CompileDelayTime+Date.now(),apex.ide.Container.saveContainerDeployMulti([a.editor],a.containerId,a.checkOnly,a.runTests,a.callback))})}});
Ext.define("apex.csi.BaseLogViewer",{extend:"apex.ide.Viewer",workspace:function(){var a=this.callParent();a.logId=this.logId;return a},downloadLog:function(){this.logId&&apex.csi.LogBrowser.downloadLogViaDownloadServlet(this.logId)}});
Ext.define("apex.csi.LogViewer",{extend:"apex.csi.BaseLogViewer",alias:"widget.logviewer",workspace:function(){var a=this.callParent();a.perspectiveConfig=this.perspectiveConfig;return a},save:function(){apex.ide.CsiPerspectiveDefinition.saveCurrentPerspective()},highlightedPanel:null,highlight:function(a){this.highlightedPanel!==a&&(this.highlightedPanel&&this.highlightedPanel.el.setStyle({border:""}),this.highlightedPanel=a,a.el.setStyle({border:"solid #ea8b2e 2px"}))},loadContent:function(){SfdcDevConsole.ToolingAPI.request({url:"/_ui/common/apex/debug/ApexCSIAPI",
data:{action:"OPEN",entity:this.logId},success:function(a){a=Util.evalAjaxServletOutput(a);a.success?this.fireEvent("afterLoad",a):(a=Sfdc.JSON.stringify({errorCode:LC.getLabel("DeveloperConsole","LoadLogFailedTitle"),message:LC.getLabel("DeveloperConsole","LoadLogFailedBody")}),this.fireEvent("failedLoad",a))}.bind(this),failure:function(a){this.fireEvent("failedLoad",a)}.bind(this)})},listeners:{afterOpen:function(a){this.loadTrace(a)},resize:function(){if(this.isLoaded)try{Ext.suspendLayouts(),
apex.ide.CsiPerspectiveDefinition.resizePanels(this.items)}finally{Ext.resumeLayouts(!0)}else apex.ide.CsiPerspectiveDefinition.resizePanels(this.items);this.isLoaded=!0},deactivate:function(){Ext.getCmp("logPanelWindow").hide();Ext.getCmp("perspectiveWindow").hide()},close:function(){Ext.getCmp("perspectiveWindow").hide();Ext.WindowManager.each(function(a){"detailWindow"===a.xtype&&a.destroy()})}},isStackLoaded:!1,isLogLoaded:!1,loadTrace:function(a){(new Date).getTime();var b=this.logPanel;apex.ide.IDE.startProgress(6,
"Loading...","Loading log","Checking log...",function(){b.getSelectionModel().select(0)});if(a.success){this.sourceUrlMap=a.sourceUrlMap;this.selectedTraceLevels=a.traceLogMap;this.requestStartTime=new Date(a.requestStartTimeMillis);a=this.executionSummaryPanel.getView().getHeaderCt();var d=this.sourcePanel.getView().getHeaderCt(),g=this.variablePanel;"Finest"!==this.selectedTraceLevels.APEX_CODE&&g.getRootNode().appendChild({text:"\x26lt;empty\x26gt;",variable:"\x26lt;empty\x26gt;",value:"Must trace APEX_CODE at FINEST"});
switch(this.selectedTraceLevels.APEX_CODE){case "Finest":case "Fine":case "Finer":this.executionOverview.isVisible()&&(a.items.get(a.items.findIndex("dataIndex","cumulativeNanos")).setVisible(!0),a.items.get(a.items.findIndex("dataIndex","averageNanos")).setVisible(!0),a.items.get(a.items.findIndex("dataIndex","maxNanos")).setVisible(!0),a.items.get(a.items.findIndex("dataIndex","minNanos")).setVisible(!0));d.items.get(d.items.findIndex("dataIndex","invocations")).setVisible(!0);break;default:this.executionOverview.isVisible()&&
(a.items.get(a.items.findIndex("dataIndex","cumulativeNanos")).setVisible(!1),a.items.get(a.items.findIndex("dataIndex","averageNanos")).setVisible(!1),a.items.get(a.items.findIndex("dataIndex","maxNanos")).setVisible(!1),a.items.get(a.items.findIndex("dataIndex","minNanos")).setVisible(!1)),d.items.get(d.items.findIndex("dataIndex","invocations")).setVisible(!1)}var h=this.logPanel.getStore();h.logPanel=this.logPanel;SfdcDevConsole.ToolingAPI.request({url:"/servlet/debug/apex/ApexCSIJsonServlet?log\x3d"+
this.logId+"\x26extent\x3dsteps",continuation:function(a,b){h.setRecords(a);apex.ide.IDE.incrementProgress("Loaded log lines");Sfdc.Perf.endMark("LoadLogFile")}});this.sourcePanel.getStore().sourcePanel=this.sourcePanel;this.sourcePanel.getStore().load({params:{log:this.logId,extent:"sourceLines"}});this.sourceListPanel.getStore().sourceListPanel=this.sourceListPanel;this.sourceListPanel.getStore().load({params:{log:this.logId,extent:"sources"}});this.executionSummaryPanel.getStore().executionSummaryPanel=
this.executionSummaryPanel;this.executionSummaryPanel.getStore().load({params:{log:this.logId,extent:"methods"}});this.executionStack.getStore().executionStack=this.executionStack;this.executionStack.getStore().load({params:{log:this.logId,extent:"frames"}});this.variablePanel.addressStore.variablePanel=this.variablePanel;this.variablePanel.addressStore.load({params:{log:this.logId,extent:"heap"}});this.variablePanel.staticStore.variablePanel=this.variablePanel;this.variablePanel.staticStore.load({params:{log:this.logId,
extent:"statics"}});this.size=this.rawLogSize}else Ext.MessageBox.hide(),Ext.MessageBox.show({icon:Ext.MessageBox.ERROR,title:"Salesforce System Error",msg:a.errorText,width:200,buttons:Ext.MessageBox.OK})},selectedTraceLevels:{},visiblePanels:0,perspectiveConfig:null,isPerspectiveDirty:!1,getSelectedPanelsMenuItem:function(a){return Ext.getCmp("logPanelWindow").items.get(a)},isPerspectiveUnsaved:!1,hidePanel:function(a){a.hide();void 0!==a.ownerCt.visiblePanels&&(a.ownerCt.visiblePanels--,0===a.ownerCt.visiblePanels&&
this.hidePanel(a.ownerCt));this.adjustPanelSizes(a.ownerCt)},showPanel:function(a){void 0!==a.ownerCt.visiblePanels&&(++a.ownerCt.visiblePanels,1===a.ownerCt.visiblePanels&&this.showPanel(a.ownerCt));a.show();if(0===a.getWidth()||0===a.getHeight())a.setWidth(Math.round(a.ownerCt.getWidth()/a.ownerCt.items.items.length)),a.setHeight(Math.round(a.ownerCt.getHeight()/a.ownerCt.items.items.length));this.adjustPanelSizes(a.ownerCt)},adjustPanelSizes:function(a){if(a instanceof apex.ide.panelContainer||
a instanceof apex.csi.LogViewer)for(var b=0;b<a.items.items.length;b++)childPanel=a.items.items[b],childPanel.isVisible()&&(childPanel.suspendEvents(),"hbox"===a.layout.type&&childPanel.setWidth(Math.round(1/a.visiblePanels*a.getWidth())),"vbox"===a.layout.type&&childPanel.setHeight(Math.round(1/a.visiblePanels*a.getHeight())),childPanel.resumeEvents())},initComponent:function(){var a={displayName:"Log",layout:{type:"vbox",align:"stretch"}};if(this.perspectiveConfig)c=Ext.JSON.decode(this.perspectiveConfig),
a.items=Ext.JSON.decode(c.Content),this.currentPerspectiveConfig={id:c.Id,label:escapeHTML(c.Name),perspectiveConfig:c.Content};else if(apex.csi.LogViewer.defaultPerspectiveConfig.perspectiveConfig){var b=apex.ide.CsiPerspectiveDefinition.getPredefined(apex.csi.LogViewer.defaultPerspectiveConfig.label);b?(a.items=Ext.JSON.decode(b.perspectiveConfig),this.currentPerspectiveConfig=b):(a.items=Ext.JSON.decode(apex.csi.LogViewer.defaultPerspectiveConfig.perspectiveConfig),this.currentPerspectiveConfig=
apex.csi.LogViewer.defaultPerspectiveConfig)}else a.items=Ext.JSON.decode(apex.ide.CsiPerspectiveDefinition.predefinedPerspectives.LogOnly.perspectiveConfig),this.currentPerspectiveConfig={label:apex.ide.CsiPerspectiveDefinition.predefinedPerspectives.LogOnly.label,perspectiveConfig:Ext.JSON.encode(apex.ide.CsiPerspectiveDefinition.predefinedPerspectives.LogOnly.perspectiveConfig)};Ext.apply(this,a);this.callParent()},statics:{myUserId:null,levels:"NONE ERROR WARN INFO DEBUG FINE FINER FINEST".split(" "),
haveIds:[],fineGrained:!1,categoryLabelMap:{APEX_CODE:"Apex Code",WORKFLOW:"Workflow",DB:"Database",VALIDATION:"Validation",CALLOUT:"Callout",VISUALFORCE:"Visualforce",SYSTEM:"System"},perspectiveWindow:Ext.create("Ext.window.Window",{title:"Developer Console Perspective",id:"perspectiveWindow",height:200,width:400,layout:"fit",closeAction:function(){this.hide()},bbar:[{text:"Open",id:"perspectiveWindowOpenButton",handler:function(){Ext.getCmp("editors").getActiveTab();var a=Ext.getCmp("perspectiveWindow").items.getAt(0).getSelectionModel().getSelection()[0];
void 0!==a&&SfdcDevConsole.Events.EventDispatcher.fire("perspective:open",[apex.ide.CsiPerspectiveDefinition,a.data.name]);Ext.getCmp("perspectiveWindow").hide()}},{text:"Set Default",id:"perspectiveWindowSetDefaultButton",handler:function(){Ext.getCmp("editors").getActiveTab();var a=Ext.getCmp("perspectiveWindow").items.getAt(0),b=a.getSelectionModel().getSelection()[0];SfdcDevConsole.Events.EventDispatcher.fire("perspective:setDefault",[apex.ide.CsiPerspectiveDefinition,a,b.data.name]);Ext.Msg.confirm("Confirm",
"Do you want to set "+escapeHTML(b.data.name)+" as the default perspective?",function(d,g){"yes"==d&&SfdcDevConsole.Events.EventDispatcher.fire("perspective:setDefault",[apex.ide.CsiPerspectiveDefinition,a,escapeHTML(b.data.name)])})}},{text:"Delete",id:"perspectiveWindowDeleteButton",handler:function(){var a=Ext.getCmp("perspectiveWindow").items.getAt(0).getSelectionModel().getSelection()[0];Ext.Msg.confirm("Confirm","Do you really want to delete the "+escapeHTML(a.data.name)+" perspective?",function(b,
d){"yes"==b&&SfdcDevConsole.Events.EventDispatcher.fire("perspective:deletePerspective",[apex.ide.CsiPerspectiveDefinition,{id:a.data.id,label:escapeHTML(a.data.name)},function(){var b=Ext.getCmp("editors"),d=Ext.getCmp("perspectiveWindow").items.getAt(0),e=a.data.name,f=d.store;f.removeAt(f.findExact("name",e));for(f=0;f<b.items.length;f++)p=b.items.items[f],p instanceof apex.csi.LogViewer&&e===p.currentPerspectiveConfig.label&&(p.perspectiveConfig=null,p.currentPerspectiveConfig={},p.opened&&(p.isPerspectiveUnsaved=
!0));e===apex.csi.LogViewer.defaultPerspectiveConfig.label&&(apex.csi.LogViewer.defaultPerspectiveConfig={label:apex.ide.CsiPerspectiveDefinition.predefinedPerspectives.LogOnly.label,perspectiveConfig:apex.ide.CsiPerspectiveDefinition.predefinedPerspectives.LogOnly.perspectiveConfig});d.getView().refresh()}])})}},{xtype:"tbfill"},{text:"Cancel",id:"perspectiveWindowCancelButton",handler:function(){Ext.getCmp("perspectiveWindow").hide()}}],listeners:{show:function(){apex.ide.CsiPerspectiveDefinition.getPerspectiveList();
var a=Ext.getCmp("editors").getActiveTab();a&&a.currentPerspectiveConfig?Ext.getCmp("perspectiveWindowOpenButton").enable():Ext.getCmp("perspectiveWindowOpenButton").disable()}},items:[{xtype:"grid",id:"perspectiveWindowGrid",autoExpandColumn:"Name",forceFit:!0,selModel:{mode:"SINGLE"},columns:[{header:"id",dataIndex:"id",hidden:!0},{header:"Name",width:100,dataIndex:"name",renderer:function(a,b,d){if((a=Ext.getCmp("editors").getActiveTab())&&a.currentPerspectiveConfig&&d.data.name===a.currentPerspectiveConfig.label)if(b.style=
'font-weight:bold;"',a.isPerspectiveDirty)return escapeHTML(d.data.name)+"*";return escapeHTML(d.data.name)}},{header:"Default",width:100,renderer:function(a,b,d){if((a=Ext.getCmp("editors").getActiveTab())&&a.currentPerspectiveConfig&&d.data.name===a.currentPerspectiveConfig.label)b.style='font-weight:bold;"';return d.data.name===apex.csi.LogViewer.defaultPerspectiveConfig.label?"true":""}}],store:Ext.create("Ext.data.Store",{storeId:"perspectives",idField:"id",fields:[{name:"id"},{name:"name"}]}),
listeners:{itemdblclick:function(a,b,d,g,h,e){Ext.getCmp("editors").getActiveTab();b&&SfdcDevConsole.Events.EventDispatcher.fire("perspective:open",[apex.ide.CsiPerspectiveDefinition,b.data.name]);Ext.getCmp("perspectiveWindow").hide()}}}]}),findEditorPanel:function(a,b){for(;void 0!==a;){if(a.xtype===b)return a;a=a.ownerCt}return null},getChildPanel:function(a,b){return a.items.items[b]},defaultPerspectiveConfig:{},currentPerspectiveConfig:{},unsavedPerspectiveText:"unsaved *"}},function(){apex.ide.IDE.on("perspectiveLoaded",
function(a,b){var d;d=Ext.decode(a.Content);apex.ide.CsiPerspectiveDefinition.perspectiveConfigMap=apex.ide.CsiPerspectiveDefinition.getPerspectiveConfigMap(b);b.suspendEvents();apex.ide.CsiPerspectiveDefinition.applyPerspective(b,d,b);b.resumeEvents();b.perspectiveConfig=Ext.JSON.encode(a);b.currentPerspectiveConfig={perspectiveConfig:a.Content,label:a.Name,id:a.Id};b.isPerspectiveDirty=!1;b.isPerspectiveUnsaved=!1});apex.ide.IDE.on("workspaceLoaded",function(a){apex.csi.LogViewer.defaultPerspectiveConfig=
a.defaultPerspectiveConfig?a.defaultPerspectiveConfig:{label:apex.ide.CsiPerspectiveDefinition.predefinedPerspectives.LogOnly.label,perspectiveConfig:apex.ide.CsiPerspectiveDefinition.predefinedPerspectives.LogOnly.perspectiveConfig};if((a=Ext.getCmp("editors").getActiveTab())&&a instanceof apex.csi.LogViewer&&!a.perspectiveConfig){a.currentPerspectiveConfig=apex.csi.LogViewer.defaultPerspectiveConfig;var b;b=Ext.JSON.decode(apex.csi.LogViewer.defaultPerspectiveConfig.perspectiveConfig);apex.ide.CsiPerspectiveDefinition.perspectiveConfigMap=
apex.ide.CsiPerspectiveDefinition.getPerspectiveConfigMap(a);a.suspendEvents();apex.ide.CsiPerspectiveDefinition.applyPerspective(a,b,a);a.resumeEvents()}})});
Ext.define("apex.csi.RawLogViewer",{extend:"apex.csi.BaseLogViewer",xtype:"rawlogviewer",loadContent:function(a){a=Sfdc.isDefAndNotNull(a)?a:!0;var b=this,d=apex.ide.IDE.sobjectUrl("ApexLog",!0,this.logId,!1,"Body");this.add({xtype:"textarea",cls:"rawLogViewer",loader:{autoLoad:a,url:d,ajaxOptions:{headers:{Authorization:"OAuth "+SfdcDevConsole.SID,Accept:"application/json"}},renderer:function(a,d,e){if(e=d&&d.responseText)return a.getTarget().setValue(e),b.size=e.length,b.fireEvent("afterLoad",d),
!0;b.fireEvent("failedLoad",d)},failureMessage:"Unable to open log file"},autoScroll:!0,listeners:{change:function(a){a.changed=!0}}});a&&this.doLayout();Ext.MessageBox.hide()},initComponent:function(){Ext.apply(this,{layout:"fit"});this.callParent()},downloadLog:function(){var a=this.child("textarea");if(a){var b=a.getValue(),b=new Blob([b],{type:"application/text"}),b=window.URL.createObjectURL(b);apex.csi.LogBrowser.downloadLogViaURL(b,this.logId+(a.changed?"-cropped":""))}else apex.csi.LogBrowser.downloadLogViaDownloadServlet(this.logId)}});
Ext.define("apex.editor.ApexEditor",{alias:"widget.apexeditor",extend:"apex.editor.CompileableSourceEditor",mode:{name:"apex",variables:{}},getAddons:function(){var a=this.callParent();Sfdc.apply(a,{matchBrackets:!0,autoCloseBrackets:!0,foldGutter:{rangeFinder:new CodeMirror.fold.combine(CodeMirror.fold.brace,CodeMirror.fold.comment)},continueComments:!0});a.extraKeys&&(a.extraKeys=Sfdc.apply(a.extraKeys,{"Ctrl-H":function(a){var c=a.findMatchingBracket(a.getCursor());c.match&&a.setCursor(c.to)}}));
return a},markersByLine:null,markersByKey:null,symbolTable:null,setSymbolTable:function(a){this.symbolTable=a;this.symbolTableAdded=new Date},getSymbolsFromTable:function(a,b,c){b=b||this.symbolTable;c=c||[];if(!b)return c;a||c.push(b.tableDeclaration);var d=b.constructors;Sfdc.isArray(d)||(d=[]);for(a=0;a<d.length;a++){var e=d[a];e.kind="CONSTRUCTOR";c.push(e)}d=b.methods;Sfdc.isArray(d)||(d=[]);for(a=0;a<d.length;a++)e=d[a],e.kind="METHOD",c.push(e);d=b.variables;Sfdc.isArray(d)||(d=[]);for(a=0;a<
d.length;a++)e=d[a],e.kind="VARIABLE",c.push(e);d=b.properties;Sfdc.isArray(d)||(d=[]);for(a=0;a<d.length;a++)e=d[a],e.kind="VARIABLE",c.push(e);b=b.innerClasses;Sfdc.isArray(b)||(b=[]);for(a=0;a<b.length;a++)this.getSymbolsFromTable(!1,b[a],c);return c},getSymbolTableFromCache:function(a){var b=this;b.symbolTable||SfdcDevConsole.ToolingAPI.getSymbolTable(this.namespace,this.Name,{continuation:function(c,d){d&&!b.symbolTable&&b.applySymbolTable(d);Sfdc.isFunction(a)&&a(d)}})},canOpen:function(){return apex.ide.IDE.hasApex},
canEdit:function(){return apex.ide.IDE.authorApex},applySymbolTable:function(a){if(a)this.setSymbolTable(a),SfdcDevConsole.Core.Autocomplete.Apex.tables.setClass(a.namespace,a.name,a);else if(!this.opened||!this.symbolTable||this.symbolTableAdded<this.symbolTableApplied)return;a=this.getSymbolsFromTable();this.resetMakerLists();this.updateLastMarkerKeys();for(i=0;i<a.length;i++)this.addSymbol(a[i]);a=this.symbolTable.externalReferences;var b;if(a)for(i=0;i<a.length;i++){var c=a[i],d=c.namespace,e=
c.name;this.addReferences(e,"CLASS",c.references,null,d,e);methods=c.methods;for(b=0;b<methods.length;b++)this.addReferences(methods[b].name,"METHOD",methods[b].references,null,d,e);variables=c.variables;for(b=0;b<variables.length;b++)this.addReferences(variables[b].name,"VARIABLE",variables[b].references,null,d,e);this.addReferences(e,"CLASS",c.references,null,d,e);this.addReferences(e,"CLASS",c.references,null,d,e)}a=[];for(var f in this.lastMarkersByKey)this.lastMarkersByKey.hasOwnProperty(f)&&
this.lastMarkersByKey[f]&&a.push(this.lastMarkersByKey[f]);this.clearMarkers(a);this.symbolTableApplied=new Date},updateLastMarkerKeys:function(){var a={},b=this.lastMarkersByKey,c;for(c in b)if(b.hasOwnProperty(c)){var d=b[c];if(d.find&&d.find()){var e=d.find().from;e&&(e=e.line+1+"-"+(e.ch+1),0!==c.indexOf(e)&&(c=e+c.substring(c.indexOf(":"))));a[c]=d}}this.lastMarkersByKey=a},getAndRemoveLastMarker:function(a){var b=null;if(this.lastMarkersByKey.hasOwnProperty(a)){b=this.lastMarkersByKey[a];if(!b||
!b.find)return null;var c=b.find();!c||!c.from?b=null:this.lastMarkersByKey[a]=void 0}return b},addSymbol:function(a){if("BLOCK"!==a.kind){var b=a.kind+"_DECLARATION",c=a.location;if(c){var d={line:c.line,column:c.column+a.name.length},e=c.line+"-"+c.column+":declaration"+a.name+a.kind,f=this.getAndRemoveLastMarker(e);null===f&&(f=this.cmEditor.setMarker(c,d,{className:b}),f.symbol=a);a.references&&this.addReferences(a.name,a.kind,a.references,f);this.addMarker(e,f,c.line)}}},addReferences:function(a,
b,c,d,e,f){for(var g=0;g<c.length;g++){var h=c[g],m={line:h.line,column:h.column+a.length},l=h.line+"-"+h.column+":reference"+a+b+e+f,k=this.getAndRemoveLastMarker(l);null===k&&(k=this.cmEditor.setMarker(h,m,{className:b+"_REFERENCE USER_DEFINED"}),d?k.declarationMarker=d:k.externalMarker={namespace:e,className:f,name:a,kind:b});this.addMarker(l,k,h.line)}},addMarker:function(a,b,c){return this.markersByKey?(this.markersByLine[c]||(this.markersByLine[c]=[]),this.markersByLine[c].push(b),this.markersByKey[a]=
b):null},resetMakerLists:function(){this.lastMarkersByKey=this.markersByKey?this.markersByKey:{};this.markersByLine={};this.markersByKey={}},clearMarkers:function(a){if(a)for(var b=0;b<a.length;b++)a[b].clear()},findMarkers:function(a,b){if(!this.markersByKey)return this.compiling?Ext.Msg.alert("Compiling...","The class has to finish compiling before you can navigate through symbols."):Ext.Msg.alert("Symbol Error","The symbols have not been retrieved from Salesforce. Try to save or compile your class to retrieve the symbol table."),
[];var c,d=[],e;for(e in this.markersByKey)this.markersByKey.hasOwnProperty(e)&&(c=this.markersByKey[e],c.symbol&&(c.symbol.name.toLowerCase()===a.toLowerCase()&&c.symbol.kind===b)&&d.push(c));return d},findMarkerByPosition:function(a){if(!this.markersByLine)return this.compiling?Ext.Msg.alert("Compiling...","The class has to finish compiling before you can navigate through symbols."):Ext.Msg.alert("Symbol Error","The symbols have not been retrieved from Salesforce. Try to save or compile your class to retrieve the symbol table."),
null;var b=this.markersByLine[a.line];if(b&&0<b.length)for(var c=0;c<b.length;c++){var d=b[c],e=d.find();if(e&&e.from&&e.to&&e.from.ch<=a.ch&&e.to.ch>=a.ch)return d}return null},gotoDeclaration:function(a){(a=this.findMarkerByPosition({line:a.line+1,ch:a.ch}))&&(a.declarationMarker?this.gotoMarker(a.declarationMarker):a.externalMarker&&this.gotoExternalMarker(a.externalMarker))},gotoMarker:function(a){if(a&&"function"==typeof a.find){var b=a.find();b&&b.from&&b.to?this.cmEditor.select(b.from,b.to):
Sfdc.log("Can't find symbol for "+Sfdc.JSON.stringify(a)+". It was possibly deleted.")}this.cmEditor.focus()},gotoExternalMarker:function(a){SfdcDevConsole.Extents.ApexClass.findId(a.namespace,a.className,function(b){b&&SfdcDevConsole.Extents.ApexClass.open({data:{id:b,name:a.className}},function(b){var d=function(){var e=b.findMarkers(a.name,a.kind);e&&0<e.length&&b.gotoMarker(e[0])};b.symbolTable?d():b.getSymbolTableFromCache(d)})})},updateRunTestFilter:function(){var a=this.testResults.store,b;
b=this.thisSessionOnlyButton.checked?function(a,b){return a.data.timeMillis>apex.ide.IDE.showUpdatesFromTime}:function(a,b){return!0};var c=this.testResults,d=c.getSelectionModel().hasSelection()?c.getSelectionModel().getSelected():null;null!==d&&!b(d,d.id)&&c.getSelectionModel().clearSelections();c.suspendEvents();a.filterBy(function(a,c){return b(a,c)});c.resumeEvents()},save:function(a){if(this.hasBreakpoints){var b=Ext.StoreMgr.lookup("fewmetConfig"),c=this.cmEditor,d=[],e=this.id;b.each(function(a){if(a.data.ExecutableEntityId===
e){var b=c.getLine(a.data.handle);0<=b?b!=a.data.Line&&a.set("Line",b):d.push(a)}});b.remove(d);b.sync()}this.callParent(arguments)},coverageCycle:{xtype:"cycle",showText:!0,prependText:"Code Coverage: ",menu:{items:[{text:"None"}]},changeHandler:function(a,b){a.editor&&("None"===b.text?a.editor.showCoverage(null):"All Tests"===b.text.slice(0,9)?apex.test.TestResult.getAggregateCodeCoverage(a.editor.id,function(c){a.editor.showCoverage(c);a.editor.staleCoverage=!1;var d=Ext.getCmp("aggregateCoverageGrid").store.getAt(Ext.getCmp("aggregateCoverageGrid").store.find("classId",
a.editor.id)),e=apex.test.TestResult.getPercent(c.numLinesCovered,c.numLinesUncovered);c=apex.test.TestResult.getNumLineStr(c.numLinesCovered,c.numLinesUncovered);d.set("numLines",c);d.set("percent",e);d.commit();b.setText("All Tests "+e+"%");a.setText(a.prependText+b.text)}):b.testId&&apex.test.TestResult.getCodeCoverageForMethod(a.editor.id,b.testId,b.method,function(b){a.editor.showCoverage(b);a.editor.staleCoverage=!1}))},listeners:{afterrender:function(a){a.editor=a.ownerCt.ownerCt;a.editor.coverageCycle=
a;a.editor.updateCoverageCycle()}}},gotoButton:{text:"Go To",editor:this,cls:"gotoButton",listeners:{afterrender:function(a){a.ownerCt.ownerCt.gotoButton=a;a.editor=a.ownerCt.ownerCt},click:function(a){a.editor.gotoDeclaration(a.editor.cmEditor.codeEditor.getCursor())}}},runTestButton:{text:"Run Test",editor:this,hidden:!0,listeners:{afterrender:function(a){a.ownerCt.ownerCt.runTestButton=a;a.editor=a.ownerCt.ownerCt;a.editor.updateRunTestButtonVisibility()},click:function(a){a=[{classId:a.editor.id,
testMethods:null}];var b=apex.ide.IDE.runTestsSynchronously(a);apex.ide.IDE.runSelectedTests(a,b)}}},toolbarButtons:function(){var a=[this.coverageCycle];a.push(this.versionButtonDefinition);SfdcDevConsole.Extents.ApexTrigger.isId(this.id)&&apex.ide.IDE.toolingMDAPIDeploy&&a.push(this.triggerActiveCheckbox);a.push({xtype:"tbfill"},this.runTestButton,this.gotoButton);apex.ide.IDE.authorApex&&a.push(this.saveButtonDefinition);return a},triggerActiveCheckbox:{xtype:"checkbox",fieldLabel:"Active",listeners:{afterrender:function(a){a.editor=
a.ownerCt.ownerCt;a.editor.triggerActiveCheckbox=a;a.editor.on("triggerActiveLoaded",function(b){a.setValue(b)})},change:function(a,b){a.editor.metadata?"Active"==a.editor.metadata.status!=b&&(a.editor.setDirty(),a.editor.onChange()):a.editor.metadata={};a.editor.metadata.status=b?"Active":"Inactive"}}},refreshRelatedVFWindows:function(){var a=this.Name;Ext.Ajax.request({url:"/_ui/common/apex/debug/ApexCSIAPI",params:{action:"RELATED",extent:"CODE",relatedEntityEnumOrId:this.id},success:function(a,
c){var d=Ext.getCmp("editors"),e=Util.evalAjaxServletOutput(a.responseText);if(e&&e.relatedInstances&&(e=e.relatedInstances.relatedInstances))for(var f=0;f<e.length;f++){var g=ApiUtils.to18CharId(e[f].id),g=Ext.String.escapeRegex(g),g="^"+g+"$",g=d.items.findIndex("id",RegExp(g));-1!=g&&(g=d.items.get(g),"visualforceeditor"===g.xtype&&g.openOrRefreshWindow(!1))}},failure:function(b,c){SfdcDevConsole.ToolingAPI.handleFailedRequest(b,"Could not load related instances for: "+a,!0,!0)}})},initComponent:function(){this.hasBreakpoints=
apex.ide.IDE.bytecode;this.editorListeners.addBreakpoint=function(a,c,d){var e=Ext.StoreMgr.lookup("fewmetConfig");if(e.getCount()>=apex.ide.IDE.maxFewmets)return Ext.MessageBox.alert("Too many checkpoints","Cannot set more then "+apex.ide.IDE.maxFewmets+" checkpoint locations"),!1;a=a.editor;c=e.model.create({Id:void 0,IsDumpingHeap:!0,ExecutableEntityId:a.id,"ExecutableEntity.Name":a.Name,Line:c,Iteration:1,handle:d});e.insert(0,c);e.sync({success:function(a){Ext.each(a.operations,function(a){Ext.each(a.records,
function(a){a.dirty&&a.commit()})})}});return!0};var a=this;this.editorListeners.removeBreakpoint=function(b,c,d){b=Ext.StoreMgr.lookup("fewmetConfig");d=b.findBy(function(b,d){return b.data.ExecutableEntityId===a.id&&b.data.Line===c});-1<d&&(d=b.getAt(d),b.remove(d),b.sync())};this.callParent(arguments);this.on("activate",function(){this.applySymbolTable()},this);this.on("afterOpen",function(a){var c=this.cmEditor.codeEditor;c.editorInfo=this;SfdcDevConsole.Core.Autocomplete.Apex.getInstance(c);
this.navigateKeyMap||(this.navigateKeyMap=new Ext.KeyMap(this.getEl(),[{key:"n",scope:this,alt:!0,ctrl:!0,fn:function(){this.gotoDeclaration(c.getCursor())},defaultEventAction:"stopEvent"}]));if(apex.ide.IDE.bytecode)for(var d=Ext.getCmp("fewmetConfigGrid").store,e=0;-1!=(e=d.findExact("ExecutableEntityId",this.id,e));e++){var f=d.getAt(e).get("Line");this.cmEditor.setBreakpointMarker(f,!0)}a.SymbolTable&&this.setSymbolTable(a.SymbolTable);this.symbolTable?this.applySymbolTable():this.getSymbolTableFromCache()},
this)}});
Ext.define("apex.editor.StaticResource",{alias:"widget.staticresourceeditor",extend:"apex.editor.SourceFileEditor",mode:"javascript",extent:"SR",canEdit:function(){return apex.ide.IDE.authorVisualforce},workspace:function(){return Ext.apply(this.callParent(),{Name:this.Name,ContentType:this.ContentType})},performSave:function(a,b){var c=this;SfdcDevConsole.ToolingAPI.save("StaticResource",{id:this.id,Body:btoa(a),ContentType:this.ContentType},{success:function(){b()},failure:function(a){SfdcDevConsole.ToolingAPI.handleFailedRequest(response,
"Failed to save static resource "+c.Name,!0,!0);b(!0)}})}});
Ext.define("apex.editor.VisualforceEditor",{alias:"widget.visualforceeditor",extend:"apex.editor.CompileableSourceEditor",getAddons:function(){var a=this.callParent();Sfdc.apply(a,{matchTags:{bothTags:!0},autoCloseTags:!0,foldGutter:!0});a.extraKeys&&(a.extraKeys=Sfdc.apply(a.extraKeys,{"Ctrl-H":"toMatchingTag"}));return a},autocomplete:null,queryParam:{"core.apexpages.request.devconsole":"1"},setAutocomplete:function(){this.cmEditor.codeEditor.possibleTags=apex.editor.VisualforceEditor.autocompleteTags;
this.autocomplete||(this.autocomplete=SfdcDevConsole.Core.Autocomplete.Visualforce.getInstance(this.cmEditor.codeEditor))},vfSettingsToolbar:[{xtype:"tbfill"},{text:LC.getLabel("DeveloperConsole","DoneButton"),handler:function(){var a=this.ownerCt.ownerCt.items.get(0).store.data,b=this.ownerCt.ownerCt.editor,c=b.metadata;c||(c={});if(c.label!=a.get(0).data.value||c.description!=a.get(1).data.value||c.availableInTouch!=a.get(2).data.value||c.confirmationTokenRequired!=a.get(3).data.value)b.setDirty(),
b.onChange();c.label=a.get(0).data.value;c.description=a.get(1).data.value;c.availableInTouch=a.get(2).data.value;c.confirmationTokenRequired=a.get(3).data.value;this.ownerCt.ownerCt.hide()}},{text:LC.getLabel("DeveloperConsole","CancelButton"),handler:function(){this.ownerCt.ownerCt.hide()}}],vfSettingsWindow:function(){return Ext.create("Ext.window.Window",{xtype:window,title:"Settings",height:200,width:400,layout:"fit",bbar:this.vfSettingsToolbar,closeAction:"hide",items:{xtype:"vfsettings"}})},
toolbarButtons:function(){var a=this;return!apex.ide.IDE.hasVisualforce||!apex.ide.IDE.authorVisualforce?[]:SfdcDevConsole.Extents.ApexPage.isId(this.id)?(items=[{text:"Preview",handler:function(b){b.editor.dirty?Ext.MessageBox.show({title:"Page Not Saved",msg:"You have uncommitted changes to this VisualForce page. This preview will show the most recently committed version of this page, not your current changes.",buttons:Ext.Msg.OKCANCEL,icon:Ext.Msg.WARNING,fn:function(b){"ok"===b&&a.openOrRefreshWindow(!0)}}):
a.openOrRefreshWindow(!0)},listeners:{afterrender:function(a){a.editor=a.ownerCt.ownerCt;a.editor.viewVFButton=a}}}],apex.ide.IDE.toolingMDAPIDeploy&&items.push({text:"Settings",handler:function(b){a=this.ownerCt.ownerCt;metadata=a.metadata;b=[];b.push({id:"label",name:LC.getLabel("udd_ApexPage","MasterLabel"),type:"text",value:escapeHTML(metadata.label)});b.push({id:"description",name:LC.getLabel("udd_ApexPage","Description"),type:"textarea",value:escapeHTML(metadata.description)});b.push({id:"mobile",
name:LC.getLabel("udd_ApexPage","IsAvailableInTouch"),type:"boolean",value:metadata.availableInTouch});b.push({id:"csrf",name:LC.getLabel("udd_ApexPage","IsConfirmationTokenRequired"),type:"boolean",value:metadata.confirmationTokenRequired});vfSettingsWindow=a.vfSettingsWindow();vfSettingsWindow.editor=a;vfSettingsWindow.items.get(0).store.loadData(b);vfSettingsWindow.show()}}),items.concat(this.callParent())):this.callParent()},canOpen:function(){return apex.ide.IDE.hasVisualforce},canEdit:function(){return apex.ide.IDE.authorVisualforce},
openOrRefreshWindow:function(a){var b=Sfdc.Url.generateUrl(window.location.protocol+"//"+window.location.host+"/apex/"+(this.NamespacePrefix?this.NamespacePrefix+"__"+this.Name:this.Name),this.queryParam);this.window&&!this.window.closed?this.window.location=b:a&&(this.window=window.open(b,this.Name))},initComponent:function(){this.mode="visualforceWithJavascript";this.on({removed:function(){var a=this.NamespacePrefix,b=this.Name;Ext.getCmp("ViewState").removeNodes(a?a+"."+b:b)}});this.callParent();
this.on("afterOpen",function(a){var b=this;this.cmEditor.codeEditor.setOption("onKeyEvent",function(){(!b.autoComplete||apex.editor.VisualforceEditor.shouldUpdateAutocompleteTags())&&apex.editor.VisualforceEditor.getAutocompleteTags(b)});this.previewKeyMap||(this.previewKeyMap=new Ext.KeyMap(this.getEl(),[{key:"j",scope:this,alt:!1,ctrl:!0,fn:function(){this.viewVFButton.handler(this.viewVFButton)},defaultEventAction:"stopEvent"}]));apex.ide.IDE.toolingMDAPIDeploy&&(a.MasterLabel&&(this.metadata.label=
a.MasterLabel),a.Description&&(this.metadata.description=a.Description),Sfdc.isBoolean(a.IsAvailableInTouch)&&(this.metadata.availableInTouch=a.IsAvailableInTouch),Sfdc.isBoolean(a.IsConfirmationTokenRequired)&&(this.metadata.confirmationTokenRequired=a.IsConfirmationTokenRequired))},this)},statics:{autocompleteTags:null,lastTagUpdate:-1,shouldUpdateAutocompleteTags:function(){return 18E4<Date.now()-apex.editor.VisualforceEditor.lastTagUpdate},getAutocompleteTags:function(a){function b(){Ext.getCmp("editors").items.each(function(a){"visualforceeditor"===
a.xtype&&a.setAutocomplete()})}apex.editor.VisualforceEditor.shouldUpdateAutocompleteTags()?(apex.editor.VisualforceEditor.lastTagUpdate=Date.now(),SfdcDevConsole.ToolingAPI.completions("visualforce",{success:function(a,d){var e=JSON.parse(a);apex.editor.VisualforceEditor.autocompleteTags=e.completions;b()},failure:function(a,d){apex.editor.VisualforceEditor.autocompleteTags&&b()}})):apex.editor.VisualforceEditor.autocompleteTags&&a.setAutocomplete()}}});

//# sourceMappingURL=/javascript/1478523765000/sfdc/source/ApexIDEPanels_Ext4.js.map
